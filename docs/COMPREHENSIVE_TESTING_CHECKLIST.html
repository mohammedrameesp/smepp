<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Durj Platform - Comprehensive Testing Checklist</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --bg: #f8fafc;
            --card: #ffffff;
            --border: #e2e8f0;
            --text: #1e293b;
            --text-muted: #64748b;
            --sidebar-width: 280px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }
        .app-layout {
            display: flex;
            min-height: 100vh;
        }
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--card);
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            background: var(--card);
        }
        .sidebar-header h1 {
            font-size: 1.25rem;
            color: var(--primary);
            margin-bottom: 4px;
        }
        .sidebar-header p {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        .sidebar-nav {
            padding: 12px;
        }
        .nav-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 4px;
            font-size: 0.875rem;
            transition: all 0.15s ease;
        }
        .nav-item:hover {
            background: var(--bg);
        }
        .nav-item.complete {
            color: var(--success);
        }
        .nav-item .progress-mini {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 500;
        }
        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 24px;
            max-width: 1200px;
        }
        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        .stat-card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
        }
        .stat-card h3 {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        .stat-card .value {
            font-size: 1.75rem;
            font-weight: 700;
        }
        .stat-card.total .value { color: var(--primary); }
        .stat-card.completed .value { color: var(--success); }
        .stat-card.remaining .value { color: var(--warning); }
        .stat-card.percentage .value { color: var(--info); }
        /* Progress Bar */
        .main-progress {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
            margin-bottom: 24px;
        }
        .progress-bar {
            height: 12px;
            background: var(--bg);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            transition: width 0.3s ease;
        }
        .progress-text {
            font-size: 0.875rem;
            color: var(--text-muted);
            text-align: center;
        }
        /* Controls */
        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        .search-box {
            flex: 1;
            min-width: 250px;
        }
        .search-box input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.875rem;
            background: var(--card);
        }
        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
        }
        .filter-group {
            display: flex;
            gap: 4px;
        }
        .filter-btn {
            padding: 10px 16px;
            border: 1px solid var(--border);
            background: var(--card);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.15s ease;
        }
        .filter-btn:hover {
            background: var(--bg);
        }
        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        .action-btn {
            padding: 10px 16px;
            border: 1px solid var(--border);
            background: var(--card);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.15s ease;
        }
        .action-btn:hover {
            background: var(--bg);
        }
        .action-btn.danger:hover {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }
        /* Sections */
        .section {
            background: var(--card);
            border-radius: 12px;
            margin-bottom: 16px;
            border: 1px solid var(--border);
            overflow: hidden;
        }
        .section.collapsed .section-content {
            display: none;
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            cursor: pointer;
            user-select: none;
            transition: background 0.15s ease;
        }
        .section-header:hover {
            background: var(--bg);
        }
        .section-title h2 {
            font-size: 1rem;
            font-weight: 600;
        }
        .section-title .subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        .section-progress {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .section-progress-bar {
            width: 120px;
            height: 6px;
            background: var(--bg);
            border-radius: 3px;
            overflow: hidden;
        }
        .section-progress-fill {
            height: 100%;
            background: var(--success);
            transition: width 0.3s ease;
        }
        .section-progress-text {
            font-size: 0.875rem;
            color: var(--text-muted);
            min-width: 60px;
            text-align: right;
        }
        .collapse-icon {
            transition: transform 0.2s ease;
        }
        .section.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }
        .section-content {
            border-top: 1px solid var(--border);
        }
        /* Subsections */
        .subsection {
            border-bottom: 1px solid var(--border);
        }
        .subsection:last-child {
            border-bottom: none;
        }
        .subsection-header {
            padding: 12px 20px;
            background: var(--bg);
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-muted);
        }
        /* Test Items */
        .test-list {
            padding: 0 20px;
        }
        .test-item {
            display: flex;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            gap: 12px;
        }
        .test-item:last-child {
            border-bottom: none;
        }
        .test-item.completed {
            opacity: 0.6;
        }
        .test-item.completed .test-name {
            text-decoration: line-through;
        }
        .test-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            cursor: pointer;
            accent-color: var(--success);
        }
        .test-info {
            flex: 1;
        }
        .test-name {
            font-weight: 500;
            font-size: 0.875rem;
            margin-bottom: 4px;
        }
        .test-details {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        .test-details span {
            padding: 2px 8px;
            background: var(--bg);
            border-radius: 4px;
        }
        .test-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .badge-automated {
            background: #dcfce7;
            color: #166534;
        }
        .badge-manual {
            background: #fef3c7;
            color: #92400e;
        }
        .badge-e2e {
            background: #dbeafe;
            color: #1e40af;
        }
        .code-ref {
            font-family: monospace;
            font-size: 0.75rem;
            color: var(--primary);
            background: #e0e7ff;
            padding: 2px 8px;
            border-radius: 4px;
        }
        .priority-critical { color: var(--danger); }
        .priority-high { color: var(--warning); }
        .priority-medium { color: var(--info); }
        .priority-low { color: var(--text-muted); }
        /* Toast */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--text);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.875rem;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        /* Print Styles */
        @media print {
            .sidebar, .controls, .action-btn { display: none !important; }
            .main-content { margin-left: 0 !important; }
            .section { break-inside: avoid; }
            .test-item.completed { opacity: 1; }
        }
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
                padding: 16px;
            }
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        /* Hidden file input */
        #import-file { display: none; }
    </style>
</head>
<body>
    <div class="app-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>Durj Testing</h1>
                <p>Comprehensive Test Checklist</p>
            </div>
            <nav class="sidebar-nav" id="sidebar-nav"></nav>
        </aside>
        <main class="main-content">
            <div class="stats-bar">
                <div class="stat-card total">
                    <h3>Total Tests</h3>
                    <div class="value" id="total-tests">0</div>
                </div>
                <div class="stat-card completed">
                    <h3>Completed</h3>
                    <div class="value" id="completed-tests">0</div>
                </div>
                <div class="stat-card remaining">
                    <h3>Remaining</h3>
                    <div class="value" id="remaining-tests">0</div>
                </div>
                <div class="stat-card percentage">
                    <h3>Progress</h3>
                    <div class="value" id="progress-pct">0%</div>
                </div>
            </div>
            <div class="main-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="main-progress-fill"></div>
                </div>
                <div class="progress-text">Overall testing progress</div>
            </div>
            <div class="controls">
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="Search tests by name, steps, or expected result...">
                </div>
                <div class="filter-group">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="pending">Pending</button>
                    <button class="filter-btn" data-filter="completed">Completed</button>
                </div>
                <div class="filter-group">
                    <button class="filter-btn" data-coverage="all">All Coverage</button>
                    <button class="filter-btn" data-coverage="automated">Automated</button>
                    <button class="filter-btn" data-coverage="manual">Manual</button>
                    <button class="filter-btn" data-coverage="e2e">E2E</button>
                </div>
                <button class="action-btn" onclick="exportProgress()">Export</button>
                <button class="action-btn" onclick="document.getElementById('import-file').click()">Import</button>
                <input type="file" id="import-file" accept=".json" onchange="importProgress(event)">
                <button class="action-btn danger" onclick="resetProgress()">Reset</button>
            </div>
            <div id="sections-container"></div>
        </main>
    </div>

    <script>

// Test data
const T = {
    "1. Self-Service Registration (/get-started)": {
        "Get Started Page Access": [
            ["View /get-started page", "Navigate to /get-started", "Shows 2-step registration form with progress indicator", "src/app/get-started/page.tsx", "Critical", "E2E"],
            ["Redirect if already logged in", "Navigate to /get-started while authenticated", "Redirects to dashboard or setup", "src/middleware.ts", "High", "E2E"],
            ["Page loads without errors", "Load /get-started page", "Step 1 (Company) form fields rendered correctly", "src/app/get-started/page.tsx", "Critical", "E2E"],
            ["Shows 'Already have an account?' link", "View page header", "Sign in link visible and navigates to /login", "src/app/get-started/page.tsx", "Medium", "E2E"]
        ],
        "Step 1: Company Information": [
            ["Company name required", "Leave company name empty, try to continue", "Continue button disabled", "src/app/get-started/page.tsx", "Critical", "Automated"],
            ["Company name minimum 2 characters", "Enter single character company name", "Continue button disabled", "src/app/get-started/page.tsx", "High", "Automated"],
            ["Subdomain auto-generates from company name", "Enter 'Acme Corporation'", "Subdomain field shows 'acme-corporation'", "src/app/get-started/page.tsx", "High", "E2E"],
            ["Subdomain minimum 3 characters", "Enter 2-char subdomain manually", "Continue button disabled", "src/app/get-started/page.tsx", "High", "Automated"],
            ["Subdomain only lowercase alphanumeric and hyphens", "Enter 'My_Company!'", "Converted to 'mycompany'", "src/app/get-started/page.tsx", "High", "Automated"],
            ["Reserved subdomain blocked", "Enter 'www' or 'admin' or 'api'", "Shows 'This subdomain is not available' error", "src/lib/multi-tenant/subdomain.ts", "Critical", "E2E"],
            ["Subdomain availability check shows spinner", "Enter new subdomain", "Spinner appears during check", "src/app/get-started/page.tsx", "Medium", "E2E"],
            ["Available subdomain shows checkmark", "Enter unique subdomain", "Green checkmark appears after check", "src/app/get-started/page.tsx", "High", "E2E"],
            ["Unavailable subdomain shows X", "Enter existing org subdomain", "Red X appears with error message", "src/app/get-started/page.tsx", "High", "E2E"],
            ["Manual subdomain edit stops auto-generation", "Edit subdomain manually", "Subsequent company name changes don't update subdomain", "src/app/get-started/page.tsx", "Medium", "E2E"],
            ["Continue button disabled until valid", "Leave fields empty/invalid", "Continue button is disabled", "src/app/get-started/page.tsx", "Critical", "Automated"],
            ["Warning: subdomain cannot be changed", "View available subdomain hint", "Shows 'Choose carefully â€” this cannot be changed later'", "src/app/get-started/page.tsx", "Medium", "E2E"]
        ],
        "Step 2: Company Details": [
            ["Industry required", "Leave industry empty, try to submit", "Submit button disabled", "src/app/get-started/page.tsx", "Critical", "Automated"],
            ["'Other' industry shows text input", "Select 'Other' from industry dropdown", "Custom industry text field appears", "src/app/get-started/page.tsx", "High", "E2E"],
            ["Other industry requires 2+ chars", "Select 'Other', enter 1 character", "Submit button disabled", "src/app/get-started/page.tsx", "High", "Automated"],
            ["Company size required", "Leave company size empty, try to submit", "Submit button disabled", "src/app/get-started/page.tsx", "Critical", "Automated"],
            ["Email required", "Leave email empty, try to submit", "Submit button disabled", "src/app/get-started/page.tsx", "Critical", "Automated"],
            ["Email format validation", "Enter 'invalid-email'", "Shows validation error", "src/app/get-started/page.tsx", "Critical", "Automated"],
            ["Email availability check shows spinner", "Enter email address", "Spinner appears during check", "src/app/get-started/page.tsx", "Medium", "E2E"],
            ["Duplicate owner email rejected", "Enter email of existing org owner", "Shows 'This email is already registered' error", "src/app/api/organizations/signup/route.ts", "Critical", "E2E"],
            ["Admin name is optional", "Leave admin name empty, submit", "Form submits successfully", "src/app/get-started/page.tsx", "Medium", "E2E"],
            ["Back button returns to Step 1", "Click Back button", "Returns to Step 1 with data preserved", "src/app/get-started/page.tsx", "High", "E2E"]
        ],
        "Form Submission (POST /api/organizations/signup)": [
            ["Valid submission creates organization", "Fill all fields correctly, submit", "Organization created with FREE tier", "src/app/api/organizations/signup/route.ts", "Critical", "E2E"],
            ["Creates OrganizationInvitation", "Complete registration", "Invitation token created with 7-day expiry", "src/app/api/organizations/signup/route.ts", "Critical", "E2E"],
            ["Sends welcome email with invite link", "Complete registration", "Email sent with organization-specific invite URL", "src/app/api/organizations/signup/route.ts", "Critical", "E2E"],
            ["Returns success response", "Complete registration", "Shows success screen (not error)", "src/app/api/organizations/signup/route.ts", "Critical", "E2E"],
            ["Notifies super admin", "Complete registration", "Super admin receives notification email (non-blocking)", "src/app/api/organizations/signup/route.ts", "Low", "E2E"]
        ],
        "Success Screen": [
            ["Shows 'Check Your Email!' message", "Complete registration", "Large checkmark icon and 'Check Your Email!' heading", "src/app/get-started/page.tsx", "Critical", "E2E"],
            ["Shows email address", "Complete registration", "Admin email displayed in message", "src/app/get-started/page.tsx", "High", "E2E"],
            ["Shows organization name", "Complete registration", "Organization name shown in details", "src/app/get-started/page.tsx", "High", "E2E"],
            ["Shows portal URL", "Complete registration", "Subdomain.domain displayed (e.g., 'acme.durj.com')", "src/app/get-started/page.tsx", "High", "E2E"],
            ["Shows 7-day expiry notice", "Complete registration", "Message indicates link expires in 7 days", "src/app/get-started/page.tsx", "Medium", "E2E"],
            ["Resend email button works", "Click 'Resend email'", "POST to /api/organizations/resend-invite, shows loading state", "src/app/get-started/page.tsx", "High", "E2E"],
            ["Change email button works", "Click 'Change email address'", "Returns to Step 2 with only email field editable", "src/app/get-started/page.tsx", "High", "E2E"],
            ["Change email updates invitation", "Change email and submit", "New email receives invite link", "src/app/api/organizations/resend-invite/route.ts", "High", "E2E"],
            ["Go to Homepage link works", "Click 'Go to Homepage'", "Navigates to /", "src/app/get-started/page.tsx", "Medium", "E2E"]
        ],
        "Email Invitation Flow (/invite/[token])": [
            ["Loading state while fetching", "Navigate to /invite/[token]", "Shows spinner while loading invitation data", "src/app/invite/[token]/page.tsx", "Medium", "E2E"],
            ["Valid token shows 'You're Invited!' page", "Navigate to /invite/[valid-token]", "Shows 'You're Invited!' heading with org details", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["Shows organization name in description", "View invitation page", "Shows 'Join {orgName} on Durj' text", "src/app/invite/[token]/page.tsx", "High", "E2E"],
            ["Shows default Building icon (new org has no logo)", "View invitation for newly registered org", "Building icon displayed (logo set later in /setup)", "src/app/invite/[token]/page.tsx", "High", "E2E"],
            ["Shows invitation email", "View invitation details box", "Displays 'Invitation sent to {email}'", "src/app/invite/[token]/page.tsx", "High", "E2E"],
            ["Shows assigned role as Owner", "View invitation for self-registered org", "Displays 'Your role: Owner'", "src/app/invite/[token]/page.tsx", "High", "E2E"],
            ["Shows expiry date at bottom", "View invitation page", "Shows 'This invitation expires on {date}'", "src/app/invite/[token]/page.tsx", "Medium", "E2E"],
            ["Shows expiry warning if < 24 hours", "View invitation expiring soon", "Yellow alert: 'expires in X hours'", "src/app/invite/[token]/page.tsx", "High", "E2E"],
            ["Expired token shows error page", "Navigate to /invite/[expired-token]", "Shows 'Invalid Invitation' with red X icon", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["Already accepted token shows error", "Navigate to /invite/[used-token]", "Shows 'This invitation has already been used'", "src/app/api/invitations/[token]/route.ts", "Critical", "E2E"],
            ["Invalid token shows error", "Navigate to /invite/[fake-token]", "Shows 'Invitation not found' message", "src/app/api/invitations/[token]/route.ts", "Critical", "E2E"],
            ["Error page has 'Go to Login' button", "View error state", "Button navigates to /login", "src/app/invite/[token]/page.tsx", "Medium", "E2E"],
            ["Not logged in: shows 'Create Account & Join'", "View invitation while logged out", "Primary button to create account", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["Not logged in: shows 'Sign in' link", "View invitation while logged out", "Link text 'Already have an account? Sign in'", "src/app/invite/[token]/page.tsx", "High", "E2E"],
            ["'Create Account' redirects to signup", "Click 'Create Account & Join'", "Redirects to /signup?email=...&invite=...&name=...", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["'Sign in' redirects to login", "Click 'Sign in' link", "Redirects to /login?callbackUrl=/invite/[token]", "src/app/invite/[token]/page.tsx", "High", "E2E"],
            ["Logged in: shows 'Accept Invitation' button", "View invitation while authenticated", "Green checkmark button to accept", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["Accept button disabled if email mismatch", "Logged in with different email", "Button disabled, cannot accept", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["Email mismatch warning shown", "Logged in with different email", "Red alert with both emails shown", "src/app/invite/[token]/page.tsx", "High", "E2E"],
            ["Decline button navigates home", "Click 'Decline' button", "Navigates to homepage /", "src/app/invite/[token]/page.tsx", "Medium", "E2E"],
            ["Accepting shows loading state", "Click accept invitation", "Button shows 'Joining...' with spinner", "src/app/invite/[token]/page.tsx", "Medium", "E2E"],
            ["Success state after accepting", "Successfully accept invitation", "Shows 'Welcome to {orgName}!' with green checkmark", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["Success state shows redirect message", "After accepting", "Shows 'Redirecting to your dashboard...'", "src/app/invite/[token]/page.tsx", "Medium", "E2E"]
        ],
        "Account Creation (/signup with invite)": [
            ["Signup page shows 'Complete Your Signup'", "Navigate to /signup?invite=...", "Shows signup form with heading", "src/app/signup/page.tsx", "Critical", "E2E"],
            ["Email pre-filled and locked", "View signup form", "Email field shows invited email, read-only", "src/app/signup/page.tsx", "Critical", "E2E"],
            ["Name pre-filled if provided", "Invitation has name, view form", "Name field pre-populated", "src/app/signup/page.tsx", "Medium", "E2E"],
            ["Password field auto-focused", "View signup form", "Password field has focus", "src/app/signup/page.tsx", "Low", "E2E"],
            ["Password strength indicator", "Type password", "Shows 4-bar strength meter (Weak/Fair/Good/Strong)", "src/app/signup/page.tsx", "Medium", "E2E"],
            ["Confirm password shows checkmark", "Passwords match", "Green checkmark appears", "src/app/signup/page.tsx", "Medium", "E2E"],
            ["Password mismatch error", "Enter different confirm password", "Shows 'Passwords do not match' error", "src/app/signup/page.tsx", "Critical", "Automated"],
            ["Password minimum 8 chars", "Enter short password", "Shows 'Password must be at least 8 characters'", "src/app/signup/page.tsx", "Critical", "Automated"],
            ["Shows 'Already have an account?' link", "View signup form", "Link to /login with callbackUrl", "src/app/signup/page.tsx", "Medium", "E2E"]
        ],
        "Signup & Redirect to Setup": [
            ["Submit creates User record", "Fill form, click 'Complete Signup'", "User created in database with hashed password", "src/app/api/auth/signup/route.ts", "Critical", "E2E"],
            ["Invitation auto-accepted", "Signup completes", "TeamMember created, invitation.acceptedAt set", "src/app/api/auth/signup/route.ts", "Critical", "E2E"],
            ["Owner role assigned", "Signup for self-registered org", "TeamMember has isOwner=true, isAdmin=true", "src/app/api/auth/signup/route.ts", "Critical", "E2E"],
            ["User auto-signed in", "Signup completes", "Session created, user logged in automatically", "src/app/api/auth/signup/route.ts", "Critical", "E2E"],
            ["Redirect to org subdomain /setup", "After successful signup", "Browser redirects to https://{slug}.{domain}/setup", "src/app/signup/page.tsx", "Critical", "E2E"]
        ],
        "Setup Wizard (/setup)": [
            ["Setup wizard loads on org subdomain", "After signup redirect", "Shows Step 1 of setup wizard", "src/app/setup/page.tsx", "Critical", "E2E"],
            ["Skip setup entirely option available", "View setup wizard", "Shows 'Skip setup' link at top", "src/app/setup/components/SetupWizardClient.tsx", "Medium", "E2E"],
            ["Step 1: Organization Name & Code Prefix", "Enter org name and code prefix", "Validated and saved, proceed to Step 2", "src/app/setup/components/steps/OrgNameStep.tsx", "High", "E2E"],
            ["Step 2: Currencies", "Select primary and additional currencies", "Currencies saved, proceed to Step 3", "src/app/setup/components/steps/CurrencyStep.tsx", "Medium", "E2E"],
            ["Step 3: Logo Upload (skippable)", "Upload logo or click 'Skip for now'", "Logo saved or skipped, proceed to Step 4", "src/app/setup/components/steps/LogoStep.tsx", "Medium", "E2E"],
            ["Step 4: Brand Colors (skippable)", "Select colors or skip", "Colors saved or defaults kept, proceed to Step 5", "src/app/setup/components/steps/ColorStep.tsx", "Medium", "E2E"],
            ["Step 5: Module Selection (required)", "Select which modules to enable", "Modules saved, proceed to Step 6", "src/app/setup/components/steps/ModuleStep.tsx", "High", "E2E"],
            ["Step 6: Complete", "Click 'Complete Setup'", "profileComplete=true, redirected to /admin", "src/app/setup/components/SetupWizardClient.tsx", "Critical", "E2E"],
            ["Skip setup entirely", "Click 'Skip setup' link", "Redirects to /admin with defaults (profileComplete stays false)", "src/app/setup/components/SetupWizardClient.tsx", "Medium", "E2E"],
            ["Back button preserves data", "Click back on Step 3", "Returns to Step 2 with data preserved", "src/app/setup/components/SetupWizardClient.tsx", "Medium", "E2E"]
        ],
        "Dashboard Access (End of Flow)": [
            ["Admin dashboard loads", "After setup complete", "Shows /admin dashboard on org subdomain", "src/app/admin/page.tsx", "Critical", "E2E"],
            ["Navigation shows enabled modules", "View sidebar", "Only enabled modules shown in navigation", "src/components/layout/admin-sidebar.tsx", "High", "E2E"],
            ["Organization logo displayed in topbar", "View dashboard topbar", "Logo from setup shown (colored logos are inverted/filtered to match theme)", "src/components/layout/admin-header.tsx", "Medium", "E2E"]
        ]
    },
    "2. Team Onboarding": {
        "Page Access (/admin/employees/new)": [
            ["Navigate to add member page", "Click 'Add Member' button in employees page", "Shows add member form with Basic Information section", "src/app/admin/(hr)/employees/new/page.tsx", "Critical", "E2E"],
            ["Page shows correct heading", "View page header", "Shows 'Add Team Member' title", "src/app/admin/(hr)/employees/new/page.tsx", "Medium", "E2E"],
            ["Back button returns to team list", "Click back arrow", "Returns to /admin/employees", "src/app/admin/(hr)/employees/new/page.tsx", "Medium", "E2E"]
        ],
        "Basic Information Section": [
            ["Full name field required", "Leave name empty, try to submit", "Validation error: name required", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["Full name max 100 chars", "Enter name > 100 chars", "Input truncated or validation error", "src/app/admin/(hr)/employees/new/page.tsx", "Low", "E2E"],
            ["System Access toggle (credentials-only org)", "View form on credentials-only org", "Toggle shown: 'Allow this user to log in to the system'", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["System Access default ON", "View toggle initial state", "Toggle is ON by default (canLogin=true)", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["Email field shown when System Access ON", "System Access toggle is ON", "Email field visible with availability check", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["Email field hidden when System Access OFF", "Turn System Access toggle OFF", "Email field hidden (auto-generated nologin-{uuid}@{slug}.internal)", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["Email required when System Access ON", "Leave email empty with System Access ON", "Validation error: email required", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["Role dropdown with descriptions", "Click role dropdown", "Shows ADMIN, MANAGER, HR, FINANCE, OPERATIONS, EMPLOYEE with descriptions", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"]
        ],
        "Employee Settings Section": [
            ["Add as Employee checkbox present", "View form", "Shows 'Add as Employee' checkbox with description", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["Add as Employee default checked", "View checkbox initial state", "Checkbox is checked by default (isEmployee=true)", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["HR fields shown when checked", "Check 'Add as Employee'", "Shows employee code, designation, department, date of joining fields", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["HR fields hidden when unchecked", "Uncheck 'Add as Employee'", "HR fields hidden (creates Service Account)", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["Employee code auto-generated", "Check 'Add as Employee'", "Code generated as PREFIX-YYYY-NNN format", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["Employee code regenerate button", "Click regenerate icon next to code", "New unique code generated", "src/app/admin/(hr)/employees/new/page.tsx", "Medium", "E2E"],
            ["Designation field (optional)", "Enter designation", "Saved to employee profile", "src/app/admin/(hr)/employees/new/page.tsx", "Medium", "E2E"],
            ["Department dropdown with search", "Click department field", "Shows searchable dropdown of departments", "src/app/admin/(hr)/employees/new/page.tsx", "Medium", "E2E"],
            ["Date of Joining picker", "Click date field", "Shows date picker, max date is today", "src/app/admin/(hr)/employees/new/page.tsx", "Medium", "E2E"],
            ["Reports To dropdown (only if managers exist)", "View form when org has managers", "Shows dropdown with managers list + 'No manager' option", "src/app/admin/(hr)/employees/new/page.tsx", "Medium", "E2E"],
            ["Reports To hidden if no managers", "View form on new org with no managers", "Reports To field not shown", "src/app/admin/(hr)/employees/new/page.tsx", "Medium", "E2E"],
            ["On WPS checkbox (if payroll enabled)", "View form when payroll module enabled", "Shows 'On WPS' checkbox", "src/app/admin/(hr)/employees/new/page.tsx", "Medium", "E2E"]
        ],
        "Member Type Combinations": [
            ["Employee type: System Access ON + Add as Employee checked", "canLogin=true, isEmployee=true", "Email required, HR fields shown, full employee with system access", "src/app/admin/(hr)/employees/new/page.tsx", "Critical", "E2E"],
            ["Service Account type: System Access ON + Add as Employee unchecked", "canLogin=true, isEmployee=false", "Email required, NO HR fields, shared login account (info@, support@)", "src/app/admin/(hr)/employees/new/page.tsx", "Critical", "E2E"],
            ["No System Access type: System Access OFF + Add as Employee checked", "canLogin=false, isEmployee=true", "NO email field, HR fields shown, for drivers/laborers without login", "src/app/admin/(hr)/employees/new/page.tsx", "Critical", "E2E"],
            ["Invalid combination: System Access OFF + Add as Employee unchecked", "canLogin=false, isEmployee=false", "Validation error or Add as Employee auto-checked (must be employee)", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"]
        ],
        "Email Availability Check": [
            ["Email check triggers on input", "Enter email address", "Shows loading spinner after 500ms debounce", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["Available email shows checkmark", "Enter unused email", "Green checkmark + 'Email is available'", "src/app/api/admin/team/check-email/route.ts", "High", "E2E"],
            ["Existing member shows error", "Enter email of current member", "Red X + '{Name} is already a member of this organization'", "src/app/api/admin/team/check-email/route.ts", "High", "E2E"],
            ["Pending invitation shows error", "Enter email with active pending invite", "Red X + 'A pending invitation already exists for this email'", "src/app/api/admin/team/check-email/route.ts", "High", "E2E"],
            ["Expired invitation allows proceed", "Enter email with expired invite", "Amber warning + 'An expired invitation exists. You can still add them.'", "src/app/api/admin/team/check-email/route.ts", "High", "E2E"],
            ["Invalid email format shows error", "Enter malformed email", "Red X + 'Please enter a valid email address'", "src/app/api/admin/team/check-email/route.ts", "High", "E2E"],
            ["Submit disabled while checking", "Enter email, try to submit immediately", "Create button disabled during check", "src/app/admin/(hr)/employees/new/page.tsx", "Medium", "E2E"],
            ["Submit disabled if unavailable", "Enter existing member email", "Create button remains disabled", "src/app/admin/(hr)/employees/new/page.tsx", "Medium", "E2E"]
        ],
        "Service Account Behavior (System Access ON, Add as Employee unchecked)": [
            ["Unchecking Add as Employee hides HR fields", "Uncheck 'Add as Employee' checkbox", "Employee code, designation, department, date of joining fields hidden", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["Email field still shown and required", "View form with Add as Employee unchecked", "Email field visible and required (for shared logins like info@, support@)", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["Service account info shown", "View form with Add as Employee unchecked", "Shows info: 'Service accounts only appear in team management, not in HR features'", "src/app/admin/(hr)/employees/new/page.tsx", "Medium", "E2E"],
            ["Role dropdown still available", "Click role dropdown", "All roles available for service accounts", "src/app/admin/(hr)/employees/new/page.tsx", "Medium", "E2E"]
        ],
        "No System Access Behavior (System Access OFF, Add as Employee checked)": [
            ["Turning System Access OFF hides email field", "Turn off System Access toggle", "Email field hidden (will be auto-generated)", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["Add as Employee checkbox auto-checked", "Turn off System Access", "Add as Employee is checked (required when no login)", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["HR fields still shown", "View form with System Access OFF", "Employee code, designation, department fields still visible", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["No System Access info shown", "View form with System Access OFF", "Shows info: 'User will be added as employee without system login (e.g., drivers, laborers)'", "src/app/admin/(hr)/employees/new/page.tsx", "Medium", "E2E"],
            ["Auto-generated email format", "Submit form with System Access OFF", "Email generated as nologin-{uuid}@{org-slug}.internal", "src/app/api/users/route.ts", "High", "E2E"]
        ],
        "Member Creation (POST /api/users)": [
            ["Employee created successfully", "Submit form: System Access ON + Add as Employee checked", "TeamMember created with canLogin=true, isEmployee=true", "src/app/api/users/route.ts", "Critical", "E2E"],
            ["Service account created successfully", "Submit form: System Access ON + Add as Employee unchecked", "TeamMember created with canLogin=true, isEmployee=false", "src/app/api/users/route.ts", "Critical", "E2E"],
            ["No System Access employee created", "Submit form: System Access OFF + Add as Employee checked", "TeamMember created with canLogin=false, isEmployee=true, auto-generated email", "src/app/api/users/route.ts", "Critical", "E2E"],
            ["Password setup email sent (credentials org)", "Create employee with System Access ON on credentials org", "Email sent with /set-password/[token] link", "src/app/api/users/route.ts", "Critical", "E2E"],
            ["Password setup email sent for service account", "Create service account on credentials org", "Email sent with /set-password/[token] link", "src/app/api/users/route.ts", "High", "E2E"],
            ["No email when System Access OFF", "Create employee with System Access OFF", "No email sent (for drivers, laborers without system access)", "src/app/api/users/route.ts", "High", "E2E"],
            ["No System Access uses auto-generated email", "Create employee with System Access OFF", "Email set to nologin-{uuid}@{org-slug}.internal", "src/app/api/users/route.ts", "High", "E2E"],
            ["Success toast shown", "Submit valid form", "Toast: '{Name} has been added to the team'", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["Redirects to employees list", "Submit valid form", "Redirects to /admin/employees", "src/app/admin/(hr)/employees/new/page.tsx", "High", "E2E"],
            ["Button shows loading state", "Click Create button", "Button shows 'Creating...' with spinner", "src/app/admin/(hr)/employees/new/page.tsx", "Medium", "E2E"]
        ],
        "Credentials Flow: Password Setup Email": [
            ["Email contains setup link", "Check invited user email", "Link format: https://{org}.{domain}/set-password/{token}", "src/lib/core/email.ts", "Critical", "E2E"],
            ["Email shows organization branding", "Check email content", "Organization logo and primary color applied", "src/lib/core/email.ts", "Medium", "E2E"],
            ["Email shows user name", "Check email content", "Personalized with invited user's name", "src/lib/core/email.ts", "Medium", "E2E"],
            ["Email mentions 7-day expiry", "Check email content", "States link expires in 7 days", "src/lib/core/email.ts", "Medium", "E2E"]
        ],
        "Credentials Flow: Password Setup Page (/set-password/[token])": [
            ["Loading state while validating", "Navigate to /set-password/[token]", "Shows spinner + 'Validating your link...'", "src/app/set-password/[token]/page.tsx", "Medium", "E2E"],
            ["Valid token shows form", "Navigate with valid token", "Shows password form with user email displayed", "src/app/set-password/[token]/page.tsx", "Critical", "E2E"],
            ["Shows organization branding", "View password form", "Left panel shows org logo, name, tagline", "src/app/set-password/[token]/page.tsx", "Medium", "E2E"],
            ["Personalized welcome message", "View password form", "Shows 'Hi {Name}! Create a password...'", "src/app/set-password/[token]/page.tsx", "Medium", "E2E"],
            ["Password field with show/hide toggle", "Click eye icon", "Toggles password visibility", "src/app/set-password/[token]/page.tsx", "Medium", "E2E"],
            ["Confirm password field", "View form", "Second password field for confirmation", "src/app/set-password/[token]/page.tsx", "High", "E2E"],
            ["Password strength indicator", "Type password", "Shows 4-bar strength meter (weak/fair/good/strong)", "src/app/set-password/[token]/page.tsx", "High", "E2E"],
            ["Weak password (red)", "Enter 'abc123'", "Shows 'weak' in red, 1 bar filled", "src/app/set-password/[token]/page.tsx", "Medium", "E2E"],
            ["Strong password (green)", "Enter 'SecureP@ss1!'", "Shows 'strong' in green, 4 bars filled", "src/app/set-password/[token]/page.tsx", "Medium", "E2E"],
            ["Passwords must match", "Enter different confirm password", "Shows error: 'Passwords do not match'", "src/app/set-password/[token]/page.tsx", "High", "E2E"],
            ["Min 8 characters required", "Enter 'Abc1!'", "Validation error shown", "src/app/set-password/[token]/page.tsx", "High", "E2E"],
            ["Successful password setup", "Enter valid password, submit", "Shows 'Password created!' with check icon", "src/app/api/auth/set-password/route.ts", "Critical", "E2E"],
            ["Auto-redirect to login", "Complete password setup", "Redirects to /login after 3 seconds", "src/app/set-password/[token]/page.tsx", "Critical", "E2E"],
            ["Login shows success message", "After redirect to login", "Shows 'Password created! Please sign in to continue.'", "src/app/set-password/[token]/page.tsx", "High", "E2E"],
            ["Expired token shows error", "Navigate with expired token", "Clock icon + 'Link expired' + contact admin message", "src/app/set-password/[token]/page.tsx", "Critical", "E2E"],
            ["Already-set token shows message", "Navigate with used token", "Check icon + 'Password already set' + login link", "src/app/set-password/[token]/page.tsx", "Critical", "E2E"],
            ["Invalid token shows error", "Navigate with fake token", "X icon + 'Invalid link' + contact admin message", "src/app/set-password/[token]/page.tsx", "Critical", "E2E"]
        ],
        "Team Management UI (/admin/employees)": [
            ["Employees tab shows employee list", "Click Employees tab", "Shows employees with HR data (code, designation, department)", "src/app/admin/(hr)/employees/team-client.tsx", "High", "E2E"],
            ["Service Accounts tab shows service accounts", "Click Service Accounts tab", "Shows non-employee members with role badges", "src/app/admin/(hr)/employees/team-client.tsx", "High", "E2E"],
            ["Service account shows org logo", "View service account in list", "Uses organization logo as avatar (not initials)", "src/app/admin/(hr)/employees/team-client.tsx", "Low", "E2E"],
            ["Current user marked with '(you)'", "View own profile in list", "Name shows '(you)' suffix", "src/app/admin/(hr)/employees/team-client.tsx", "Low", "E2E"],
            ["Role dropdown for service accounts (Owner only)", "As owner, view service account", "Shows role dropdown to change Admin/Member", "src/app/admin/(hr)/employees/team-client.tsx", "High", "E2E"],
            ["Remove button for service accounts (Owner only)", "As owner, view service account", "Shows red trash icon to remove", "src/app/admin/(hr)/employees/team-client.tsx", "High", "E2E"]
        ],
        "Pending Invitations Card": [
            ["Card shown when invitations exist", "View team page with pending invites", "Shows 'Pending Invitations - N waiting to be accepted'", "src/app/admin/(hr)/employees/team-client.tsx", "High", "E2E"],
            ["Shows invitation email", "View pending invitation", "Email address displayed", "src/app/admin/(hr)/employees/team-client.tsx", "Medium", "E2E"],
            ["Shows role badge", "View pending invitation", "Role shown as colored badge", "src/app/admin/(hr)/employees/team-client.tsx", "Medium", "E2E"],
            ["Shows expiry date (valid)", "View non-expired invitation", "Clock icon + 'Expires {date}'", "src/app/admin/(hr)/employees/team-client.tsx", "Medium", "E2E"],
            ["Shows expired status (red)", "View expired invitation", "Alert icon + 'Expired' in red", "src/app/admin/(hr)/employees/team-client.tsx", "Medium", "E2E"],
            ["Resend button for valid invitation", "Click 'Resend' button", "Regenerates token, copies URL to clipboard, shows 'Copied!'", "src/app/api/admin/team/invitations/[id]/route.ts", "High", "E2E"],
            ["Regenerate button for expired invitation", "Click 'Regenerate' on expired invite", "Creates new token with 7-day expiry, copies URL", "src/app/api/admin/team/invitations/[id]/route.ts", "High", "E2E"],
            ["Cancel invitation", "Click trash icon on invitation", "Confirmation dialog, then deletes invitation", "src/app/api/admin/team/invitations/[id]/route.ts", "High", "E2E"]
        ],
        "Pending Members Card (Awaiting Authentication)": [
            ["Card shown when pending members exist", "View team page with pending members", "Shows 'Pending Members - N awaiting authentication'", "src/app/admin/(hr)/employees/team-client.tsx", "High", "E2E"],
            ["Shows member name and email", "View pending member", "Name, email, and employee code (if any) displayed", "src/app/admin/(hr)/employees/team-client.tsx", "Medium", "E2E"],
            ["Shows 'Awaiting password setup' (credentials)", "View credentials-pending member", "Clock icon + 'Awaiting password setup' in orange", "src/app/admin/(hr)/employees/team-client.tsx", "Medium", "E2E"],
            ["Shows 'Expired' status (red)", "View member with expired token", "Alert icon + 'Expired' in red", "src/app/admin/(hr)/employees/team-client.tsx", "Medium", "E2E"],
            ["Resend setup email (credentials)", "Click 'Resend' for credentials member", "Regenerates setupToken, sends new email, shows 'Sent!'", "src/app/api/admin/team/[memberId]/resend/route.ts", "High", "E2E"],
            ["Remove pending member (Admin only)", "Click trash icon on pending member", "Confirmation dialog, soft-deletes member", "src/app/api/admin/team/[memberId]/route.ts", "High", "E2E"]
        ],
        "Member Role Management": [
            ["Owner can update roles", "As owner, change member role", "Role updated successfully", "src/app/api/admin/team/[memberId]/route.ts", "High", "E2E"],
            ["Admin cannot update roles", "As admin, try to change role", "No role dropdown shown (or permission denied)", "src/app/api/admin/team/[memberId]/route.ts", "High", "E2E"],
            ["Cannot change own role", "Try to change your own role", "Dropdown disabled or not shown for self", "src/app/admin/(hr)/employees/team-client.tsx", "High", "E2E"],
            ["Cannot change owner's role", "Try to change org owner's role", "No dropdown shown for owner", "src/app/admin/(hr)/employees/team-client.tsx", "High", "E2E"]
        ],
        "Member Removal": [
            ["Owner can remove members", "As owner, click remove on member", "Confirmation dialog shown", "src/app/admin/(hr)/employees/team-client.tsx", "High", "E2E"],
            ["Confirmation dialog shows name", "Click remove button", "Dialog: 'Remove {Name}?' with warning message", "src/app/admin/(hr)/employees/team-client.tsx", "Medium", "E2E"],
            ["Soft delete on confirm", "Confirm removal", "Member marked as deleted (status=TERMINATED)", "src/app/api/admin/team/[memberId]/route.ts", "High", "E2E"],
            ["Cannot remove yourself", "Try to remove own account", "Remove button hidden or disabled for self", "src/app/admin/(hr)/employees/team-client.tsx", "High", "E2E"],
            ["Cannot remove org owner", "Try to remove owner", "Remove button hidden for owner", "src/app/admin/(hr)/employees/team-client.tsx", "High", "E2E"],
            ["Admin cannot remove other admins", "As admin, try to remove another admin", "Remove button hidden or permission denied", "src/app/api/admin/team/[memberId]/route.ts", "High", "E2E"]
        ],
        "SSO Flow: Invitation Email (requires super admin SSO setup)": [
            ["Email contains invite link", "Check invited user email", "Link format: https://{org}.{domain}/invite/{token}", "src/lib/core/email.ts", "Critical", "E2E"],
            ["Email shows inviter name", "Check email content", "'{Admin Name} invited you to join {Org Name}'", "src/lib/core/email.ts", "Medium", "E2E"],
            ["Email shows assigned role", "Check email content", "'...as a {Role}'", "src/lib/core/email.ts", "Medium", "E2E"],
            ["Email has Accept Invitation button", "Check email content", "CTA button linking to /invite/{token}", "src/lib/core/email.ts", "High", "E2E"],
            ["Email mentions 7-day expiry", "Check email content", "States invitation expires in 7 days", "src/lib/core/email.ts", "Medium", "E2E"]
        ],
        "SSO Flow: Invitation Acceptance (/invite/[token])": [
            ["Valid token shows invitation page", "Navigate to /invite/{token}", "Shows 'You're Invited!' heading", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["Shows organization name and logo", "View invitation page", "Org logo (or Building icon) and name displayed", "src/app/invite/[token]/page.tsx", "High", "E2E"],
            ["Shows assigned role", "View invitation page", "Role badge (Admin/Manager/Member) shown", "src/app/invite/[token]/page.tsx", "High", "E2E"],
            ["Shows invited email", "View invitation page", "'Invitation sent to {email}'", "src/app/invite/[token]/page.tsx", "High", "E2E"],
            ["Not logged in: shows auth options", "View page when not logged in", "Shows 'Sign in with Google/Microsoft' and 'Sign up' options", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["Sign in with Google", "Click Google sign-in button", "Redirects to Google OAuth flow", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["Sign in with Microsoft", "Click Microsoft sign-in button", "Redirects to Microsoft OAuth flow", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["Logged in with matching email: Accept button", "View page logged in with invite email", "Shows 'Accept Invitation' button", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["Accept invitation success", "Click 'Accept Invitation'", "Creates/updates TeamMember, marks invite accepted", "src/app/api/invitations/[token]/route.ts", "Critical", "E2E"],
            ["Redirects to org dashboard after accept", "Accept invitation", "Redirects to https://{org-slug}.{domain}/admin", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["Expired token shows error", "Navigate with expired token", "Shows 'Invitation expired' message", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["Already accepted shows message", "Navigate with used token", "Shows 'Already accepted' message with login link", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["Invalid token shows error", "Navigate with fake token", "Shows 'Invalid invitation' message", "src/app/invite/[token]/page.tsx", "Critical", "E2E"],
            ["Decline invitation option", "Click 'Decline' button", "Shows confirmation, then marks declined", "src/app/invite/[token]/page.tsx", "Medium", "E2E"]
        ],
        "SSO Flow: Pending Members (requires super admin SSO setup)": [
            ["Shows 'Awaiting invitation acceptance' (SSO)", "View SSO-pending member", "Clock icon + 'Awaiting invitation acceptance' in orange", "src/app/admin/(hr)/employees/team-client.tsx", "Medium", "E2E"],
            ["Resend invitation (SSO)", "Click 'Resend' for SSO member", "Regenerates invitation, sends new email", "src/app/api/admin/team/[memberId]/resend/route.ts", "High", "E2E"]
        ]
    },
    "3. Authentication & Session": {
        "Login Functionality": [
            ["Email/password login with valid credentials", "Enter valid email and password", "User logged in, redirected to dashboard", "src/lib/core/auth.ts", "Critical", "Automated"],
            ["Email/password login with invalid email format", "Enter malformed email", "Validation error shown", "src/lib/core/auth.ts", "High", "Automated"],
            ["Email/password login with non-existent email", "Enter email not in system", "Generic 'Invalid credentials' error (no enumeration)", "src/lib/core/auth.ts", "Critical", "Automated"],
            ["Email/password login with wrong password", "Enter wrong password", "Invalid credentials error, attempt counted", "src/lib/core/auth.ts", "Critical", "Automated"],
            ["Login redirect to correct subdomain", "Login from marketing page", "Redirected to {org}.durj.com", "src/middleware.ts", "Critical", "E2E"],
            ["Login preserves return URL", "Access protected page, login", "Redirected to original page after login", "src/lib/core/auth.ts", "High", "E2E"],
            ["Session expiration after timeout", "Leave session idle beyond timeout", "User logged out, session cleared", "src/lib/core/auth.ts", "High", "Manual"],
            ["Session refresh mechanism", "Continue activity within session", "Session extended automatically", "src/lib/core/auth.ts", "Medium", "Manual"],
            ["Logout clears session completely", "Click logout", "All session data cleared, cookies removed", "src/lib/core/auth.ts", "Critical", "Automated"],
            ["Logout from all devices option", "Logout from all devices", "All sessions invalidated", "src/lib/core/auth.ts", "High", "Manual"],
            ["Deleted user login rejected", "Login with soft-deleted account (isDeleted=true)", "Error 'Invalid email or password'", "src/lib/core/auth.ts", "Critical", "Automated"],
            ["Deactivated user login rejected", "Login with canLogin=false account", "Error 'Account deactivated'", "src/lib/core/auth.ts", "Critical", "Automated"],
            ["Login on wrong subdomain", "User in org-a logs into org-b subdomain", "Error or redirect to correct subdomain", "src/middleware.ts", "High", "E2E"],
            ["Login after password change invalidates sessions", "Change password on device A", "Device B session invalidated", "src/lib/core/auth.ts", "High", "Manual"],
            ["Email case insensitivity", "Login with different email case", "Works (case-insensitive matching)", "src/lib/core/auth.ts", "Medium", "Automated"],
            ["Email whitespace trimmed", "Login with leading/trailing spaces in email", "Works after trimming", "src/lib/core/auth.ts", "Medium", "Automated"]
        ],
        "Account Lockout (Progressive)": [
            ["5 failed attempts causes 5 minute lockout", "Enter wrong password 5 times", "Account locked for 5 minutes", "src/lib/security/lockout.ts", "Critical", "Automated"],
            ["10 failed attempts causes 15 minute lockout", "Enter wrong password 10 times", "Account locked for 15 minutes", "src/lib/security/lockout.ts", "Critical", "Automated"],
            ["15 failed attempts causes 30 minute lockout", "Enter wrong password 15 times", "Account locked for 30 minutes", "src/lib/security/lockout.ts", "High", "Automated"],
            ["20+ failed attempts causes 60 minute lockout", "Enter wrong password 20+ times", "Account locked for 60 minutes", "src/lib/security/lockout.ts", "High", "Automated"],
            ["Lockout clears automatically after duration", "Wait for lockout to expire", "User can attempt login again", "src/lib/security/lockout.ts", "High", "Automated"],
            ["Successful login resets failed attempt counter", "Login successfully after failures", "Counter reset to 0", "src/lib/security/lockout.ts", "Critical", "Automated"],
            ["Lockout applies per user/email not IP", "Try different account from same IP", "Only failed account is locked", "src/lib/security/lockout.ts", "High", "Automated"],
            ["Lockout response doesn't reveal if email exists", "Lockout check on non-existent email", "Same response as locked account", "src/lib/security/lockout.ts", "Critical", "Automated"],
            ["Admin can manually unlock account", "Admin uses unlockAccount()", "Account unlocked immediately", "src/lib/security/lockout.ts", "High", "Manual"]
        ],
        "Password Validation (Default Users)": [
            ["Minimum 8 characters required", "Enter 7 character password", "Validation error: at least 8 characters", "src/lib/security/password-validation.ts", "Critical", "Automated"],
            ["Uppercase letter required", "Enter all lowercase password", "Validation error: requires uppercase", "src/lib/security/password-validation.ts", "Critical", "Automated"],
            ["Lowercase letter required", "Enter all uppercase password", "Validation error: requires lowercase", "src/lib/security/password-validation.ts", "Critical", "Automated"],
            ["Number required in password", "Enter password without numbers", "Validation error: requires number", "src/lib/security/password-validation.ts", "Critical", "Automated"],
            ["Strength score: weak (0-1)", "Enter simple password", "Shows 'weak' indicator (red)", "src/lib/security/password-validation.ts", "Medium", "Automated"],
            ["Strength score: fair (2)", "Enter moderate password", "Shows 'fair' indicator (orange)", "src/lib/security/password-validation.ts", "Medium", "Automated"],
            ["Strength score: good (3)", "Enter good password", "Shows 'good' indicator (yellow)", "src/lib/security/password-validation.ts", "Medium", "Automated"],
            ["Strength score: strong (4)", "Enter complex password 12+ chars", "Shows 'strong' indicator (green)", "src/lib/security/password-validation.ts", "Medium", "Automated"],
            ["Common password detection", "Enter 'password123'", "Detected as common, score = 0", "src/lib/security/password-validation.ts", "Critical", "Automated"],
            ["Length bonus for 12+ characters", "Enter 12+ character password", "Score increased by length bonus", "src/lib/security/password-validation.ts", "Low", "Automated"]
        ],
        "Password Reset Flow": [
            ["Request password reset with valid email", "Enter email, submit", "Success message shown, email sent", "src/app/api/auth/reset-password/route.ts", "Critical", "Automated"],
            ["Request reset with non-existent email", "Enter unknown email", "Same success message (prevents enumeration)", "src/app/api/auth/reset-password/route.ts", "Critical", "Automated"],
            ["Rate limiting on password reset", "Request reset 5+ times quickly", "Rate limited after threshold", "src/lib/security/rateLimit.ts", "High", "Automated"],
            ["Reset token expires after time limit", "Use old reset token", "Error: token expired", "src/app/api/auth/set-password/route.ts", "Critical", "Automated"],
            ["Set password with valid token", "Use valid token, set new password", "Password updated, token invalidated", "src/app/api/auth/set-password/route.ts", "Critical", "Automated"],
            ["Invalid reset token rejected", "Use fake/tampered token", "Error: invalid token", "src/app/api/auth/set-password/route.ts", "Critical", "Automated"]
        ],
        "Rate Limiting": [
            ["General API: 60 requests per 60 seconds", "Make 61 requests in 60 seconds", "61st request returns 429", "src/lib/security/rateLimit.ts", "High", "Automated"],
            ["Authentication: 5 attempts per 15 minutes", "Make 6 login attempts in 15 min", "6th attempt rate limited", "src/lib/security/rateLimit.ts", "High", "Automated"],
            ["Rate limit returns 429 with Retry-After", "Exceed rate limit", "429 status with Retry-After header", "src/lib/security/rateLimit.ts", "High", "Automated"],
            ["Rate limit per user (authenticated)", "Authenticated user exceeds limit", "Only that user is limited", "src/lib/security/rateLimit.ts", "High", "Automated"],
            ["Rate limit per IP (unauthenticated)", "Unauthenticated requests exceed limit", "IP is limited", "src/lib/security/rateLimit.ts", "High", "Automated"]
        ],
        "2FA Tests (Super Admin Only)": [
            ["2FA token reuse", "Use same 2FA code twice (super admin login)", "Second attempt rejected", "src/app", "Medium", "Manual"],
            ["2FA token expired", "Wait >30 seconds, enter code (super admin)", "Error 'Code expired'", "src/app", "Medium", "Manual"],
            ["2FA pending token replay", "Get pending token, use twice (super admin)", "Second use rejected (JTI check)", "src/app", "Medium", "Manual"],
            ["2FA setup incomplete login", "Enable 2FA, don't complete setup (super admin)", "Blocked until setup complete", "src/app", "Medium", "Manual"],
            ["2FA backup codes", "Use backup code (super admin)", "Works, code invalidated", "src/app", "Medium", "Manual"],
            ["2FA on new device", "Login from new device with 2FA (super admin)", "Requires 2FA verification", "src/app", "Medium", "Manual"],
            ["Disable 2FA requires verification", "Try to disable 2FA (super admin)", "Must enter current 2FA code", "src/app", "Medium", "Manual"],
            ["2FA setup generates QR code", "Start 2FA setup as super admin", "QR code and manual key displayed", "src/app", "Medium", "Manual"],
            ["2FA enable requires verification", "Enter correct 6-digit code during setup", "2FA enabled, backup codes shown", "src/app", "Medium", "Manual"],
            ["2FA backup codes count", "View backup codes after 2FA setup", "Shows 10 backup codes", "src/app", "Medium", "Manual"],
            ["2FA backup code single use", "Use same backup code twice", "Second use rejected", "src/app", "Medium", "Manual"],
            ["2FA disable requires current code", "Try to disable 2FA without code", "Must enter current TOTP code", "src/app", "Medium", "Manual"],
            ["2FA rate limiting", "5+ failed 2FA attempts in 15 minutes", "Rate limited for 15 minutes", "src/app", "Medium", "Manual"],
            ["2FA pending token expiry", "Wait 5+ min after entering credentials", "Pending token expired, must re-enter credentials", "src/app", "Medium", "Manual"]
        ],
        "Session Tests": [
            ["Session expiry", "Wait for session to expire (24 hours)", "Redirected to login", "src/app", "Medium", "Manual"],
            ["Multiple devices", "Log in on two browsers", "Both should work independently", "src/app", "Medium", "Manual"],
            ["Logout clears session", "Click logout", "All session data cleared", "src/app", "Medium", "Manual"],
            ["Token refresh", "Wait near expiry, make request", "Token should auto-refresh", "src/app", "Medium", "Manual"],
            ["Multiple tabs", "Open app in 2 tabs", "Session synced", "src/app", "Medium", "Manual"],
            ["Logout in one tab", "Logout, check other tab", "Other tab logs out", "src/app", "Medium", "Manual"],
            ["Session after password change", "Change password", "Forces re-login", "src/app", "Medium", "Manual"],
            ["Inactive timeout", "Leave idle for 30 min", "Session still valid (no idle timeout, only 24h absolute expiry)", "src/app", "Medium", "Manual"],
            ["Session after org deletion", "Org deleted while user logged in", "Graceful logout, clear message", "src/app", "Medium", "Manual"],
            ["Session with changed permissions", "Admin removes user's HR access", "Permission revoked within 30 seconds", "src/app", "Medium", "Manual"],
            ["Concurrent sessions", "Login on 5+ devices", "All sessions work (no concurrent limit implemented)", "src/app", "Medium", "Manual"],
            ["Session token in URL", "Token leaked in URL", "Should not expose token in URL", "src/app", "Medium", "Manual"],
            ["Cross-tab session sync", "Login in tab 1, check tab 2", "Tab 2 reflects login state", "src/app", "Medium", "Manual"],
            ["Permission refresh timing", "Admin revokes permission, user makes request", "Permission revoked within 30 seconds", "src/app", "Medium", "Manual"],
            ["Impersonation cookie TTL", "Super admin impersonates org", "Impersonation cookie expires in 15 minutes", "src/app", "Medium", "Manual"],
            ["Session after canLogin disabled", "Admin disables canLogin for user", "User logged out within 30 seconds", "src/app", "Medium", "Manual"]
        ],
        "Authorization Tests": [
            ["Employee accessing admin route", "As employee, navigate to /admin/settings", "Redirected to employee portal", "src/app", "Medium", "Manual"],
            ["Non-HR accessing HR routes", "As regular admin, access HR settings", "Access denied or limited view", "src/app", "Medium", "Manual"],
            ["Non-Finance accessing payroll", "As regular admin, access payroll", "Access denied", "src/app", "Medium", "Manual"],
            ["Disabled module access", "Try to access disabled module route", "Shows 'Module not enabled'", "src/app", "Medium", "Manual"],
            ["Admin without HR access", "Admin without hasHRAccess accesses /admin/hr/*", "Redirected to /admin", "src/app", "Medium", "Manual"],
            ["Admin without Finance access", "Admin without hasFinanceAccess accesses /admin/payroll", "Redirected to /admin", "src/app", "Medium", "Manual"],
            ["Admin without Operations access", "Admin without hasOperationsAccess accesses /admin/assets", "Redirected to /admin", "src/app", "Medium", "Manual"],
            ["Module not installed prompt", "Admin accesses disabled module", "Redirected to /admin/modules with install prompt", "src/app", "Medium", "Manual"],
            ["Non-admin module access", "Non-admin accesses disabled module", "Redirected to /forbidden", "src/app", "Medium", "Manual"],
            ["Super admin route access", "Regular user accesses /super-admin/*", "Redirected to login or forbidden", "src/app", "Medium", "Manual"],
            ["Impersonation route protection", "Non-super-admin with impersonation URL param", "Param ignored, normal auth flow continues", "src/app", "Medium", "Manual"]
        ],
        "OAuth/SSO Login (requires SSO setup)": [
            ["Google OAuth login (new user)", "Click Google login, complete flow", "Account created, organization selection", "src/lib/oauth/google.ts", "Critical", "Manual"],
            ["Google OAuth login (existing user)", "Click Google login with existing account", "Logged in, redirected to dashboard", "src/lib/oauth/google.ts", "Critical", "Manual"],
            ["Microsoft/Azure AD OAuth login", "Click Microsoft login, complete flow", "User authenticated via Azure AD", "src/lib/oauth/azure.ts", "High", "Manual"],
            ["Custom OAuth per organization (Google)", "Login via org-specific Google OAuth", "Uses org's client ID/secret", "src/lib/oauth/utils.ts", "High", "Manual"],
            ["Custom OAuth per organization (Azure)", "Login via org-specific Azure OAuth", "Uses org's client ID/secret", "src/lib/oauth/utils.ts", "High", "Manual"],
            ["OAuth user tries password login", "User signed up via Google tries email/password", "Error 'Use Google sign-in' or works if passwordHash exists", "src/lib/core/auth.ts", "High", "Manual"],
            ["OAuth login with deleted account", "OAuth login with soft-deleted account", "Error or creates new account based on policy", "src/lib/oauth/utils.ts", "High", "Manual"],
            ["OAuth login while account locked", "OAuth login during lockout period", "Error 'Account locked'", "src/lib/oauth/utils.ts", "High", "Manual"],
            ["OAuth state tampering rejected", "Modify state parameter in OAuth callback", "Error 'Invalid state'", "src/lib/oauth/utils.ts", "Critical", "Manual"],
            ["OAuth nonce replay attack rejected", "Reuse OAuth state parameter after first use", "Error 'State already used'", "src/lib/oauth/utils.ts", "Critical", "Manual"],
            ["OAuth domain restriction enforced", "Sign in with non-allowed email domain", "Error 'Email domain not allowed'", "src/lib/oauth/utils.ts", "High", "Manual"],
            ["OAuth method restricted by org", "Org blocks OAuth, user tries OAuth login", "Error 'Login method not allowed'", "src/lib/oauth/utils.ts", "High", "Manual"],
            ["OAuth with existing email different provider", "Google user tries Microsoft with same email", "Links accounts or shows conflict message", "src/lib/oauth/utils.ts", "High", "Manual"]
        ],
        "Note": [
            ["2FA availability", "Verify 2FA option exists", "2FA is only available for Super Admins - organization users (TeamMembers) do not have 2FA", "src/app", "Medium", "Manual"],
            ["Remember Me not implemented", "Check login form", "Remember Me checkbox not present - all sessions fixed at 24 hours", "src/app", "Medium", "Manual"],
            ["Session concurrent limit", "Test multiple logins", "No concurrent session limit - all sessions work simultaneously", "src/app", "Medium", "Manual"]
        ]
    },
    "4. Multi-Tenant Isolation": {
        "Data Isolation": [
            ["User can only see data from their organization", "Query any tenant-scoped model", "Only own org's data returned", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"],
            ["Assets filtered by tenantId automatically", "List assets", "Only tenant's assets shown", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"],
            ["Employees filtered by tenantId automatically", "List employees", "Only tenant's employees shown", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"],
            ["Leave requests filtered automatically", "List leave requests", "Only tenant's requests shown", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"],
            ["Payroll runs filtered automatically", "List payroll runs", "Only tenant's runs shown", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"],
            ["Subscriptions filtered automatically", "List subscriptions", "Only tenant's subscriptions shown", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"],
            ["Suppliers filtered automatically", "List suppliers", "Only tenant's suppliers shown", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"],
            ["Purchase requests filtered automatically", "List purchase requests", "Only tenant's requests shown", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"]
        ],
        "IDOR Prevention": [
            ["Cannot access asset by ID from another org", "Request /api/assets/{other-org-id}", "404 Not Found (not 403)", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"],
            ["Cannot access employee by ID from another org", "Request /api/employees/{other-org-id}", "404 Not Found", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"],
            ["Cannot access leave request from another org", "Request /api/leave/requests/{other-org-id}", "404 Not Found", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"],
            ["Cannot update asset from another org", "PATCH /api/assets/{other-org-id}", "404 Not Found", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"],
            ["Cannot delete asset from another org", "DELETE /api/assets/{other-org-id}", "404 Not Found", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"],
            ["findUnique operations verify tenant post-fetch", "Query with crafted ID", "Tenant ownership verified after fetch", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"]
        ],
        "Subdomain Routing": [
            ["Organization accessible via subdomain", "Access {slug}.durj.com", "Organization context loaded", "src/middleware.ts", "Critical", "E2E"],
            ["Redirect to correct subdomain if wrong", "Access wrong subdomain while logged in", "Redirected to correct org subdomain", "src/middleware.ts", "High", "E2E"],
            ["Subdomain extracted from host header", "Request with host header", "Subdomain parsed correctly", "src/middleware.ts", "High", "Automated"],
            ["Invalid subdomain shows 404", "Access non-existent subdomain", "404 page or redirect to marketing", "src/middleware.ts", "High", "E2E"],
            ["Localhost subdomain handling in dev", "Access {slug}.localhost:3000", "Organization context loaded", "src/middleware.ts", "Medium", "Manual"]
        ],
        "Subdomain Validation": [
            ["Reserved subdomains blocked", "Try to create org with 'www' slug", "Error: reserved subdomain", "src/lib/multi-tenant/subdomain.ts", "Critical", "Automated"],
            ["Slug length: 3-63 characters", "Create org with 2 char slug", "Error: minimum 3 characters", "src/lib/multi-tenant/subdomain.ts", "High", "Automated"],
            ["Slug lowercase alphanumeric only", "Create org with uppercase slug", "Error: must be lowercase", "src/lib/multi-tenant/subdomain.ts", "High", "Automated"],
            ["Slug cannot start/end with hyphen", "Create org with '-test' slug", "Error: cannot start with hyphen", "src/lib/multi-tenant/subdomain.ts", "High", "Automated"],
            ["Special characters rejected in slug", "Create org with 'test_org' slug", "Error: special characters not allowed", "src/lib/multi-tenant/subdomain.ts", "High", "Automated"]
        ],
        "Tenant Headers": [
            ["x-tenant-id header injected by middleware", "Make authenticated request", "Header present in request context", "src/middleware.ts", "Critical", "Automated"],
            ["x-tenant-slug header injected", "Make authenticated request", "Slug header present", "src/middleware.ts", "High", "Automated"],
            ["x-user-id header injected", "Make authenticated request", "User ID header present", "src/middleware.ts", "High", "Automated"],
            ["Missing tenant context returns 401/403", "Request without auth/tenant", "Appropriate error returned", "src/lib/http/handler.ts", "Critical", "Automated"]
        ]
    },
    "5. RBAC & Permissions": {
        "Team Member Roles": [
            ["ADMIN can access all admin routes", "Login as admin, access any admin route", "Access granted", "src/middleware.ts", "Critical", "E2E"],
            ["ADMIN can manage users", "Admin adds/removes team members", "Operations succeed", "src/app/api/admin/team/route.ts", "Critical", "E2E"],
            ["ADMIN can manage settings", "Admin modifies org settings", "Settings updated", "src/app/api/admin/organization/route.ts", "High", "E2E"],
            ["MEMBER cannot access admin routes", "Login as member, access /admin/*", "Access denied (redirect or 403)", "src/middleware.ts", "Critical", "E2E"],
            ["MEMBER can only see own profile", "Member tries to view other profile", "Access denied", "src/app/api/users/route.ts", "High", "E2E"],
            ["MEMBER can only see own leave requests", "Member lists leave requests", "Only own requests shown", "src/app/api/leave/requests/route.ts", "High", "Automated"],
            ["MEMBER can only see own payslips", "Member lists payslips", "Only own payslips shown", "src/app/api/payroll/payslips/route.ts", "High", "Automated"]
        ],
        "Organization Roles": [
            ["OWNER can access billing settings", "Owner accesses billing page", "Billing page shown", "src/app/admin/(system)/billing/page.tsx", "High", "E2E"],
            ["OWNER can transfer ownership", "Owner transfers to another admin", "New owner set, old owner becomes admin", "src/app/api/admin/team/route.ts", "High", "Manual"],
            ["OWNER can delete organization", "Owner deletes org", "Org and all data removed", "src/app/api/organizations/route.ts", "Critical", "Manual"],
            ["ADMIN cannot access billing (OWNER only)", "Admin tries billing page", "Access denied", "src/middleware.ts", "High", "E2E"],
            ["MANAGER can approve requests", "Manager approves leave/PR", "Approval processed", "src/features/approvals/lib/approval-engine.ts", "High", "Automated"]
        ],
        "Module Access Control": [
            ["Disabled modules return 403 on access", "Access disabled module route", "403 Forbidden", "src/middleware.ts", "Critical", "Automated"],
            ["Disabled modules hide navigation items", "View sidebar with disabled module", "Module not in nav", "src/components/layout/sidebar.tsx", "High", "E2E"],
            ["Module can be enabled by admin", "Admin enables module", "Module accessible", "src/app/api/modules/route.ts", "High", "E2E"],
            ["Module can be disabled by admin", "Admin disables module", "Module no longer accessible", "src/app/api/modules/route.ts", "High", "E2E"],
            ["Module dependencies enforced", "Disable module with dependent", "Warning or error", "src/lib/modules/registry.ts", "Medium", "Manual"]
        ],
        "Functional Access": [
            ["hasOperationsAccess controls operations modules", "User without ops access", "Cannot access assets/subscriptions/suppliers", "src/middleware.ts", "High", "E2E"],
            ["hasHRAccess controls HR modules", "User without HR access", "Cannot access employees/leave/payroll", "src/middleware.ts", "High", "E2E"],
            ["hasFinanceAccess controls finance features", "User without finance access", "Cannot access payroll approval", "src/middleware.ts", "High", "E2E"],
            ["canApprove enables approval functionality", "User without canApprove", "Cannot approve requests", "src/features/approvals/lib/approval-engine.ts", "High", "Automated"]
        ]
    },
    "6. Assets Module": {
        "Asset Creation": [
            ["Asset tag auto-generates if empty", "Create asset without tag", "Tag generated: ORG-CAT-YYSEQ", "src/features/assets/lib/asset-tag.ts", "High", "Automated"],
            ["Asset tag uniqueness within org", "Create asset with duplicate tag", "Error: tag already exists", "src/app/api/assets/route.ts", "Critical", "Automated"],
            ["Type field required", "Create asset without type", "Validation error", "src/features/assets/validations/assets.ts", "Critical", "Automated"],
            ["Model field required", "Create asset without model", "Validation error", "src/features/assets/validations/assets.ts", "Critical", "Automated"],
            ["Price must be positive if provided", "Create asset with negative price", "Validation error", "src/features/assets/validations/assets.ts", "High", "Automated"],
            ["Price QAR auto-calculated from currency", "Create asset in USD", "priceQAR calculated using exchange rate", "src/features/assets/lib/currency.ts", "High", "Automated"],
            ["Status defaults to IN_USE", "Create asset without status", "Status set to IN_USE", "src/features/assets/validations/assets.ts", "Medium", "Automated"],
            ["Empty strings transformed to null", "Submit form with empty optional fields", "Stored as null not empty string", "src/features/assets/validations/assets.ts", "Low", "Automated"],
            ["Tag collision handling", "Create 50 assets rapidly", "All get unique sequential tags", "src/app/api/assets/route.ts", "Medium", "Manual"],
            ["Duplicate serial allowed", "Same serial in same tenant", "Allowed (serial not unique constraint)", "src/app/api/assets/route.ts", "Medium", "Manual"],
            ["Warranty date auto-fill", "Enter purchase date, leave warranty blank", "Warranty = purchase + 1 year default", "src/app/admin/(operations)/assets/new/page.tsx", "Medium", "Manual"],
            ["Edit asset details", "Modify model, brand, notes", "Changes saved, history recorded", "src/app/api/assets/[id]/route.ts", "Medium", "Manual"],
            ["Change asset location", "Update location field", "Location updated on asset", "src/app/api/assets/[id]/route.ts", "Medium", "Manual"]
        ],
        "Asset Status Rules": [
            ["IN_USE requires assignedMemberId (unless shared)", "Set status IN_USE without assignee", "Validation error if not shared", "src/features/assets/validations/assets.ts", "Critical", "Automated"],
            ["Shared assets can be IN_USE without assignee", "Create shared asset as IN_USE", "Allowed", "src/features/assets/validations/assets.ts", "High", "Automated"],
            ["DISPOSED status cannot be changed back", "Try to change DISPOSED to SPARE", "Error: cannot change disposed status", "src/app/api/assets/[id]/route.ts", "Critical", "Automated"],
            ["Assignment date cannot be before purchase date", "Set assignment before purchase", "Validation error", "src/features/assets/validations/assets.ts", "Critical", "Automated"],
            ["Status change records statusChangeDate", "Change asset status", "statusChangeDate updated", "src/app/api/assets/[id]/route.ts", "Medium", "Automated"],
            ["Status REPAIR", "Set status to REPAIR", "Asset marked as in repair", "src/app/api/assets/[id]/route.ts", "Medium", "Manual"],
            ["Status transitions valid", "SPAREâ†’IN_USEâ†’SPARE", "All valid transitions work", "src/app/api/assets/[id]/route.ts", "Medium", "Manual"]
        ],
        "Asset Assignment": [
            ["Admin can assign asset to member", "Admin assigns SPARE asset", "Asset assigned, status IN_USE", "src/app/api/assets/[id]/assign/route.ts", "Critical", "E2E"],
            ["Assign to employee with login requires approval", "Assign to canLogin=true user", "Creates PENDING_USER_ACCEPTANCE request", "src/app/api/assets/[id]/assign/route.ts", "Critical", "E2E"],
            ["Assign to employee without login is auto-accepted", "Assign to canLogin=false user", "Direct assignment, no approval needed", "src/app/api/assets/[id]/assign/route.ts", "Critical", "E2E"],
            ["Member must exist in same org", "Assign to member from other org", "Error: member not found", "src/app/api/assets/[id]/assign/route.ts", "Critical", "Automated"],
            ["Reassignment auto-unassigns previous", "Assign already assigned asset", "Previous member unassigned, new assigned", "src/app/api/assets/[id]/assign/route.ts", "High", "Automated"],
            ["Assignment creates history entry", "Assign asset", "AssetHistory record created", "src/features/assets/lib/asset-lifecycle.ts", "High", "Automated"],
            ["Assignment sends notification to assignee", "Assign asset to user with canLogin", "Notification sent", "src/lib/domains/system/notifications/notification-service.ts", "High", "Automated"],
            ["Cannot assign if pending request exists", "Assign while PENDING_USER_ACCEPTANCE exists", "409 Conflict error", "src/app/api/assets/[id]/assign/route.ts", "High", "Automated"],
            ["Employee accepts assignment", "Employee clicks Accept", "Asset status=IN_USE, assigned to employee", "src/app/api/asset-requests/[id]/accept/route.ts", "Critical", "E2E"],
            ["Employee declines assignment", "Employee clicks Decline with reason", "Asset stays SPARE, admins notified", "src/app/api/asset-requests/[id]/decline/route.ts", "High", "E2E"],
            ["Unassign asset (admin)", "Admin removes assignment", "Asset=SPARE, employee notified", "src/app/api/assets/[id]/assign/route.ts", "Medium", "Manual"],
            ["Assign to deleted employee", "Try assign to soft-deleted", "Error: Member not found", "src/app/api/assets/[id]/assign/route.ts", "Medium", "Manual"],
            ["Assign REPAIR status asset", "Try assign asset in REPAIR status", "Warning shown, can proceed", "src/app/api/assets/[id]/assign/route.ts", "Medium", "Manual"],
            ["Assign DISPOSED asset", "Try assign disposed asset", "Error: Cannot assign disposed asset", "src/app/api/assets/[id]/assign/route.ts", "Medium", "Manual"],
            ["Self-assign as admin", "Admin assigns to themselves", "Works with same flow", "src/app/api/assets/[id]/assign/route.ts", "Medium", "Manual"],
            ["Assignment date backdating", "Set assignment date in past", "Allowed for record correction", "src/app/api/assets/[id]/assign/route.ts", "Medium", "Manual"]
        ],
        "Asset Requests": [
            ["Employee can request SPARE asset", "Submit request for spare asset", "Request created as PENDING_ADMIN_APPROVAL", "src/app/api/asset-requests/route.ts", "High", "E2E"],
            ["Return request created successfully", "Submit return for assigned asset", "PENDING_RETURN_APPROVAL created", "src/app/api/asset-requests/route.ts", "High", "E2E"],
            ["General request without specific asset", "Submit general equipment request", "GENERAL_REQUEST created", "src/app/api/asset-requests/route.ts", "High", "E2E"],
            ["User can accept pending assignment", "Click accept on pending request", "Asset assigned, status ACCEPTED", "src/app/api/asset-requests/[id]/accept/route.ts", "Critical", "E2E"],
            ["User can decline pending assignment", "Click decline on pending request", "Request declined, asset back to SPARE", "src/app/api/asset-requests/[id]/decline/route.ts", "High", "E2E"],
            ["Duplicate pending request rejected", "Submit second request for same asset", "Error: already have pending request", "src/app/api/asset-requests/route.ts", "High", "Automated"],
            ["IDOR: Cannot request other tenant's asset", "Request with other org's asset ID", "404 Not Found", "src/app/api/asset-requests/route.ts", "Critical", "Automated"],
            ["Employee requests IN_USE asset", "Request already assigned asset", "Error: Asset not available", "src/app/api/asset-requests/route.ts", "High", "Manual"],
            ["Cancel own pending request", "Employee cancels before approval", "Request cancelled", "src/app/api/asset-requests/[id]/route.ts", "Medium", "Manual"],
            ["Request with reason/notes", "Add justification to request", "Notes saved and visible to approvers", "src/app/api/asset-requests/route.ts", "Medium", "Manual"],
            ["Admin approves employee request", "Admin approves", "Statusâ†’PENDING_USER_ACCEPTANCE", "src/app/api/asset-requests/[id]/approve/route.ts", "High", "E2E"],
            ["Admin rejects employee request", "Admin rejects with reason", "Request rejected, employee notified", "src/app/api/asset-requests/[id]/reject/route.ts", "High", "E2E"]
        ],
        "Asset Return Flow": [
            ["Employee requests return", "Employee initiates return", "PENDING_RETURN_APPROVAL created", "src/app/api/asset-requests/route.ts", "High", "E2E"],
            ["Admin approves return", "Admin approves return request", "Asset unassigned, status=SPARE", "src/app/api/asset-requests/[id]/approve/route.ts", "High", "E2E"],
            ["Admin rejects return", "Admin rejects return request", "Asset stays assigned to employee", "src/app/api/asset-requests/[id]/reject/route.ts", "High", "E2E"],
            ["Return non-assigned asset", "Try return SPARE asset", "Error: Asset not assigned to you", "src/app/api/asset-requests/route.ts", "Medium", "Manual"],
            ["Return someone else's asset", "User B tries to return A's asset", "Error: Not assigned to you", "src/app/api/asset-requests/route.ts", "Medium", "Manual"],
            ["Admin force unassign", "Admin unassigns without return request", "Direct unassign, employee notified", "src/app/api/assets/[id]/assign/route.ts", "Medium", "Manual"],
            ["Unassign with pending return", "Pending return exists, admin unassigns", "Return request cancelled, asset unassigned", "src/app/api/assets/[id]/assign/route.ts", "Medium", "Manual"]
        ],
        "Asset Search & Filtering": [
            ["Search by asset tag", "Search with partial tag", "Matching assets returned", "src/app/api/assets/route.ts", "High", "Automated"],
            ["Search by model", "Search with model name", "Matching assets returned", "src/app/api/assets/route.ts", "High", "Automated"],
            ["Search by serial number", "Search with serial", "Matching assets returned", "src/app/api/assets/route.ts", "Medium", "Automated"],
            ["Filter by status", "Filter status=SPARE", "Only SPARE assets shown", "src/app/api/assets/route.ts", "High", "Automated"],
            ["Filter by category", "Filter by category ID", "Only that category shown", "src/app/api/assets/route.ts", "High", "Automated"],
            ["Pagination works correctly", "Request page 2 with limit 10", "Correct items returned", "src/app/api/assets/route.ts", "Medium", "Automated"],
            ["Sort by various fields", "Sort by purchaseDate desc", "Correctly ordered results", "src/app/api/assets/route.ts", "Medium", "Automated"],
            ["Combine multiple filters", "Status + Category + Type", "Intersection of filters", "src/app/admin/(operations)/assets/page.tsx", "Medium", "Manual"],
            ["Clear all filters", "Reset filters", "Shows all assets", "src/app/admin/(operations)/assets/page.tsx", "Medium", "Manual"]
        ],
        "Asset Depreciation": [
            ["Assign depreciation category to asset", "Select category for asset", "Category assigned, depreciation calculated", "src/features/assets/lib/depreciation/calculator.ts", "High", "Automated"],
            ["Straight-line depreciation calculation", "View depreciation for assigned asset", "Formula: (cost - salvage) / years", "src/features/assets/lib/depreciation/calculator.ts", "High", "Automated"],
            ["Book value never below salvage", "View fully depreciated asset", "Book value = salvage value (not negative)", "src/features/assets/lib/depreciation/calculator.ts", "Critical", "Automated"],
            ["Pro-rata first month calculation", "Asset purchased mid-month", "First month pro-rated", "src/features/assets/lib/depreciation/calculator.ts", "High", "Automated"],
            ["View depreciation schedule", "Click depreciation tab on asset", "Monthly schedule displayed", "src/app/api/assets/[id]/depreciation/route.ts", "Medium", "E2E"],
            ["Depreciation cron runs monthly", "Wait for cron job", "Depreciation records created", "src/app/api/cron/depreciation/route.ts", "High", "Manual"],
            ["Change depreciation category", "Update category on asset", "Recalculates from purchase date", "src/app/api/assets/[id]/route.ts", "Medium", "Manual"],
            ["No depreciation category", "Asset without depreciation settings", "No depreciation calculated", "src/features/assets/lib/depreciation/calculator.ts", "Medium", "Automated"]
        ],
        "Asset Disposal": [
            ["Dispose asset as SOLD", "Select SOLD, enter proceeds", "Gain/loss calculated, status DISPOSED", "src/features/assets/lib/depreciation/disposal.ts", "High", "Automated"],
            ["SOLD requires proceeds > 0", "SOLD without proceeds", "Validation error", "src/features/assets/lib/depreciation/disposal.ts", "High", "Automated"],
            ["Dispose as SCRAPPED", "Select SCRAPPED", "Asset disposed, no proceeds required", "src/features/assets/lib/depreciation/disposal.ts", "High", "Automated"],
            ["Dispose as DONATED", "Select DONATED", "Asset disposed, no proceeds required", "src/features/assets/lib/depreciation/disposal.ts", "High", "Automated"],
            ["Dispose as WRITTEN_OFF", "Select WRITTEN_OFF", "Records write-off for lost/stolen/obsolete assets", "src/features/assets/lib/depreciation/disposal.ts", "High", "Automated"],
            ["Disposal calculates gain/loss", "Dispose asset with proceeds", "Gain = Proceeds - NBV displayed", "src/features/assets/lib/depreciation/disposal.ts", "High", "Automated"],
            ["Future disposal date rejected", "Enter future date for disposal", "Validation error", "src/features/assets/lib/depreciation/disposal.ts", "High", "Automated"],
            ["Already disposed asset cannot be disposed", "Try to dispose DISPOSED asset", "Error: already disposed", "src/app/api/assets/[id]/dispose/route.ts", "High", "Automated"],
            ["Dispose assigned asset", "Try dispose IN_USE asset", "Must unassign first or confirm", "src/app/api/assets/[id]/dispose/route.ts", "Medium", "Manual"],
            ["Disposed asset in reports", "Check disposed assets report", "Shows in disposed list, not active", "src/app/admin/(operations)/assets/page.tsx", "Medium", "Manual"]
        ],
        "Asset Import/Export": [
            ["Export assets to CSV", "Click export button", "CSV file downloaded with all fields", "src/app/api/assets/export/route.ts", "High", "E2E"],
            ["Import assets from CSV", "Upload valid CSV file", "Assets created from data", "src/app/api/assets/import/route.ts", "High", "E2E"],
            ["Import validates required fields", "Upload CSV missing type column", "Validation errors with row numbers", "src/features/assets/lib/asset-import.ts", "High", "Automated"],
            ["Import handles 500+ records", "Upload large CSV", "All records processed", "src/features/assets/lib/asset-import.ts", "Medium", "Manual"],
            ["Import preview", "Upload CSV", "Shows preview before import", "src/app/admin/(operations)/assets/page.tsx", "Medium", "Manual"],
            ["Partial import", "Some rows invalid", "Valid rows imported, errors shown", "src/features/assets/lib/asset-import.ts", "Medium", "Manual"],
            ["Export filtered", "Filter then export", "Only filtered assets exported", "src/app/api/assets/export/route.ts", "Medium", "Manual"]
        ],
        "Asset Clone": [
            ["Clone asset creates new with unique tag", "Click clone on asset", "New asset with new tag, no serial", "src/app/api/assets/[id]/clone/route.ts", "Medium", "E2E"],
            ["Clone clears assignment", "Clone IN_USE asset", "Clone is SPARE, not assigned", "src/app/api/assets/[id]/clone/route.ts", "Medium", "Automated"],
            ["Clone clears serial", "Clone asset with serial number", "Clone has no serial (must be unique)", "src/app/api/assets/[id]/clone/route.ts", "Medium", "Automated"],
            ["Clone disposed asset", "Clone DISPOSED asset", "Clone created as SPARE", "src/app/api/assets/[id]/clone/route.ts", "Medium", "Manual"],
            ["Clone preserves category", "Clone asset", "Same type, auto-generated new tag", "src/app/api/assets/[id]/clone/route.ts", "Medium", "Automated"]
        ],
        "Asset Utilization": [
            ["View utilization", "Check asset utilization tab", "Shows usage stats", "src/app/api/assets/[id]/utilization/route.ts", "Medium", "E2E"],
            ["Utilization percentage", "Check percentage calculation", "Calculated correctly based on assignment history", "src/app/api/assets/[id]/utilization/route.ts", "Medium", "Automated"],
            ["Idle assets", "Filter unassigned assets", "Shows SPARE assets", "src/app/api/assets/route.ts", "Medium", "Manual"]
        ],
        "Asset Categories": [
            ["Category name required", "Leave name empty", "Validation error", "src/app/api/asset-categories/route.ts", "Medium", "Automated"],
            ["Duplicate category name", "Use existing name", "Error: name already exists", "src/app/api/asset-categories/route.ts", "Medium", "Automated"],
            ["Delete category with assets", "Delete category that has assets", "Error or reassign prompt", "src/app/api/asset-categories/[id]/route.ts", "Medium", "Manual"]
        ],
        "Depreciation Categories": [
            ["Set useful life years", "Enter useful life for category", "Saved correctly", "src/app/api/depreciation/categories/route.ts", "Medium", "Manual"],
            ["Set salvage value percentage", "Enter salvage value", "Saved and used in calculations", "src/app/api/depreciation/categories/route.ts", "Medium", "Manual"]
        ],
        "Asset Notifications": [
            ["Assignment notification", "Assign asset", "Employee receives notification", "src/lib/domains/system/notifications/notification-service.ts", "Medium", "Manual"],
            ["Unassignment notification", "Unassign asset", "Employee notified of removal", "src/lib/domains/system/notifications/notification-service.ts", "Medium", "Manual"]
        ],
        "Deleted Assets (Soft Delete)": [
            ["View deleted assets", "Navigate to /admin/assets/deleted", "Shows deleted assets", "src/app/admin/(operations)/assets/deleted/page.tsx", "Medium", "Manual"],
            ["Restore asset", "Click restore", "Asset restored to active list", "src/app/api/assets/[id]/restore/route.ts", "Medium", "E2E"],
            ["Permanent delete", "Click permanent delete", "Asset gone forever", "src/app/api/assets/[id]/route.ts", "Medium", "Manual"],
            ["Auto cleanup", "After 30 days", "Automatically purged by cron", "src/app/api/cron/cleanup-deleted-assets/route.ts", "Medium", "Manual"],
            ["Search deleted", "Search in trash", "Finds deleted items", "src/app/admin/(operations)/assets/deleted/page.tsx", "Medium", "Manual"],
            ["Cannot delete assigned asset", "Try to delete IN_USE asset", "Error: Must unassign asset first", "src/app/api/assets/[id]/route.ts", "High", "Automated"],
            ["Cannot delete asset with pending request", "Try to delete asset with PENDING request", "Error: Asset has pending requests", "src/app/api/assets/[id]/route.ts", "High", "Automated"]
        ]
    },
    "7. Subscriptions Module": {
        "Subscription Creation": [
            ["Service name required (1-255 chars)", "Create without service name", "Validation error: serviceName required", "src/features/subscriptions/validations/subscriptions.ts", "Critical", "Automated"],
            ["Billing cycle required", "Create without billing cycle", "Validation error: billingCycle required", "src/features/subscriptions/validations/subscriptions.ts", "Critical", "Automated"],
            ["Purchase date required", "Create without purchase date", "Validation error: purchaseDate required", "src/features/subscriptions/validations/subscriptions.ts", "Critical", "Automated"],
            ["Renewal date must be after purchase date", "Set renewal before purchase", "Validation error: renewalDate must be after purchaseDate", "src/features/subscriptions/validations/subscriptions.ts", "Critical", "Automated"],
            ["Assignment date cannot be before purchase date", "Set assignment date before purchase date", "Validation error: assignmentDate cannot be before purchaseDate", "src/features/subscriptions/validations/subscriptions.ts", "Critical", "Automated"],
            ["Assigned member required", "Create without assignee", "Validation error: assignedMemberId required", "src/features/subscriptions/validations/subscriptions.ts", "Critical", "Automated"],
            ["Cost must be positive if provided", "Enter negative cost", "Validation error: cost must be positive", "src/features/subscriptions/validations/subscriptions.ts", "High", "Automated"],
            ["Zero-cost subscription rejected", "Create with cost = 0", "Validation error: cost must be positive or omitted", "src/features/subscriptions/validations/subscriptions.ts", "High", "Automated"],
            ["Currency required when cost provided", "Enter cost without currency", "Validation error: currency required", "src/features/subscriptions/validations/subscriptions.ts", "High", "Automated"],
            ["Currency conversion to QAR", "Enter cost in USD", "costQAR auto-calculated using exchange rates", "src/lib/core/currency.ts", "High", "Automated"],
            ["Subscription tag auto-generated", "Create subscription", "Tag: ORG-SUB-YYMM-SEQ (e.g., BCE-SUB-2501-001)", "src/features/subscriptions/lib/subscription-utils.ts", "High", "Automated"],
            ["Category autocomplete API", "Type in category field", "GET /api/subscriptions/categories returns existing categories", "src/app/api/subscriptions/categories/route.ts", "Medium", "Automated"],
            ["Valid status on create", "Create subscription", "Status defaults to ACTIVE", "src/app/api/subscriptions/route.ts", "High", "Automated"],
            ["History entry on create", "Create subscription", "SubscriptionHistory entry with action=CREATE", "src/app/api/subscriptions/route.ts", "Medium", "Automated"],
            ["Notes field optional", "Create without notes", "Subscription created successfully", "src/features/subscriptions/validations/subscriptions.ts", "Low", "Automated"],
            ["Vendor name optional", "Create without vendor", "Subscription created successfully", "src/features/subscriptions/validations/subscriptions.ts", "Low", "Automated"],
            ["Create form UI loads correctly", "Navigate to /admin/subscriptions/new", "Form displays all fields with proper labels", "src/app/admin/(operations)/subscriptions/new/page.tsx", "Medium", "Manual"]
        ],
        "Subscription Updates": [
            ["Edit page loads subscription data", "Navigate to /admin/subscriptions/[id]/edit", "Form pre-filled with existing data", "src/app/admin/(operations)/subscriptions/[id]/edit/page.tsx", "High", "Manual"],
            ["Service name can be updated", "Edit service name", "Name updated, UPDATED history entry created", "src/app/api/subscriptions/[id]/route.ts", "High", "Automated"],
            ["Cost change triggers QAR recalculation", "Change cost from USD 100 to USD 200", "costQAR recalculated automatically", "src/lib/core/currency.ts", "High", "Automated"],
            ["Currency change triggers QAR recalculation", "Change currency from USD to EUR", "costQAR recalculated for new currency", "src/lib/core/currency.ts", "High", "Automated"],
            ["Renewal date can be updated", "Change renewal date", "Date updated successfully", "src/app/api/subscriptions/[id]/route.ts", "High", "Automated"],
            ["Assigned member can be changed", "Change assignedMemberId", "Member updated, REASSIGNED history entry created", "src/app/api/subscriptions/[id]/route.ts", "High", "Automated"],
            ["Billing cycle can be changed", "Change from MONTHLY to YEARLY", "Cycle updated successfully", "src/app/api/subscriptions/[id]/route.ts", "Medium", "Automated"],
            ["Category can be updated", "Change category", "Category updated", "src/app/api/subscriptions/[id]/route.ts", "Medium", "Automated"],
            ["Vendor can be updated", "Change vendor name", "Vendor updated", "src/app/api/subscriptions/[id]/route.ts", "Medium", "Automated"],
            ["Notes can be updated", "Add or change notes", "Notes saved", "src/app/api/subscriptions/[id]/route.ts", "Low", "Automated"],
            ["Validation applies on update", "Update with invalid data", "Validation errors returned", "src/app/api/subscriptions/[id]/route.ts", "High", "Automated"],
            ["Cannot update non-existent subscription", "PUT /api/subscriptions/[invalid-id]", "404 Not Found", "src/app/api/subscriptions/[id]/route.ts", "High", "Automated"]
        ],
        "Subscription Lifecycle - Cancel": [
            ["ACTIVE subscription can be cancelled", "Cancel active subscription", "Status = CANCELLED, cancelledAt set", "src/features/subscriptions/lib/subscription-lifecycle.ts", "Critical", "Automated"],
            ["Cannot cancel already CANCELLED", "Cancel cancelled subscription", "Error: Subscription is already cancelled", "src/features/subscriptions/lib/subscription-lifecycle.ts", "High", "Automated"],
            ["Cancel dialog requires cancellation date", "Open cancel dialog, leave date empty", "Cannot submit without date", "src/app/admin/(operations)/subscriptions/[id]/page.tsx", "High", "Manual"],
            ["Cancel dialog cancellation date required", "Submit cancel without date", "Validation error: cancellationDate required", "src/app/api/subscriptions/[id]/cancel/route.ts", "High", "Automated"],
            ["Cancellation reason optional", "Cancel without reason", "Subscription cancelled, reason null", "src/app/api/subscriptions/[id]/cancel/route.ts", "Medium", "Automated"],
            ["Cancellation reason saved when provided", "Cancel with reason text", "Reason saved to subscription and history", "src/app/api/subscriptions/[id]/cancel/route.ts", "Medium", "Automated"],
            ["History entry created on cancel", "Cancel subscription", "SubscriptionHistory entry with action=CANCELLED", "src/features/subscriptions/lib/subscription-lifecycle.ts", "High", "Automated"],
            ["Cancel button only shown for ACTIVE", "View CANCELLED subscription detail", "Cancel button not visible", "src/app/admin/(operations)/subscriptions/[id]/page.tsx", "Medium", "Manual"]
        ],
        "Subscription Lifecycle - Reactivate": [
            ["CANCELLED can be reactivated", "Reactivate cancelled subscription", "Status = ACTIVE, cancelledAt cleared", "src/features/subscriptions/lib/subscription-lifecycle.ts", "Critical", "Automated"],
            ["Cannot reactivate ACTIVE", "Reactivate active subscription", "Error: Subscription is already active", "src/features/subscriptions/lib/subscription-lifecycle.ts", "High", "Automated"],
            ["Reactivate dialog requires new renewal date", "Open reactivate dialog, leave date empty", "Cannot submit without renewalDate", "src/app/admin/(operations)/subscriptions/[id]/page.tsx", "High", "Manual"],
            ["Reactivate sets new renewal date", "Reactivate with renewalDate", "renewalDate updated to new value", "src/app/api/subscriptions/[id]/reactivate/route.ts", "High", "Automated"],
            ["Reactivation notes optional", "Reactivate without notes", "Subscription reactivated, notes null", "src/app/api/subscriptions/[id]/reactivate/route.ts", "Medium", "Automated"],
            ["Reactivation notes saved when provided", "Reactivate with notes", "Notes saved to history entry", "src/app/api/subscriptions/[id]/reactivate/route.ts", "Medium", "Automated"],
            ["History entry created on reactivate", "Reactivate subscription", "SubscriptionHistory entry with action=REACTIVATED", "src/features/subscriptions/lib/subscription-lifecycle.ts", "High", "Automated"],
            ["Reactivate button only shown for CANCELLED", "View ACTIVE subscription detail", "Reactivate button not visible", "src/app/admin/(operations)/subscriptions/[id]/page.tsx", "Medium", "Manual"],
            ["Cancellation reason cleared on reactivate", "Reactivate subscription", "cancellationReason set to null", "src/features/subscriptions/lib/subscription-lifecycle.ts", "Medium", "Automated"]
        ],
        "Billing Cycles": [
            ["MONTHLY subscription renewal calculation", "Create monthly subscription", "Renewal date = purchaseDate + 1 month", "src/features/subscriptions/utils/renewal-date.ts", "High", "Automated"],
            ["YEARLY subscription renewal calculation", "Create yearly subscription", "Renewal date = purchaseDate + 1 year", "src/features/subscriptions/utils/renewal-date.ts", "High", "Automated"],
            ["ONE_TIME subscription no auto-renewal", "Create one-time subscription", "Renewal date optional, no recurring", "src/features/subscriptions/utils/renewal-date.ts", "Medium", "Automated"],
            ["Billing cycle displayed on list", "View subscription list", "Shows billing cycle badge (Monthly/Yearly/etc)", "src/app/admin/(operations)/subscriptions/page.tsx", "Medium", "Manual"],
            ["Billing cycle displayed on detail", "View subscription detail", "Shows billing cycle in details section", "src/app/admin/(operations)/subscriptions/[id]/page.tsx", "Medium", "Manual"],
            ["Filter by MONTHLY cycle", "Filter billingCycle=MONTHLY", "Only monthly subscriptions shown", "src/app/api/subscriptions/route.ts", "Medium", "Automated"],
            ["Filter by ONE_TIME cycle", "Filter billingCycle=ONE_TIME", "Only one-time subscriptions shown", "src/app/api/subscriptions/route.ts", "Medium", "Automated"]
        ],
        "Search and Filtering": [
            ["Search by service name", "Search 'Microsoft 365'", "Matching subscriptions returned", "src/app/api/subscriptions/route.ts", "High", "Automated"],
            ["Search by vendor name", "Search 'Adobe'", "Subscriptions with vendor Adobe returned", "src/app/api/subscriptions/route.ts", "High", "Automated"],
            ["Search by subscription tag", "Search 'BCE-SUB-2501'", "Matching subscription returned", "src/app/api/subscriptions/route.ts", "High", "Automated"],
            ["Search case-insensitive", "Search 'MICROSOFT' or 'microsoft'", "Same results returned", "src/app/api/subscriptions/route.ts", "Medium", "Automated"],
            ["Filter by status ACTIVE", "Filter status=ACTIVE", "Only active subscriptions shown", "src/app/api/subscriptions/route.ts", "High", "Automated"],
            ["Filter by status CANCELLED", "Filter status=CANCELLED", "Only cancelled subscriptions shown", "src/app/api/subscriptions/route.ts", "High", "Automated"],
            ["Filter by category", "Filter category='Software'", "Only matching category shown", "src/app/api/subscriptions/route.ts", "Medium", "Automated"],
            ["Filter by renewal window", "Filter renewalWindowDays=30", "Subscriptions renewing in 30 days", "src/app/api/subscriptions/route.ts", "High", "Automated"],
            ["Filters API returns filter options", "GET /api/subscriptions/filters", "Returns categories, statuses, billing cycles", "src/app/api/subscriptions/filters/route.ts", "Medium", "Automated"],
            ["Sort by renewal date ascending", "Sort sortBy=renewalDate&sortOrder=asc", "ACTIVE first (nearest renewals), CANCELLED last", "src/app/api/subscriptions/route.ts", "Medium", "Automated"],
            ["Sort by renewal date descending", "Sort sortBy=renewalDate&sortOrder=desc", "ACTIVE first (furthest renewals), CANCELLED last", "src/app/api/subscriptions/route.ts", "Medium", "Automated"],
            ["Sort by cost descending", "Sort sortBy=cost&sortOrder=desc", "ACTIVE first (highest cost), CANCELLED last", "src/app/api/subscriptions/route.ts", "Medium", "Automated"],
            ["Pagination works correctly", "Request page=2&limit=10", "Returns correct page of results", "src/app/api/subscriptions/route.ts", "Medium", "Automated"],
            ["Clear all filters", "Reset all filter controls", "Shows all subscriptions", "src/app/admin/(operations)/subscriptions/page.tsx", "Medium", "Manual"],
            ["Combined filters work", "Filter status=ACTIVE AND category=Software", "Only matching subscriptions shown", "src/app/api/subscriptions/route.ts", "Medium", "Automated"]
        ],
        "Import/Export": [
            ["Export subscriptions to CSV", "Click export button", "CSV file downloaded with all fields", "src/app/api/subscriptions/export/route.ts", "High", "E2E"],
            ["Export includes all columns", "Check exported CSV", "Contains: serviceName, vendor, cost, currency, billingCycle, dates, etc", "src/app/api/subscriptions/export/route.ts", "Medium", "Manual"],
            ["Export respects current filters", "Filter then export", "Only filtered subscriptions exported", "src/app/api/subscriptions/export/route.ts", "Medium", "Automated"],
            ["Download import template", "Click template button", "CSV template downloaded with headers", "src/app/admin/(operations)/subscriptions/page.tsx", "Medium", "Manual"],
            ["Import valid CSV", "Upload valid CSV file", "Subscriptions created successfully", "src/app/api/subscriptions/import/route.ts", "High", "E2E"],
            ["Import with missing required fields", "Upload CSV missing serviceName", "Row error: serviceName required", "src/features/subscriptions/lib/subscription-import.ts", "High", "Automated"],
            ["Import with invalid dates", "Upload CSV with invalid date format", "Row error: invalid date format", "src/features/subscriptions/lib/subscription-import.ts", "High", "Automated"],
            ["Import with invalid billing cycle", "Upload CSV with billingCycle=WEEKLY", "Row error: invalid billingCycle", "src/features/subscriptions/lib/subscription-import.ts", "Medium", "Automated"],
            ["Import shows row-by-row errors", "Upload CSV with some invalid rows", "Shows which rows failed and why", "src/app/admin/(operations)/subscriptions/page.tsx", "Medium", "Manual"],
            ["Import assigns tenant ID", "Import subscriptions", "All imported subscriptions have correct tenantId", "src/app/api/subscriptions/import/route.ts", "Critical", "Automated"],
            ["Import generates tags", "Import subscriptions", "Tags auto-generated for each subscription", "src/app/api/subscriptions/import/route.ts", "High", "Automated"]
        ],
        "Cost Tracking": [
            ["Cost displayed in original currency", "View subscription with USD cost", "Shows '$100 USD'", "src/app/admin/(operations)/subscriptions/[id]/page.tsx", "Medium", "Manual"],
            ["QAR equivalent displayed", "View subscription with USD cost", "Shows QAR equivalent amount", "src/app/admin/(operations)/subscriptions/[id]/page.tsx", "Medium", "Manual"],
            ["Exchange rate applied correctly", "Create USD subscription", "costQAR = cost * USD_TO_QAR rate", "src/lib/core/currency.ts", "High", "Automated"],
            ["QAR subscriptions no conversion", "Create QAR subscription", "costQAR = cost (1:1)", "src/lib/core/currency.ts", "High", "Automated"],
            ["Monthly cost summary on list page", "View subscription list", "Shows total monthly cost", "src/app/admin/(operations)/subscriptions/page.tsx", "Medium", "Manual"],
            ["Annual cost projection", "View subscription list", "Shows annual projection based on billing cycles", "src/app/admin/(operations)/subscriptions/page.tsx", "Medium", "Manual"],
            ["Cost included in active count only", "View cost summary", "Only ACTIVE subscriptions in totals", "src/app/api/subscriptions/route.ts", "High", "Automated"],
            ["Cost update triggers recalculation", "Update subscription cost", "costQAR recalculated", "src/app/api/subscriptions/[id]/route.ts", "High", "Automated"],
            ["Null cost handled", "Create subscription without cost", "cost and costQAR both null", "src/app/api/subscriptions/route.ts", "Medium", "Automated"],
            ["Cost filtering works", "Filter by cost range", "Only subscriptions in range shown", "src/app/api/subscriptions/route.ts", "Low", "Automated"]
        ],
        "Subscription Assignment": [
            ["Subscription requires assigned member", "Create without assignedMemberId", "Validation error", "src/features/subscriptions/validations/subscriptions.ts", "Critical", "Automated"],
            ["Assigned member must exist", "Assign to non-existent member ID", "Error: Member not found", "src/app/api/subscriptions/route.ts", "High", "Automated"],
            ["Assigned member must be in same tenant", "Assign to member from different tenant", "Error: Member not found", "src/app/api/subscriptions/route.ts", "Critical", "Automated"],
            ["Assignment date tracked", "Create subscription with assignment", "assignmentDate saved", "src/app/api/subscriptions/route.ts", "Medium", "Automated"],
            ["Reassignment creates history", "Change assigned member", "History entry with action=REASSIGNED", "src/app/api/subscriptions/[id]/route.ts", "High", "Automated"],
            ["View assigned member name", "View subscription detail", "Shows assigned member's name", "src/app/admin/(operations)/subscriptions/[id]/page.tsx", "Medium", "Manual"],
            ["Member dropdown shows tenant users", "Open assignment dropdown", "Shows only users in current tenant", "src/app/admin/(operations)/subscriptions/new/page.tsx", "High", "Manual"]
        ],
        "Employee View": [
            ["Employee can access subscriptions page", "Navigate to /employee/subscriptions", "Page loads successfully", "src/app/employee/(operations)/subscriptions/page.tsx", "High", "E2E"],
            ["Employee sees all subscriptions read-only", "View as employee", "All subscriptions visible, no edit/delete buttons", "src/app/employee/(operations)/subscriptions/page.tsx", "High", "Manual"],
            ["Employee cannot access create page", "Navigate to /employee/subscriptions/new", "Redirect or 403", "src/middleware.ts", "Critical", "Automated"],
            ["Employee cannot access edit page", "Navigate to /employee/subscriptions/[id]/edit", "Redirect or 403", "src/middleware.ts", "Critical", "Automated"],
            ["Employee can filter by 'My Subscriptions'", "Toggle 'My Subscriptions' filter", "Only subscriptions assigned to employee shown", "src/app/employee/(operations)/subscriptions/page.tsx", "Medium", "Manual"],
            ["Employee can search subscriptions", "Search by service name", "Matching subscriptions shown", "src/app/employee/(operations)/subscriptions/page.tsx", "Medium", "Manual"],
            ["Employee can view subscription detail", "Click on subscription row", "Detail page shows read-only view", "src/app/employee/(operations)/subscriptions/[id]/page.tsx", "Medium", "Manual"],
            ["Employee detail page no action buttons", "View subscription detail as employee", "No Cancel/Reactivate/Edit/Delete buttons", "src/app/employee/(operations)/subscriptions/[id]/page.tsx", "High", "Manual"],
            ["Employee can see assigned member name", "View subscription detail", "Shows who subscription is assigned to", "src/app/employee/(operations)/subscriptions/[id]/page.tsx", "Low", "Manual"],
            ["Employee pagination works", "Navigate pages as employee", "Pagination functions correctly", "src/app/employee/(operations)/subscriptions/page.tsx", "Medium", "Manual"]
        ],
        "Renewal Date Calculations": [
            ["calculateRenewalDate for MONTHLY", "Call with MONTHLY cycle", "Returns date + 1 month", "src/features/subscriptions/utils/renewal-date.ts", "High", "Automated"],
            ["calculateRenewalDate for YEARLY", "Call with YEARLY cycle", "Returns date + 1 year", "src/features/subscriptions/utils/renewal-date.ts", "High", "Automated"],
            ["calculateRenewalDate for ONE_TIME", "Call with ONE_TIME cycle", "Returns null (no renewal)", "src/features/subscriptions/utils/renewal-date.ts", "Medium", "Automated"],
            ["Month-end handling", "Calculate from Jan 31 + 1 month", "Returns Feb 28/29 (handles short months)", "src/features/subscriptions/utils/renewal-date.ts", "Medium", "Automated"],
            ["Leap year handling", "Calculate from Feb 29 + 1 year", "Returns Feb 28 next year", "src/features/subscriptions/utils/renewal-date.ts", "Low", "Automated"],
            ["Renewal date displayed on list", "View subscription list", "Shows renewal date column", "src/app/admin/(operations)/subscriptions/page.tsx", "Medium", "Manual"]
        ],
        "Access Control": [
            ["Admin can create subscriptions", "Create as admin", "Subscription created", "src/app/api/subscriptions/route.ts", "Critical", "Automated"],
            ["Admin can edit subscriptions", "Edit as admin", "Subscription updated", "src/app/api/subscriptions/[id]/route.ts", "Critical", "Automated"],
            ["Admin can delete subscriptions", "Delete as admin", "Subscription deleted", "src/app/api/subscriptions/[id]/route.ts", "Critical", "Automated"],
            ["Admin can cancel subscriptions", "Cancel as admin", "Subscription cancelled", "src/app/api/subscriptions/[id]/cancel/route.ts", "Critical", "Automated"],
            ["Employee cannot create subscriptions", "POST /api/subscriptions as employee", "403 Forbidden", "src/app/api/subscriptions/route.ts", "Critical", "Automated"],
            ["Employee cannot delete subscriptions", "DELETE /api/subscriptions/[id] as employee", "403 Forbidden", "src/app/api/subscriptions/[id]/route.ts", "Critical", "Automated"],
            ["Tenant isolation on read", "Query subscriptions", "Only current tenant's subscriptions returned", "src/app/api/subscriptions/route.ts", "Critical", "Automated"],
            ["Tenant isolation on write", "Create subscription", "tenantId automatically set to current tenant", "src/app/api/subscriptions/route.ts", "Critical", "Automated"]
        ],
        "Subscription Deletion": [
            ["Soft delete sets deletedAt", "Delete subscription", "deletedAt timestamp set, deletedById set", "src/app/api/subscriptions/[id]/route.ts", "High", "Automated"],
            ["Soft deleted subscriptions hidden from list", "List subscriptions after delete", "Deleted subscription not shown", "src/app/api/subscriptions/route.ts", "High", "Automated"],
            ["Delete returns recovery deadline", "Delete subscription", "Response includes 7-day recovery deadline", "src/app/api/subscriptions/[id]/route.ts", "Medium", "Automated"],
            ["Delete confirmation required", "Click delete button", "Confirmation dialog shown", "src/app/admin/(operations)/subscriptions/[id]/page.tsx", "Medium", "Manual"],
            ["Cannot delete non-existent subscription", "DELETE /api/subscriptions/[invalid-id]", "404 Not Found", "src/app/api/subscriptions/[id]/route.ts", "Medium", "Automated"],
            ["Cannot delete already deleted subscription", "Delete same subscription twice", "404 Not Found (already in trash)", "src/app/api/subscriptions/[id]/route.ts", "Medium", "Automated"],
            ["List deleted subscriptions", "GET /api/subscriptions/deleted", "Returns deleted subscriptions with recovery info", "src/app/api/subscriptions/deleted/route.ts", "High", "Automated"],
            ["Restore deleted subscription", "POST /api/subscriptions/[id]/restore", "Subscription restored, deletedAt cleared", "src/app/api/subscriptions/[id]/restore/route.ts", "High", "Automated"],
            ["Cannot restore non-deleted subscription", "Restore active subscription", "404 Not Found", "src/app/api/subscriptions/[id]/restore/route.ts", "Medium", "Automated"],
            ["Permanent delete from trash", "DELETE /api/subscriptions/[id]/permanent-delete", "Subscription and history permanently removed", "src/app/api/subscriptions/[id]/permanent-delete/route.ts", "High", "Automated"],
            ["Permanent delete only for trashed", "Permanent delete active subscription", "404 Must be in trash first", "src/app/api/subscriptions/[id]/permanent-delete/route.ts", "Medium", "Automated"]
        ]
    },
    "8. Suppliers Module": {
        "Supplier Creation": [
            ["Name required", "Create without name", "Validation error", "src/features/suppliers/validations/suppliers.ts", "Critical", "Automated"],
            ["Category required", "Create without category", "Validation error", "src/features/suppliers/validations/suppliers.ts", "Critical", "Automated"],
            ["Website domain format validation", "Enter invalid website", "Validation error", "src/features/suppliers/validations/suppliers.ts", "High", "Automated"],
            ["Valid website formats accepted", "Enter example.com or https://example.com", "Accepted", "src/features/suppliers/validations/suppliers.ts", "High", "Automated"],
            ["Establishment year: 1800 to current", "Enter year 1799", "Validation error", "src/features/suppliers/validations/suppliers.ts", "Medium", "Automated"],
            ["Email format validation", "Enter invalid email", "Validation error", "src/features/suppliers/validations/suppliers.ts", "High", "Automated"],
            ["Supplier code auto-generated", "Create supplier", "Code: ORG-SUP-YYMMDD-SEQ", "src/features/suppliers/lib/code.ts", "High", "Automated"],
            ["Status defaults to PENDING", "Create supplier", "Status = PENDING until approved", "src/app/api/suppliers/register/route.ts", "High", "Automated"]
        ],
        "Supplier Approval Workflow": [
            ["Admin can approve pending supplier", "Click approve on pending", "Status = APPROVED, approvedAt set", "src/app/api/suppliers/[id]/approve/route.ts", "High", "E2E"],
            ["Admin can reject pending supplier", "Click reject with reason", "Status = REJECTED, reason saved", "src/app/api/suppliers/[id]/reject/route.ts", "High", "E2E"],
            ["Rejection reason required", "Reject without reason", "Validation error", "src/app/api/suppliers/[id]/reject/route.ts", "High", "Automated"],
            ["Cannot approve already approved", "Approve approved supplier", "Error: already approved", "src/app/api/suppliers/[id]/approve/route.ts", "Medium", "Automated"]
        ],
        "Supplier Visibility": [
            ["Employee sees only APPROVED suppliers", "List suppliers as employee", "Only approved shown", "src/app/api/suppliers/route.ts", "High", "Automated"],
            ["Admin sees all suppliers", "List suppliers as admin", "All statuses shown", "src/app/api/suppliers/route.ts", "High", "Automated"],
            ["Filter by status (admin)", "Filter status=PENDING", "Only pending shown", "src/app/api/suppliers/route.ts", "Medium", "Automated"]
        ],
        "Supplier Engagements": [
            ["Create engagement record", "Add engagement with notes", "Engagement created with date", "src/app/api/suppliers/[id]/engagements/route.ts", "Medium", "E2E"],
            ["Rating 1-5 stars", "Set rating to 6", "Validation error", "src/app/api/suppliers/[id]/engagements/route.ts", "Low", "Automated"],
            ["View engagement history", "Click supplier, view engagements", "All engagements listed", "src/app/api/suppliers/[id]/route.ts", "Medium", "E2E"],
            ["View engagements", "Check supplier engagements", "Shows engagement list", "src/app", "Medium", "Manual"],
            ["Add engagement", "Create engagement", "Engagement added", "src/app", "Medium", "Manual"],
            ["Engagement dates", "Set start/end dates", "Dates saved", "src/app", "Medium", "Manual"],
            ["Engagement value", "Enter contract value", "Value saved", "src/app", "Medium", "Manual"],
            ["Engagement status", "Update status", "Status changed", "src/app", "Medium", "Manual"],
            ["Total engagement value", "View supplier", "Shows total value", "src/app", "Medium", "Manual"]
        ],
        "Supplier Management": [
            ["Create supplier", "Name, contact info", "Created with PENDING status", "src/app", "Medium", "Manual"],
            ["No contact info", "No email AND no phone", "Validation error", "src/app", "Medium", "Manual"],
            ["Approve supplier", "Admin approves", "Status = APPROVED", "src/app", "Medium", "Manual"],
            ["Reject supplier", "Admin rejects", "Status = REJECTED", "src/app", "Medium", "Manual"],
            ["Employee view", "Employee lists suppliers", "Only sees APPROVED", "src/app", "Medium", "Manual"],
            ["Admin view", "Admin lists suppliers", "Sees all statuses", "src/app", "Medium", "Manual"],
            ["Edit supplier", "Update supplier info", "Changes saved", "src/app", "Medium", "Manual"],
            ["Delete supplier", "Remove supplier", "Supplier deleted", "src/app", "Medium", "Manual"],
            ["View supplier details", "Click supplier", "Shows detail page", "src/app", "Medium", "Manual"]
        ],
        "Supplier Categories": [
            ["View categories", "Navigate to categories", "Shows category list", "src/app", "Medium", "Manual"],
            ["Create category", "Add new category", "Category created", "src/app", "Medium", "Manual"],
            ["Edit category", "Modify category", "Changes saved", "src/app", "Medium", "Manual"],
            ["Delete category", "Remove category", "Category deleted", "src/app", "Medium", "Manual"],
            ["Assign category", "Set supplier category", "Category assigned", "src/app", "Medium", "Manual"]
        ],
        "Supplier Import/Export": [
            ["Import suppliers", "Upload CSV", "Suppliers imported", "src/app", "Medium", "Manual"],
            ["Export suppliers", "Click export", "CSV downloaded", "src/app", "Medium", "Manual"],
            ["Invalid import", "Upload bad CSV", "Errors shown", "src/app", "Medium", "Manual"]
        ],
        "Supplier Self-Registration": [
            ["Registration form", "Supplier fills form", "Registration submitted", "src/app", "Medium", "Manual"],
            ["Required fields", "Leave fields empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Pending status", "Submit registration", "Status = PENDING", "src/app", "Medium", "Manual"],
            ["Admin notification", "Registration submitted", "Admin notified", "src/app", "Medium", "Manual"],
            ["Approve registration", "Admin approves", "Supplier active", "src/app", "Medium", "Manual"],
            ["Reject registration", "Admin rejects", "Supplier rejected", "src/app", "Medium", "Manual"]
        ]
    },
    "9. Employees Module": {
        "Employee HR Profile - Personal": [
            ["Date of birth optional", "Leave DOB empty", "Saved as null", "src/features/employees/validations/hr-profile.ts", "Low", "Automated"],
            ["Gender optional", "Leave gender empty", "Saved as null", "src/features/employees/validations/hr-profile.ts", "Low", "Automated"],
            ["Nationality optional", "Leave nationality empty", "Saved as null", "src/features/employees/validations/hr-profile.ts", "Low", "Automated"]
        ],
        "HR Profile - Qatar Contact": [
            ["Qatar mobile: exactly 8 digits", "Enter 7 digit number", "Validation error", "src/features/employees/validations/hr-profile.ts", "High", "Automated"],
            ["Qatar mobile non-numeric rejected", "Enter +9743344", "Validation error", "src/features/employees/validations/hr-profile.ts", "High", "Automated"],
            ["Personal email format validated", "Enter invalid email", "Validation error", "src/features/employees/validations/hr-profile.ts", "High", "Automated"]
        ],
        "HR Profile - Identification (Qatar Legal)": [
            ["QID number: exactly 11 digits", "Enter 10 digit QID", "Validation error", "src/features/employees/validations/hr-profile.ts", "Critical", "Automated"],
            ["QID with non-numeric rejected", "Enter 1234567890A", "Validation error", "src/features/employees/validations/hr-profile.ts", "Critical", "Automated"],
            ["Passport: 5-20 alphanumeric", "Enter 4 char passport", "Validation error", "src/features/employees/validations/hr-profile.ts", "High", "Automated"],
            ["Passport special chars rejected", "Enter AB-123456", "Validation error", "src/features/employees/validations/hr-profile.ts", "High", "Automated"]
        ],
        "HR Profile - Bank": [
            ["IBAN format validation", "Enter invalid IBAN", "Validation error", "src/features/employees/validations/hr-profile.ts", "Critical", "Automated"],
            ["Valid Qatar IBAN accepted", "Enter QA12QNBA000000000012345678901", "Accepted", "src/features/employees/validations/hr-profile.ts", "High", "Automated"],
            ["IBAN with spaces accepted", "Enter IBAN with spaces", "Spaces stripped, validated", "src/features/employees/validations/hr-profile.ts", "Medium", "Automated"]
        ],
        "HR Profile - Education": [
            ["Graduation year: 1950 to current", "Enter year 1949", "Validation error", "src/features/employees/validations/hr-profile.ts", "Medium", "Automated"],
            ["Future graduation year rejected", "Enter future year", "Validation error", "src/features/employees/validations/hr-profile.ts", "Medium", "Automated"]
        ],
        "HR Utilities": [
            ["Expiry status: past date = expired", "Check expired document", "Status: expired", "src/features/employees/lib/hr-utils.ts", "High", "Automated"],
            ["Expiry status: within 30 days = expiring", "Check doc expiring in 20 days", "Status: expiring", "src/features/employees/lib/hr-utils.ts", "High", "Automated"],
            ["Expiry status: > 30 days = valid", "Check doc expiring in 60 days", "Status: valid", "src/features/employees/lib/hr-utils.ts", "High", "Automated"],
            ["Profile completion calculation", "Check incomplete profile", "Shows % and missing fields", "src/features/employees/lib/hr-utils.ts", "High", "Automated"],
            ["Profile >= 80% = complete", "Fill 80% of fields", "isComplete: true", "src/features/employees/lib/hr-utils.ts", "Medium", "Automated"],
            ["Tenure calculation from join date", "Check employee tenure", "Shows 'Xy Xm' format", "src/features/employees/lib/hr-utils.ts", "Medium", "Automated"],
            ["QID/IBAN masking", "View sensitive data", "Shows ****5678 format", "src/features/employees/lib/hr-utils.ts", "High", "Automated"]
        ],
        "Employee Expiry Alerts": [
            ["QID expiry tracked", "View employee with expiring QID", "Alert shown", "src/app/api/employees/expiry-alerts/route.ts", "High", "E2E"],
            ["Passport expiry tracked", "View employee with expiring passport", "Alert shown", "src/app/api/employees/expiry-alerts/route.ts", "High", "E2E"],
            ["Health card expiry tracked", "View employee with expiring health card", "Alert shown", "src/app/api/employees/expiry-alerts/route.ts", "High", "E2E"],
            ["Multiple documents expiring shown", "View employee with multiple expiring", "All alerts shown", "src/app/api/employees/expiry-alerts/route.ts", "Medium", "E2E"]
        ],
        "Employee Celebrations": [
            ["Upcoming birthdays shown", "View celebrations widget", "Birthdays this week listed", "src/app/api/employees/celebrations/route.ts", "Low", "E2E"],
            ["Work anniversaries shown", "View celebrations widget", "Anniversaries listed", "src/app/api/employees/celebrations/route.ts", "Low", "E2E"]
        ],
        "Organization Setup": [
            ["New user redirect", "Sign up as new user", "Redirected to /setup wizard", "src/app", "Medium", "Manual"],
            ["Company name required", "Leave company name empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Company slug unique", "Enter existing org slug", "Error 'slug already taken'", "src/app", "Medium", "Manual"],
            ["Company slug format", "Enter slug with spaces/special chars", "Validation error", "src/app", "Medium", "Manual"],
            ["Website field optional", "Leave website empty", "Proceeds to next step", "src/app", "Medium", "Manual"],
            ["Website URL validation", "Enter invalid URL", "Validation error", "src/app", "Medium", "Manual"],
            ["Code prefix required", "Leave prefix empty", "Cannot proceed", "src/app", "Medium", "Manual"],
            ["Code prefix format", "Enter lowercase/special chars", "Error (must be 2-3 uppercase)", "src/app", "Medium", "Manual"],
            ["Additional currencies", "Add USD/EUR currencies", "Saved to org settings", "src/app", "Medium", "Manual"],
            ["Skip currencies step", "Click 'Skip for now'", "Proceeds to logo step", "src/app", "Medium", "Manual"],
            ["Logo upload", "Upload company logo", "Logo saved and displayed", "src/app", "Medium", "Manual"],
            ["Logo invalid format", "Upload non-image file", "Error 'invalid format'", "src/app", "Medium", "Manual"],
            ["Skip logo step", "Click 'Skip for now'", "Proceeds to colors step", "src/app", "Medium", "Manual"],
            ["Primary color selection", "Select primary color", "Color saved", "src/app", "Medium", "Manual"],
            ["Secondary color selection", "Select secondary color", "Color saved", "src/app", "Medium", "Manual"],
            ["Skip colors step", "Click 'Skip for now'", "Proceeds to modules step", "src/app", "Medium", "Manual"],
            ["Module selection", "Enable/disable modules", "Saved to org settings", "src/app", "Medium", "Manual"],
            ["At least one module", "Try to proceed with 0 modules", "Cannot proceed", "src/app", "Medium", "Manual"],
            ["Complete setup", "Click 'Finish Setup'", "Redirected to admin dashboard", "src/app", "Medium", "Manual"],
            ["Skip setup entirely", "Click 'Skip setup'", "Goes to admin dashboard", "src/app", "Medium", "Manual"]
        ],
        "Employee Onboarding": [
            ["New employee redirect", "New employee logs in", "Shown onboarding wizard", "src/app", "Medium", "Manual"],
            ["Skip onboarding", "Click 'Skip for now'", "Goes to employee dashboard", "src/app", "Medium", "Manual"],
            ["Resume onboarding", "Skip then return later", "Can resume from dashboard", "src/app", "Medium", "Manual"],
            ["Already completed", "Complete onboarding, revisit", "Shows 'already completed'", "src/app", "Medium", "Manual"]
        ],
        "Step 1: Personal Information": [
            ["Date of birth required", "Leave empty, click Continue", "Validation error", "src/app", "Medium", "Manual"],
            ["DOB age validation", "Enter DOB making age <18 or >80", "Date picker prevents selection", "src/app", "Medium", "Manual"],
            ["Gender required", "Leave empty, click Continue", "Validation error", "src/app", "Medium", "Manual"],
            ["Nationality required", "Leave empty, click Continue", "Validation error", "src/app", "Medium", "Manual"],
            ["Marital status optional", "Leave empty, click Continue", "Proceeds without error", "src/app", "Medium", "Manual"],
            ["Future DOB", "Enter future date for DOB", "Validation error", "src/app", "Medium", "Manual"],
            ["Valid personal info", "Fill all required fields", "Proceeds to step 2", "src/app", "Medium", "Manual"]
        ],
        "Step 2: Contact & Emergency": [
            ["Qatar mobile required", "Leave empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Qatar mobile 8 digits", "Enter 7 digits", "Error 'must be 8 digits'", "src/app", "Medium", "Manual"],
            ["Qatar mobile valid", "Enter 8 digits", "Valid, proceeds", "src/app", "Medium", "Manual"],
            ["Phone code auto-set", "Select nationality", "Other mobile code auto-updates", "src/app", "Medium", "Manual"],
            ["Other mobile 5-15 digits", "Enter 4 digits for other mobile", "Validation error", "src/app", "Medium", "Manual"],
            ["Personal email required", "Leave empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Personal email format", "Enter invalid email", "Validation error", "src/app", "Medium", "Manual"],
            ["Qatar address fields", "Fill zone/street/building", "Saved correctly", "src/app", "Medium", "Manual"],
            ["Qatar address unit optional", "Leave unit empty", "Proceeds without error", "src/app", "Medium", "Manual"],
            ["Local emergency name required", "Leave name empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Local emergency relationship required", "Leave relationship empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Local emergency phone required", "Leave phone empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Home country details optional", "Leave all home country fields empty", "Proceeds without error", "src/app", "Medium", "Manual"]
        ],
        "Step 3: Identification & Legal": [
            ["QID number required", "Leave empty", "Validation error", "src/app", "Medium", "Manual"],
            ["QID 11 digits", "Enter 10 digits", "Error 'must be 11 digits'", "src/app", "Medium", "Manual"],
            ["QID starts with 2 or 3", "Enter QID starting with 1", "Validation error", "src/app", "Medium", "Manual"],
            ["QID digits only", "Enter letters in QID", "Only digits accepted", "src/app", "Medium", "Manual"],
            ["QID expiry required", "Leave empty", "Validation error", "src/app", "Medium", "Manual"],
            ["QID expired date", "Enter past date for expiry", "Should warn (not block)", "src/app", "Medium", "Manual"],
            ["Passport number required", "Leave empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Passport format", "Enter <5 chars", "Error '5-20 characters'", "src/app", "Medium", "Manual"],
            ["Passport auto-uppercase", "Enter lowercase passport number", "Converted to uppercase", "src/app", "Medium", "Manual"],
            ["Passport expiry required", "Leave empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Health card optional", "Leave empty", "Proceeds without error", "src/app", "Medium", "Manual"],
            ["Driving license expiry optional", "Leave empty", "Proceeds without error", "src/app", "Medium", "Manual"]
        ],
        "Step 4: Banking & Documents": [
            ["Bank name required", "Leave empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Bank name dropdown", "Click bank name field", "Shows list of Qatar banks", "src/app", "Medium", "Manual"],
            ["IBAN required", "Leave empty", "Validation error", "src/app", "Medium", "Manual"],
            ["IBAN auto-prefills QA", "Focus on empty IBAN field", "QA prefix auto-added", "src/app", "Medium", "Manual"],
            ["IBAN format invalid", "Enter wrong format", "Validation error", "src/app", "Medium", "Manual"],
            ["IBAN Qatar format", "Enter valid QA IBAN", "Valid", "src/app", "Medium", "Manual"],
            ["IBAN spaces removed", "Enter IBAN with spaces", "Spaces automatically removed", "src/app", "Medium", "Manual"],
            ["IBAN uppercase enforced", "Enter lowercase letters", "Converted to uppercase", "src/app", "Medium", "Manual"],
            ["IBAN max 34 characters", "Enter 35+ characters", "Input limited to 34 chars", "src/app", "Medium", "Manual"],
            ["Profile photo required", "Leave photo empty", "Validation error", "src/app", "Medium", "Manual"],
            ["QID copy required", "Leave QID copy empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Passport copy required", "Leave passport copy empty", "Validation error", "src/app", "Medium", "Manual"],
            ["QID document upload", "Upload QID copy", "File uploaded to storage", "src/app", "Medium", "Manual"],
            ["Passport upload", "Upload passport copy", "File uploaded to storage", "src/app", "Medium", "Manual"],
            ["Photo upload", "Upload photo", "File uploaded to storage", "src/app", "Medium", "Manual"],
            ["Invalid file type", "Upload .exe file", "Error 'invalid format'", "src/app", "Medium", "Manual"],
            ["File too large", "Upload >5MB file", "Error 'file too large'", "src/app", "Medium", "Manual"]
        ],
        "Step 5: Education & Skills": [
            ["Qualification optional", "Leave qualification empty", "Proceeds without error", "src/app", "Medium", "Manual"],
            ["Specialization optional", "Leave specialization empty", "Proceeds without error", "src/app", "Medium", "Manual"],
            ["Institution optional", "Leave institution empty", "Proceeds without error", "src/app", "Medium", "Manual"],
            ["Graduation year range", "Enter year 1900", "Validation error (must be within 50 years)", "src/app", "Medium", "Manual"],
            ["Graduation year future allowed", "Enter year current+2", "Valid (allows interns)", "src/app", "Medium", "Manual"],
            ["Languages multi-select", "Select multiple languages", "All saved correctly", "src/app", "Medium", "Manual"],
            ["Custom language entry", "Type custom language", "Custom language added", "src/app", "Medium", "Manual"],
            ["Skills tags input", "Enter multiple skills with Enter key", "All skills saved as tags", "src/app", "Medium", "Manual"],
            ["Skip education step", "Leave all fields empty", "Proceeds to review step", "src/app", "Medium", "Manual"]
        ],
        "Step 6: Review & Complete": [
            ["Review all data", "View review step", "All entered data displayed", "src/app", "Medium", "Manual"],
            ["Education section displayed", "View review step", "Education & skills info shown", "src/app", "Medium", "Manual"],
            ["Documents status shown", "View review step", "Upload status badges displayed", "src/app", "Medium", "Manual"],
            ["Edit from review", "Click edit on section", "Goes back to that step", "src/app", "Medium", "Manual"],
            ["Redirect after complete", "Complete onboarding", "Redirected to employee dashboard", "src/app", "Medium", "Manual"]
        ],
        "Progress & State Management": [
            ["Progress saved", "Fill step, refresh page", "Data persisted", "src/app", "Medium", "Manual"],
            ["Step navigation", "Click step indicators", "Can navigate between steps", "src/app", "Medium", "Manual"],
            ["Validation on next", "Click Continue with errors", "Shows field-specific errors", "src/app", "Medium", "Manual"],
            ["Skip for now", "Click 'Skip for now'", "Progress saved, exits to dashboard", "src/app", "Medium", "Manual"]
        ],
        "HR Profile": [
            ["QID format - 10 digits", "Enter 10 digits", "Error 'must be 11 digits'", "src/app", "Medium", "Manual"],
            ["QID format - 11 digits", "Enter 11 digits", "Valid", "src/app", "Medium", "Manual"],
            ["Qatar mobile - 7 digits", "Enter 7 digits", "Error 'must be 8 digits'", "src/app", "Medium", "Manual"],
            ["Qatar mobile - 8 digits", "Enter 8 digits", "Valid", "src/app", "Medium", "Manual"],
            ["IBAN format", "Enter invalid IBAN", "Validation error", "src/app", "Medium", "Manual"],
            ["Email format", "Enter invalid email", "Validation error", "src/app", "Medium", "Manual"],
            ["Graduation year", "Enter 1900", "Error '1950-current'", "src/app", "Medium", "Manual"],
            ["Profile completion", "Fill all fields", "Shows 100% complete", "src/app", "Medium", "Manual"]
        ],
        "Team Member Management": [
            ["Invite new member", "Send invitation", "Invitation created, email sent", "src/app", "Medium", "Manual"],
            ["Accept invitation", "Click link, complete signup", "Member added to org", "src/app", "Medium", "Manual"],
            ["Expired invitation", "Use expired token", "Error 'invitation expired'", "src/app", "Medium", "Manual"],
            ["Change role", "Change EMPLOYEE to ADMIN", "Permissions updated", "src/app", "Medium", "Manual"],
            ["Delete member", "Soft delete", "isDeleted=true, can't login", "src/app", "Medium", "Manual"],
            ["Restore member", "Restore deleted", "isDeleted=false, can login", "src/app", "Medium", "Manual"],
            ["Employee without email", "Create with internal email", "Uses generated internal email", "src/app", "Medium", "Manual"],
            ["Employee canLogin=false", "Create non-login employee", "No invitation sent, record created", "src/app", "Medium", "Manual"],
            ["Duplicate email in same org", "Create with existing email", "Error 'Email already exists'", "src/app", "Medium", "Manual"],
            ["Duplicate email different org", "Same email, different tenant", "Allowed (tenant isolation)", "src/app", "Medium", "Manual"],
            ["Employee with all optional fields empty", "Only required fields", "Created successfully", "src/app", "Medium", "Manual"],
            ["Employee with future joining date", "Joining date next month", "Created, marked as upcoming", "src/app", "Medium", "Manual"],
            ["Invalid employee code format", "Code with special characters", "Validation error", "src/app", "Medium", "Manual"]
        ],
        "Employee Status Changes": [
            ["Terminate with assigned assets", "Terminate employee with 3 assets", "Prompts for asset return or blocks", "src/app", "Medium", "Manual"],
            ["Terminate with pending leaves", "Employee has approved future leave", "Cancels leaves or prompts", "src/app", "Medium", "Manual"],
            ["Terminate with pending approvals", "Employee has pending requests", "Auto-reject or reassign", "src/app", "Medium", "Manual"],
            ["Terminate with loan balance", "Employee has unpaid loan", "Deducts from final settlement", "src/app", "Medium", "Manual"],
            ["Deactivate vs Delete", "Deactivate then try delete", "Different behaviors clear", "src/app", "Medium", "Manual"],
            ["Reactivate deleted employee", "Restore soft-deleted", "Account restored, can login", "src/app", "Medium", "Manual"],
            ["Reactivate with duplicate email", "Restore, but email now taken", "Error or prompt to update email", "src/app", "Medium", "Manual"],
            ["Change probation to permanent", "Confirm after probation", "Status update, benefits change", "src/app", "Medium", "Manual"]
        ],
        "Reporting Structure": [
            ["Change manager with pending approvals", "Switch reporting manager", "Pending requests reassigned or continue", "src/app", "Medium", "Manual"],
            ["Circular reporting chain", "A reports to B, B reports to A", "Validation error", "src/app", "Medium", "Manual"],
            ["Manager reports to subordinate", "Set manager's manager as subordinate", "Validation error", "src/app", "Medium", "Manual"],
            ["Delete manager with direct reports", "Delete manager who has reports", "Reports unassigned or reassigned", "src/app", "Medium", "Manual"],
            ["Self as reporting manager", "Set self as own manager", "Validation error", "src/app", "Medium", "Manual"],
            ["No manager assigned", "Employee with no reportingToId", "Skips manager level in approvals", "src/app", "Medium", "Manual"]
        ],
        "Employment Status": [
            ["ACTIVE status", "New employee", "Default status ACTIVE", "src/app", "Medium", "Manual"],
            ["PROBATION status", "Set probation", "Status = PROBATION", "src/app", "Medium", "Manual"],
            ["Probation end date", "Set probation period", "End date calculated", "src/app", "Medium", "Manual"],
            ["Probation to ACTIVE", "Confirm employee", "Status = ACTIVE", "src/app", "Medium", "Manual"],
            ["CONTRACT status", "Set contract employee", "Status = CONTRACT", "src/app", "Medium", "Manual"],
            ["Contract end date", "Set contract period", "End date set", "src/app", "Medium", "Manual"],
            ["TERMINATED status", "Terminate employee", "Status = TERMINATED", "src/app", "Medium", "Manual"],
            ["Terminated cannot login", "Terminate employee", "Login disabled", "src/app", "Medium", "Manual"],
            ["RESIGNED status", "Process resignation", "Status = RESIGNED", "src/app", "Medium", "Manual"]
        ],
        "Termination & Resignation": [
            ["Initiate termination", "Start termination", "Termination started", "src/app", "Medium", "Manual"],
            ["Termination reason", "Enter reason", "Reason required", "src/app", "Medium", "Manual"],
            ["Termination date", "Set last day", "Date saved", "src/app", "Medium", "Manual"],
            ["Termination notice", "Generate notice", "Notice letter created", "src/app", "Medium", "Manual"],
            ["Resignation request", "Employee resigns", "Request created", "src/app", "Medium", "Manual"],
            ["Resignation notice period", "Check notice", "Notice period enforced", "src/app", "Medium", "Manual"],
            ["Accept resignation", "HR accepts", "Status = RESIGNED", "src/app", "Medium", "Manual"],
            ["Final settlement", "Calculate settlement", "Gratuity + leave encashment", "src/app", "Medium", "Manual"],
            ["Asset return", "Check assigned assets", "Prompt for asset return", "src/app", "Medium", "Manual"],
            ["Access revoked", "Complete termination", "All access removed", "src/app", "Medium", "Manual"]
        ],
        "Probation Management": [
            ["Set probation period", "Enter months", "Period set", "src/app", "Medium", "Manual"],
            ["Probation alert", "15 days before end", "Alert triggered", "src/app", "Medium", "Manual"],
            ["Extend probation", "Extend period", "New end date", "src/app", "Medium", "Manual"],
            ["Confirm employment", "Confirm after probation", "Status = ACTIVE", "src/app", "Medium", "Manual"],
            ["Terminate in probation", "Terminate", "Shorter notice period", "src/app", "Medium", "Manual"],
            ["Probation report", "View probation list", "Shows all on probation", "src/app", "Medium", "Manual"]
        ],
        "Contract Management": [
            ["Upload contract", "Upload PDF", "Contract saved", "src/app", "Medium", "Manual"],
            ["Contract expiry", "Set expiry date", "Date saved", "src/app", "Medium", "Manual"],
            ["Contract expiry alert", "30 days before", "Alert triggered", "src/app", "Medium", "Manual"],
            ["Renew contract", "Renew existing", "New dates set", "src/app", "Medium", "Manual"],
            ["Contract history", "View past contracts", "All contracts shown", "src/app", "Medium", "Manual"],
            ["Download contract", "Download copy", "File downloaded", "src/app", "Medium", "Manual"]
        ],
        "Visa & Work Permit": [
            ["Set visa type", "Enter visa type", "Type saved", "src/app", "Medium", "Manual"],
            ["Visa expiry", "Set expiry date", "Date saved", "src/app", "Medium", "Manual"],
            ["Visa expiry alert", "60 days before", "Alert triggered", "src/app", "Medium", "Manual"],
            ["Work permit number", "Enter permit number", "Number saved", "src/app", "Medium", "Manual"],
            ["Work permit expiry", "Set expiry", "Date saved", "src/app", "Medium", "Manual"],
            ["Visa renewal", "Update after renewal", "New dates saved", "src/app", "Medium", "Manual"]
        ],
        "Department Management": [
            ["Assign department", "Set employee dept", "Department saved", "src/app", "Medium", "Manual"],
            ["Filter by department", "Filter employees", "Shows dept only", "src/app", "Medium", "Manual"],
            ["Department in reports", "Generate report", "Grouped by dept", "src/app", "Medium", "Manual"],
            ["Department manager", "Set dept manager", "Manager assigned", "src/app", "Medium", "Manual"],
            ["Change department", "Transfer employee", "Department updated", "src/app", "Medium", "Manual"],
            ["Department head count", "View department", "Shows employee count", "src/app", "Medium", "Manual"]
        ]
    },
    "10. Leave Management": {
        "Leave Type Configuration": [
            ["Name required (1-100 chars)", "Create leave type without name", "Validation error", "src/features/leave/validations/leave.ts", "Critical", "Automated"],
            ["Color hex format #RRGGBB", "Enter invalid color", "Validation error", "src/features/leave/validations/leave.ts", "Medium", "Automated"],
            ["Default days: integer min 0", "Enter negative days", "Validation error", "src/features/leave/validations/leave.ts", "High", "Automated"],
            ["Carry forward requires max days", "Enable carry forward without max", "Validation error", "src/features/leave/validations/leave.ts", "High", "Automated"],
            ["Gender restriction: MALE/FEMALE", "Set gender filter", "Only matching gender can use", "src/features/leave/lib/leave-utils.ts", "High", "Automated"],
            ["Minimum service months setting", "Set min 3 months", "New employees cannot use", "src/features/leave/lib/leave-utils.ts", "High", "Automated"],
            ["Create leave type - valid", "Fill all required fields", "Type created successfully", "src/app", "Medium", "Manual"],
            ["Create leave type - empty name", "Submit without name", "Validation error", "src/app", "Medium", "Manual"],
            ["Create leave type - negative days", "Enter -5 for default days", "Validation error", "src/app", "Medium", "Manual"],
            ["Create leave type - invalid color", "Enter 'red' instead of hex", "Validation error", "src/app", "Medium", "Manual"],
            ["Enable carry forward without max", "Enable carry forward, no max days", "Validation error", "src/app", "Medium", "Manual"],
            ["Gender restriction", "Create type with FEMALE restriction", "Only females see it", "src/app", "Medium", "Manual"],
            ["Service requirement", "Create type requiring 12 months", "New employees can't use it", "src/app", "Medium", "Manual"],
            ["Once-in-employment", "Create Hajj leave, use it twice", "Second request blocked", "src/app", "Medium", "Manual"],
            ["Once-per-employment used twice", "Use Hajj leave, request again next year", "Error 'Already used this leave type'", "src/app", "Medium", "Manual"],
            ["Gender-restricted leave", "Male requests maternity leave", "Not shown or error", "src/app", "Medium", "Manual"],
            ["Service requirement not met", "New employee requests type requiring 12 months", "Error 'Minimum service not met'", "src/app", "Medium", "Manual"],
            ["Probation-restricted leave", "Employee on probation requests annual leave", "Policy-dependent, may block", "src/app", "Medium", "Manual"],
            ["Medical leave without document", "Request >1 day sick leave, no doc", "Error 'Document required'", "src/app", "Medium", "Manual"],
            ["Unpaid leave exceeds limit", "Request 60 days unpaid (max 30)", "Error 'Exceeds maximum'", "src/app", "Medium", "Manual"]
        ],
        "Qatar Labor Law Leave Types": [
            ["Annual Leave: 21/28 days based on service", "Check annual leave for 5+ year employee", "28 days entitlement", "src/features/leave/lib/seed-leave-types.ts", "High", "Automated"],
            ["Sick Leave: 14 days full pay", "Check sick leave balance", "14 days at 100%", "src/features/leave/lib/seed-leave-types.ts", "High", "Automated"],
            ["Maternity Leave: 50 days female only", "Male employee checks maternity", "Not available", "src/features/leave/lib/leave-utils.ts", "High", "Automated"],
            ["Paternity Leave: 3 days male only", "Female employee checks paternity", "Not available", "src/features/leave/lib/leave-utils.ts", "High", "Automated"],
            ["Hajj Leave: once per employment", "Request Hajj leave twice", "Second request rejected", "src/features/leave/lib/leave-request-validation.ts", "High", "Automated"]
        ],
        "Leave Request Creation": [
            ["Leave type ID required", "Submit without type", "Validation error", "src/features/leave/validations/leave.ts", "Critical", "Automated"],
            ["Start date required", "Submit without start date", "Validation error", "src/features/leave/validations/leave.ts", "Critical", "Automated"],
            ["End date >= start date", "Set end before start", "Validation error", "src/features/leave/validations/leave.ts", "Critical", "Automated"],
            ["Half-day must be same day", "Half-day spanning 2 days", "Validation error", "src/features/leave/lib/leave-request-validation.ts", "Critical", "Automated"],
            ["Reason max 1000 chars", "Enter 1001 char reason", "Validation error", "src/features/leave/validations/leave.ts", "Low", "Automated"],
            ["Document URL format validated", "Enter invalid URL", "Validation error", "src/features/leave/validations/leave.ts", "Medium", "Automated"],
            ["Valid request - full day", "Select type, dates, submit", "Request created with PENDING status", "src/app", "Medium", "Manual"],
            ["Valid request - half day AM", "Select half day AM, single date", "Request created for 0.5 days", "src/app", "Medium", "Manual"],
            ["Valid request - half day PM", "Select half day PM, single date", "Request created for 0.5 days", "src/app", "Medium", "Manual"],
            ["Half day - different dates", "Select half day, different start/end", "Validation error", "src/app", "Medium", "Manual"],
            ["End before start", "End date before start date", "Validation error", "src/app", "Medium", "Manual"],
            ["Overlapping request", "Create request overlapping existing", "'Leave already booked' error", "src/app", "Medium", "Manual"],
            ["Insufficient balance", "Request more days than available", "'Insufficient balance' error", "src/app", "Medium", "Manual"],
            ["Notice period violation", "Request leave starting tomorrow", "Validation error", "src/app", "Medium", "Manual"],
            ["Admin override notice", "As admin, override notice requirement", "Request created", "src/app", "Medium", "Manual"],
            ["Document required - no doc", "Type requires doc, don't upload", "Validation error (if >1 day)", "src/app", "Medium", "Manual"],
            ["Document required - 1 day", "Type requires doc, request 1 day", "Should allow without doc", "src/app", "Medium", "Manual"],
            ["Max consecutive days", "Exceed max consecutive limit", "Validation error", "src/app", "Medium", "Manual"],
            ["Weekend handling", "Request includes weekend", "Weekends excluded from count", "src/app", "Medium", "Manual"],
            ["Public holiday handling", "Request includes public holiday", "Holiday excluded from count", "src/app", "Medium", "Manual"],
            ["On-behalf request", "Admin creates for employee", "Shows 'created by' in history", "src/app", "Medium", "Manual"],
            ["Service eligibility", "New employee, type requires 12 months", "Not eligible error", "src/app", "Medium", "Manual"],
            ["Leave for employee without login", "Admin creates leave for canLogin=false", "Request created, no employee action needed", "src/app", "Medium", "Manual"],
            ["Leave spanning year boundary", "Request Dec 28 to Jan 5", "Split across years or handled correctly", "src/app", "Medium", "Manual"],
            ["Leave spanning multiple years", "Request 6-month leave across 2 years", "Balance deducted from both years", "src/app", "Medium", "Manual"],
            ["Negative balance after adjustment", "Adjust balance to -5", "Shows negative, blocks new requests", "src/app", "Medium", "Manual"],
            ["Request on terminated employee", "Submit leave for terminated", "Error 'Employee terminated'", "src/app", "Medium", "Manual"],
            ["Request for future year", "Request leave for next year", "Allowed if policy permits, uses future balance", "src/app", "Medium", "Manual"],
            ["Half-day on public holiday", "Request half-day on holiday", "Should exclude holiday", "src/app", "Medium", "Manual"],
            ["Leave during notice period", "Employee in notice period requests leave", "Policy-dependent, may require approval", "src/app", "Medium", "Manual"],
            ["Request exactly at balance", "Request all remaining balance", "Allowed, balance becomes 0", "src/app", "Medium", "Manual"],
            ["Weekend-only request", "Fri-Sat leave (both weekend)", "Error 'No working days' or 0 days", "src/app", "Medium", "Manual"]
        ],
        "Leave Request Validations": [
            ["Gender restriction enforced", "Male requests maternity", "Error: only available for female", "src/features/leave/lib/leave-request-validation.ts", "Critical", "Automated"],
            ["Minimum service requirement checked", "New hire requests restricted leave", "Error: must complete service", "src/features/leave/lib/leave-request-validation.ts", "High", "Automated"],
            ["Notice period requirement checked", "Request without sufficient notice", "Error: requires X days notice", "src/features/leave/lib/leave-request-validation.ts", "High", "Automated"],
            ["Admin can override notice period", "Admin submits with override", "Request accepted", "src/features/leave/lib/leave-request-validation.ts", "High", "Automated"],
            ["Max consecutive days checked", "Exceed max consecutive limit", "Error: maximum X consecutive days", "src/features/leave/lib/leave-request-validation.ts", "High", "Automated"],
            ["Overlapping leave detected", "Request overlapping approved leave", "Error: already have overlapping request", "src/features/leave/lib/leave-request-validation.ts", "Critical", "Automated"],
            ["Insufficient balance checked", "Request more than available", "Error: insufficient balance", "src/features/leave/lib/leave-request-validation.ts", "Critical", "Automated"],
            ["Document required for multi-day medical", "Multi-day sick without doc", "Error: document required", "src/features/leave/lib/leave-request-validation.ts", "High", "Automated"],
            ["1-day leave skips document requirement", "1-day sick without doc", "Allowed", "src/features/leave/lib/leave-request-validation.ts", "Medium", "Automated"]
        ],
        "Working Days Calculation (Qatar)": [
            ["Friday/Saturday excluded", "Request Sun-Sat (7 days)", "5 working days calculated", "src/features/leave/lib/leave-utils.ts", "Critical", "Automated"],
            ["Half-day always 0.5 days", "Request half day", "0.5 days deducted", "src/features/leave/lib/leave-utils.ts", "High", "Automated"],
            ["Weekend only = 0 working days", "Select Fri-Sat only", "Error: no working days in range", "src/features/leave/lib/leave-utils.ts", "High", "Automated"],
            ["Annual leave includes all calendar days", "Annual leave request", "All days counted (accrual-based)", "src/features/leave/lib/leave-utils.ts", "High", "Automated"]
        ],
        "Leave Approval": [
            ["Manager can approve direct report", "Manager approves leave", "Status = APPROVED, balance updated", "src/features/approvals/lib/approval-engine.ts", "Critical", "E2E"],
            ["Self-approval prevented", "Approve own request", "Error: cannot approve own", "src/features/approvals/lib/approval-engine.ts", "Critical", "Automated"],
            ["Rejection requires reason", "Reject without reason", "Validation error", "src/features/approvals/lib/approval-engine.ts", "High", "Automated"],
            ["Balance updated atomically on approval", "Approve leave", "Balance decremented in transaction", "src/app/api/leave/requests/[id]/approve/route.ts", "Critical", "Automated"],
            ["Hajj leave marked on approval", "Approve Hajj leave", "hajjLeaveTaken = true", "src/app/api/leave/requests/[id]/approve/route.ts", "High", "Automated"]
        ],
        "Leave Cancellation": [
            ["Owner can cancel PENDING", "Cancel own pending request", "Status = CANCELLED", "src/app/api/leave/requests/[id]/route.ts", "High", "E2E"],
            ["Owner can cancel future APPROVED", "Cancel future approved leave", "Status = CANCELLED, balance restored", "src/app/api/leave/requests/[id]/route.ts", "High", "E2E"],
            ["Cannot cancel past leave", "Cancel past dated leave", "Error: cannot cancel", "src/app/api/leave/requests/[id]/route.ts", "High", "Automated"],
            ["Cancellation reason required", "Cancel without reason", "Validation error", "src/app/api/leave/requests/[id]/route.ts", "Medium", "Automated"]
        ],
        "Leave Balance": [
            ["View balance by year", "Request balance for 2025", "Shows 2025 balances", "src/app/api/leave/balances/route.ts", "High", "E2E"],
            ["Admin can adjust balance", "Add 5 days to employee balance", "Balance increased", "src/app/api/leave/balances/adjust/route.ts", "High", "E2E"],
            ["Adjustment requires reason", "Adjust without reason", "Validation error", "src/app/api/leave/balances/adjust/route.ts", "High", "Automated"],
            ["Remaining = Available - Pending", "Check balance with pending request", "Pending amount shown separately", "src/features/leave/lib/leave-utils.ts", "High", "Automated"]
        ],
        "Team Calendar": [
            ["View team leave calendar", "Access leave calendar", "Shows all team leave", "src/app/admin/(hr)/leave/calendar/page.tsx", "Medium", "E2E"],
            ["Filter by leave type", "Filter calendar by type", "Only selected type shown", "src/app/admin/(hr)/leave/calendar/page.tsx", "Low", "E2E"]
        ],
        "Leave Request Approval": [
            ["Manager approval", "Manager approves direct report", "Moves to next level or approved", "src/app", "Medium", "Manual"],
            ["HR approval", "HR manager approves", "Moves to next level or approved", "src/app", "Medium", "Manual"],
            ["Director approval", "Director approves", "Fully approved", "src/app", "Medium", "Manual"],
            ["Self-approval prevention", "Try to approve own request", "Access denied", "src/app", "Medium", "Manual"],
            ["Admin bypass", "Admin approves skipping levels", "Requires notes, approved", "src/app", "Medium", "Manual"],
            ["Admin bypass without notes", "Admin bypasses without notes", "Validation error", "src/app", "Medium", "Manual"],
            ["Reject request", "Reject with reason", "Status = REJECTED, balance restored", "src/app", "Medium", "Manual"],
            ["Reject without reason", "Reject without reason", "Validation error", "src/app", "Medium", "Manual"],
            ["Already approved", "Try to approve already approved", "Error 'already processed'", "src/app", "Medium", "Manual"],
            ["Already rejected", "Try to approve rejected request", "Error 'not pending'", "src/app", "Medium", "Manual"],
            ["Balance update on approval", "Approve request", "pending decreases, used increases", "src/app", "Medium", "Manual"],
            ["Approver deleted while pending", "Manager deleted, request pending", "Escalates to next level or admin", "src/app", "Medium", "Manual"],
            ["Approver deactivated", "Manager canLogin=false, pending request", "Should still be able to approve via admin", "src/app", "Medium", "Manual"],
            ["Self-approval attempt", "Requester is also the manager", "Skips to next level or blocks", "src/app", "Medium", "Manual"],
            ["All approvers at level unavailable", "All managers deleted", "Escalates or admin notified", "src/app", "Medium", "Manual"],
            ["Approval policy deleted", "Delete policy with pending requests", "Existing requests continue or handled", "src/app", "Medium", "Manual"],
            ["Threshold exactly at boundary", "Request 5 days, policy threshold is 5", "Correct policy applied", "src/app", "Medium", "Manual"],
            ["No approval policy configured", "Request with no matching policy", "Default behavior or error", "src/app", "Medium", "Manual"],
            ["Race condition - two approvers", "L1 has 2 managers, both click approve", "Only one succeeds", "src/app", "Medium", "Manual"]
        ],
        "Leave Balance Tests": [
            ["Initial balance", "New employee, check annual leave", "Calculated based on service", "src/app", "Medium", "Manual"],
            ["Pro-rata accrual", "Employee with 6 months service", "Should have ~half entitlement", "src/app", "Medium", "Manual"],
            ["Balance adjustment", "Admin adjusts balance by +5", "Balance increases, notes recorded", "src/app", "Medium", "Manual"],
            ["Negative adjustment", "Admin adjusts by -10 (more than available)", "Should allow (admin override)", "src/app", "Medium", "Manual"],
            ["Carry forward", "End of year with balance", "Balance carries to next year", "src/app", "Medium", "Manual"],
            ["Max carry forward", "Carry forward exceeds max", "Capped at max", "src/app", "Medium", "Manual"],
            ["Pro-rata for mid-month joiner", "Joined Jan 15, check Jan balance", "Correctly pro-rated", "src/app", "Medium", "Manual"],
            ["Pro-rata for mid-year joiner", "Joined July 1, check annual leave", "Half year entitlement", "src/app", "Medium", "Manual"],
            ["Carry forward exceeds maximum", "Balance 30, max carry 10", "Only 10 carried forward", "src/app", "Medium", "Manual"],
            ["Carry forward disabled", "Type has carryForward=false", "Balance resets to 0 on new year", "src/app", "Medium", "Manual"],
            ["Balance for terminated employee", "Check balance after termination", "Shows final balance, no accrual", "src/app", "Medium", "Manual"],
            ["Adjust balance beyond limits", "Admin adjusts to 999 days", "Should work (admin override)", "src/app", "Medium", "Manual"],
            ["Multiple adjustments same day", "3 adjustments in one day", "All recorded in history", "src/app", "Medium", "Manual"],
            ["Negative pending balance", "Cancel approved, pending goes negative", "Handled correctly", "src/app", "Medium", "Manual"]
        ]
    },
    "11. Payroll Module": {
        "Salary Structure": [
            ["User ID required", "Create without user", "Validation error", "src/features/payroll/validations/payroll.ts", "Critical", "Automated"],
            ["Basic salary: 0-999,999,999", "Enter negative salary", "Validation error", "src/features/payroll/validations/payroll.ts", "Critical", "Automated"],
            ["Effective date required", "Create without date", "Validation error", "src/features/payroll/validations/payroll.ts", "Critical", "Automated"],
            ["Allowances default to 0", "Create with only basic", "Allowances = 0", "src/features/payroll/validations/payroll.ts", "Medium", "Automated"],
            ["Other allowances as array", "Add custom allowances", "Array of {name, amount} saved", "src/features/payroll/validations/payroll.ts", "Medium", "Automated"]
        ],
        "Payroll Run": [
            ["Year: 2020-2100", "Create run for 2019", "Validation error", "src/features/payroll/validations/payroll.ts", "High", "Automated"],
            ["Month: 1-12", "Create run for month 13", "Validation error", "src/features/payroll/validations/payroll.ts", "High", "Automated"],
            ["Duplicate year/month rejected", "Create second run for same month", "Error with existing run ID", "src/app/api/payroll/runs/route.ts", "Critical", "Automated"],
            ["Reference number generated", "Create run", "Format: PAY-YYYY-MM-SEQ", "src/app/api/payroll/runs/route.ts", "Medium", "Automated"],
            ["Initial status: DRAFT", "Create run", "Status = DRAFT", "src/app/api/payroll/runs/route.ts", "High", "Automated"]
        ],
        "Payroll Workflow": [
            ["DRAFT -> SUBMITTED", "Submit draft run", "Status = SUBMITTED", "src/app/api/payroll/runs/[id]/submit/route.ts", "Critical", "E2E"],
            ["SUBMITTED -> APPROVED", "Approve submitted run", "Status = APPROVED", "src/app/api/payroll/runs/[id]/approve/route.ts", "Critical", "E2E"],
            ["APPROVED -> PROCESSED", "Process approved run", "Status = PROCESSED, payslips created", "src/app/api/payroll/runs/[id]/process/route.ts", "Critical", "E2E"],
            ["PROCESSED -> PAID", "Mark as paid", "Status = PAID, paidAt set", "src/app/api/payroll/runs/[id]/pay/route.ts", "Critical", "E2E"],
            ["Cannot modify after SUBMITTED", "Edit submitted run", "Error: cannot modify", "src/app/api/payroll/runs/[id]/route.ts", "High", "Automated"],
            ["Cancel reverts to cancelled state", "Cancel run", "Status = CANCELLED", "src/app/api/payroll/runs/[id]/cancel/route.ts", "High", "E2E"]
        ],
        "Payroll Calculations": [
            ["Gross = Basic + All Allowances", "View payslip", "Gross correctly calculated", "src/features/payroll/lib/calculations.ts", "Critical", "Automated"],
            ["Leave deductions applied", "Employee had unpaid leave", "Deduction shown in payslip", "src/features/payroll/lib/calculations.ts", "High", "Automated"],
            ["Loan deductions applied", "Employee has active loan", "Monthly deduction applied", "src/features/payroll/lib/calculations.ts", "High", "Automated"],
            ["Net = Gross - All Deductions", "View payslip", "Net correctly calculated", "src/features/payroll/lib/calculations.ts", "Critical", "Automated"]
        ],
        "Loans": [
            ["Loan type: LOAN or ADVANCE", "Create with invalid type", "Validation error", "src/features/payroll/validations/payroll.ts", "High", "Automated"],
            ["Principal amount: min 1", "Create with amount 0", "Validation error", "src/features/payroll/validations/payroll.ts", "High", "Automated"],
            ["Monthly deduction: min 1", "Create with deduction 0", "Validation error", "src/features/payroll/validations/payroll.ts", "High", "Automated"],
            ["Installments: min 1", "Create with 0 installments", "Validation error", "src/features/payroll/validations/payroll.ts", "High", "Automated"],
            ["Pause loan stops deductions", "Pause active loan", "Status = PAUSED, no deductions", "src/app/api/payroll/loans/[id]/pause/route.ts", "High", "E2E"],
            ["Resume loan resumes deductions", "Resume paused loan", "Status = ACTIVE, deductions resume", "src/app/api/payroll/loans/[id]/resume/route.ts", "High", "E2E"],
            ["Write off zeroes balance", "Write off loan", "Remaining balance = 0", "src/app/api/payroll/loans/[id]/write-off/route.ts", "High", "E2E"],
            ["Loan completion when fully paid", "Process final payment", "Status = COMPLETED", "src/features/payroll/lib/calculations.ts", "High", "Automated"],
            ["Create loan", "Amount, term, start date", "Loan created", "src/app", "Medium", "Manual"],
            ["Loan deduction", "Process payroll with loan", "Monthly deduction applied", "src/app", "Medium", "Manual"],
            ["Pause loan", "Pause active loan", "Deductions stop", "src/app", "Medium", "Manual"],
            ["Resume loan", "Resume paused", "Deductions continue", "src/app", "Medium", "Manual"],
            ["Write off loan", "Write off remainder", "Balance zeroed", "src/app", "Medium", "Manual"],
            ["Multiple loans exceed net salary", "3 loans total > salary", "Caps at salary or proportional", "src/app", "Medium", "Manual"],
            ["Loan deduction on unpaid leave month", "Employee on unpaid leave, has loan", "Loan deduction still applies or deferred", "src/app", "Medium", "Manual"],
            ["Mid-month loan start", "Loan starts on 15th", "Pro-rated first month or full", "src/app", "Medium", "Manual"]
        ],
        "Gratuity (End of Service)": [
            ["< 12 months = ineligible", "Check gratuity for 11 month employee", "eligible: false, amount: 0", "src/features/payroll/lib/gratuity.ts", "Critical", "Automated"],
            ["Formula: 3 weeks per year", "Calculate for 1 year employee", "= (Basic/30)*7*3", "src/features/payroll/lib/gratuity.ts", "Critical", "Automated"],
            ["Pro-rata for partial years", "Calculate for 18 month employee", "1.5 years worth calculated", "src/features/payroll/lib/gratuity.ts", "High", "Automated"],
            ["Projection at 1, 3, 5, 10 years", "View gratuity projections", "Future amounts displayed", "src/features/payroll/lib/gratuity.ts", "Medium", "E2E"]
        ],
        "WPS File Generation": [
            ["SIF file structure correct", "Generate WPS file", "Contains SCR + SDR records + ETR", "src/features/payroll/lib/wps.ts", "Critical", "Automated"],
            ["QID must be 11 digits", "Employee with 10 digit QID", "Validation error in WPS", "src/features/payroll/lib/wps.ts", "Critical", "Automated"],
            ["Bank code lookup", "Employee at QNB", "Bank code = QNBA", "src/features/payroll/lib/wps.ts", "High", "Automated"],
            ["Amounts in fils (x1000)", "Net salary 12000 QAR", "File shows 0000012000000", "src/features/payroll/lib/wps.ts", "Critical", "Automated"],
            ["Unknown bank = XXXX", "Employee at unknown bank", "Bank code = XXXX, validation error", "src/features/payroll/lib/wps.ts", "High", "Automated"]
        ],
        "Salary Structures": [
            ["Create structure", "Basic salary + allowances", "Structure created", "src/app", "Medium", "Manual"],
            ["Negative salary", "Enter negative amount", "Validation error", "src/app", "Medium", "Manual"],
            ["Max salary", "Enter 999,999,999+", "Validation error", "src/app", "Medium", "Manual"],
            ["Multiple structures", "Same employee, different dates", "Both allowed", "src/app", "Medium", "Manual"],
            ["Effective date", "Future effective date", "Active after that date", "src/app", "Medium", "Manual"]
        ],
        "Allowances": [
            ["Housing allowance", "Set housing amount", "Amount saved", "src/app", "Medium", "Manual"],
            ["Transport allowance", "Set transport amount", "Amount saved", "src/app", "Medium", "Manual"],
            ["Food allowance", "Set food amount", "Amount saved", "src/app", "Medium", "Manual"],
            ["Phone allowance", "Set phone amount", "Amount saved", "src/app", "Medium", "Manual"],
            ["Other allowances", "Add custom allowance", "Amount + name saved", "src/app", "Medium", "Manual"],
            ["Multiple other allowances", "Add 3 custom allowances", "All saved as JSON", "src/app", "Medium", "Manual"],
            ["Negative allowance", "Enter negative", "Validation error", "src/app", "Medium", "Manual"],
            ["Allowance in payslip", "Generate payslip", "Allowances itemized", "src/app", "Medium", "Manual"],
            ["Total allowances", "Calculate total", "Sum of all allowances", "src/app", "Medium", "Manual"]
        ],
        "Payroll Runs": [
            ["Create run", "Select month/year", "Run created, calculates totals", "src/app", "Medium", "Manual"],
            ["Duplicate run", "Same month/year", "Error 'already exists'", "src/app", "Medium", "Manual"],
            ["Submit for approval", "Submit run", "Status = SUBMITTED", "src/app", "Medium", "Manual"],
            ["Approve run", "Approve submitted", "Status = APPROVED", "src/app", "Medium", "Manual"],
            ["Process run", "Process approved", "Payslips generated", "src/app", "Medium", "Manual"],
            ["Mark paid", "Mark as paid", "Status = PAID", "src/app", "Medium", "Manual"],
            ["Cancel run", "Cancel pending run", "Status = CANCELLED", "src/app", "Medium", "Manual"],
            ["Unpaid leave deduction", "Employee has unpaid leave", "Deducted from salary", "src/app", "Medium", "Manual"],
            ["Only WPS employees", "Filter WPS employees", "Only isOnWps=true included", "src/app", "Medium", "Manual"],
            ["Exclude terminated", "Run payroll", "Terminated employees excluded", "src/app", "Medium", "Manual"],
            ["Include probation", "Run payroll", "Probation employees included", "src/app", "Medium", "Manual"],
            ["Payroll for terminated mid-month", "Employee terminated on 15th", "Pro-rated salary calculated", "src/app", "Medium", "Manual"],
            ["Payroll with no active employees", "All employees terminated", "Empty run or appropriate message", "src/app", "Medium", "Manual"],
            ["Payroll for employee without bank", "Employee has no IBAN", "Warning, can proceed or blocks", "src/app", "Medium", "Manual"],
            ["Payroll after salary change", "Salary changed mid-month", "Uses current or effective salary", "src/app", "Medium", "Manual"],
            ["Payroll during organization trial", "Org on free trial", "Works normally", "src/app", "Medium", "Manual"],
            ["Reprocess approved payroll", "Try to modify APPROVED run", "Must cancel first or error", "src/app", "Medium", "Manual"],
            ["Payroll with 0 working days", "Employee on full-month leave", "Handles correctly (0 or deduction)", "src/app", "Medium", "Manual"]
        ],
        "WPS": [
            ["Generate WPS file", "Click generate WPS", "WPS file created", "src/app", "Medium", "Manual"],
            ["WPS file format", "Download file", "Correct format (SIF)", "src/app", "Medium", "Manual"],
            ["WPS employee data", "Check file contents", "All WPS employees included", "src/app", "Medium", "Manual"],
            ["WPS bank details", "Check file", "IBAN, bank name correct", "src/app", "Medium", "Manual"],
            ["WPS amounts", "Check file", "Net salary amounts correct", "src/app", "Medium", "Manual"],
            ["Non-WPS excluded", "Employee isOnWps=false", "Not in WPS file", "src/app", "Medium", "Manual"],
            ["WPS regenerate", "Regenerate same month", "New file replaces old", "src/app", "Medium", "Manual"],
            ["WPS history", "View past WPS files", "Shows all generated files", "src/app", "Medium", "Manual"],
            ["Mark WPS uploaded", "Mark as submitted", "wpsFileGenerated=true", "src/app", "Medium", "Manual"],
            ["WPS for employee without QID", "Employee missing QID number", "Warning or excluded from WPS", "src/app", "Medium", "Manual"],
            ["WPS with non-standard IBAN", "Employee has non-Qatar IBAN", "Validated or flagged", "src/app", "Medium", "Manual"],
            ["WPS for non-WPS employee", "isOnWps=false", "Excluded from WPS file", "src/app", "Medium", "Manual"],
            ["WPS file format validation", "Download and validate SIF format", "Correct format per Qatar standards", "src/app", "Medium", "Manual"],
            ["WPS for single employee", "Only 1 WPS employee in org", "Valid single-record file", "src/app", "Medium", "Manual"]
        ],
        "Deductions & Calculations": [
            ["Unpaid leave deduction calculation", "5 days unpaid leave", "Correct daily rate calculation", "src/app", "Medium", "Manual"],
            ["Deduction exceeds gross salary", "Deductions > gross", "Shows negative net or caps at 0", "src/app", "Medium", "Manual"],
            ["No deductions employee", "Employee with no loans/deductions", "Shows clean payslip", "src/app", "Medium", "Manual"]
        ],
        "Gratuity Calculations": [
            ["Gratuity <1 year service", "Employee with 8 months", "No gratuity or shows 0", "src/app", "Medium", "Manual"],
            ["Gratuity exactly 5 years", "5.0 years service", "21 days/year rate", "src/app", "Medium", "Manual"],
            ["Gratuity >5 years", "7 years service", "21 days for first 5, 30 days for 2", "src/app", "Medium", "Manual"],
            ["Gratuity with partial year", "5 years 6 months", "Pro-rated correctly", "src/app", "Medium", "Manual"],
            ["Gratuity after salary change", "Salary changed, calculate gratuity", "Uses final basic salary", "src/app", "Medium", "Manual"],
            ["Gratuity for contract employee", "Calculate for fixed-term contract", "Same rules apply", "src/app", "Medium", "Manual"]
        ],
        "Payslip Details": [
            ["View payslip", "Open payslip", "Shows all components", "src/app", "Medium", "Manual"],
            ["Basic salary shown", "Check payslip", "Basic salary displayed", "src/app", "Medium", "Manual"],
            ["Allowances itemized", "Check payslip", "Each allowance listed", "src/app", "Medium", "Manual"],
            ["Deductions itemized", "Check payslip", "Loan, unpaid leave shown", "src/app", "Medium", "Manual"],
            ["Net salary", "Check calculation", "Gross - deductions", "src/app", "Medium", "Manual"],
            ["Download PDF", "Download payslip", "PDF generated correctly", "src/app", "Medium", "Manual"],
            ["Payslip print", "Print payslip", "Formatted for printing", "src/app", "Medium", "Manual"],
            ["Payslip history", "View past payslips", "All months available", "src/app", "Medium", "Manual"]
        ]
    },
    "12. Spend Requests": {
        "Request Creation": [
            ["Title required (1-200 chars)", "Create without title", "Validation error", "src/features/purchase-requests/validations/purchase-request.ts", "Critical", "Automated"],
            ["At least 1 item required", "Create without items", "Validation error", "src/features/purchase-requests/validations/purchase-request.ts", "Critical", "Automated"],
            ["Priority: LOW/MEDIUM/HIGH/URGENT", "Create with invalid priority", "Validation error", "src/features/purchase-requests/validations/purchase-request.ts", "High", "Automated"],
            ["PROJECT_COST requires projectName", "Select PROJECT_COST without project", "Validation error", "src/features/purchase-requests/validations/purchase-request.ts", "High", "Automated"],
            ["Vendor email format validated", "Enter invalid vendor email", "Validation error", "src/features/purchase-requests/validations/purchase-request.ts", "Medium", "Automated"],
            ["Reference number auto-generated", "Create request", "Format: PR-YYYY-MMDD-SEQ", "src/features/purchase-requests/lib/purchase-request-creation.ts", "Medium", "Automated"]
        ],
        "Request Items": [
            ["Item description: 1-500 chars", "Empty description", "Validation error", "src/features/purchase-requests/validations/purchase-request.ts", "High", "Automated"],
            ["Quantity: integer min 1", "Quantity = 0", "Validation error", "src/features/purchase-requests/validations/purchase-request.ts", "High", "Automated"],
            ["Unit price: min 0", "Negative unit price", "Validation error", "src/features/purchase-requests/validations/purchase-request.ts", "High", "Automated"],
            ["Product URL format validated", "Invalid URL", "Validation error", "src/features/purchase-requests/validations/purchase-request.ts", "Medium", "Automated"],
            ["Total calculated automatically", "Add multiple items", "Total = sum of (qty * price)", "src/features/purchase-requests/lib/calculations.ts", "High", "Automated"],
            ["Currency conversion to QAR", "Items in USD", "totalAmountQAR calculated", "src/features/purchase-requests/lib/calculations.ts", "High", "Automated"]
        ],
        "Request Workflow": [
            ["PENDING -> SUBMITTED", "Submit request for approval", "Status = SUBMITTED", "src/app/api/purchase-requests/[id]/status/route.ts", "Critical", "E2E"],
            ["SUBMITTED -> UNDER_REVIEW", "Admin reviews request", "Status = UNDER_REVIEW", "src/app/api/purchase-requests/[id]/status/route.ts", "High", "E2E"],
            ["UNDER_REVIEW -> APPROVED", "Approve request", "Status = APPROVED", "src/app/api/purchase-requests/[id]/status/route.ts", "Critical", "E2E"],
            ["UNDER_REVIEW -> REJECTED", "Reject with reason", "Status = REJECTED", "src/app/api/purchase-requests/[id]/status/route.ts", "High", "E2E"],
            ["APPROVED -> COMPLETED", "Mark as completed", "Status = COMPLETED", "src/app/api/purchase-requests/[id]/status/route.ts", "High", "E2E"],
            ["Only PENDING can be edited", "Edit SUBMITTED request", "Error: cannot modify", "src/app/api/purchase-requests/[id]/route.ts", "High", "Automated"],
            ["Only PENDING can be deleted", "Delete APPROVED request", "Error: cannot delete", "src/app/api/purchase-requests/[id]/route.ts", "High", "Automated"]
        ],
        "Non-Admin Access": [
            ["Employee sees only own requests", "List requests as employee", "Only own requests shown", "src/app/api/purchase-requests/route.ts", "High", "Automated"],
            ["Employee can create request", "Create request as employee", "Request created", "src/app/api/purchase-requests/route.ts", "High", "E2E"],
            ["Employee can cancel own PENDING", "Cancel own pending request", "Request cancelled", "src/app/api/purchase-requests/[id]/route.ts", "High", "E2E"]
        ],
        "Creation": [
            ["Valid request", "Title, items, submit", "Request created with reference number", "src/app", "Medium", "Manual"],
            ["Empty item list", "Submit without any items", "Error: Minimum 1 item required", "src/app", "Medium", "Manual"],
            ["Item quantity zero", "Add item with qty=0", "Validation error", "src/app", "Medium", "Manual"],
            ["Item quantity negative", "Add item with qty=-5", "Validation error", "src/app", "Medium", "Manual"],
            ["Negative unit price", "Enter -100 for unit price", "Validation error", "src/app", "Medium", "Manual"],
            ["Multi-currency items", "Items in USD, EUR, GBP", "All converted to QAR total", "src/app", "Medium", "Manual"],
            ["Subscription item", "Add monthly subscription for 12 months", "Calculates total contract value", "src/app", "Medium", "Manual"],
            ["Project cost without project", "Select PROJECT_COST, no project linked", "Validation error", "src/app", "Medium", "Manual"],
            ["Priority levels", "Test LOW, MEDIUM, HIGH, URGENT", "All priority levels work", "src/app", "Medium", "Manual"],
            ["Add then delete all items", "Add 3 items, delete all, submit", "Error: No items to submit", "src/app", "Medium", "Manual"],
            ["Budget limit exceeded", "Request exceeds department budget", "Warning shown, can proceed or block", "src/app", "Medium", "Manual"]
        ],
        "Status Workflow": [
            ["Submit for review", "Create request", "Status = PENDING", "src/app", "Medium", "Manual"],
            ["Approve - single level", "Approve request", "Status = APPROVED", "src/app", "Medium", "Manual"],
            ["Approve - multi-level", "First level approves", "Status = PENDING, next notified", "src/app", "Medium", "Manual"],
            ["Complete request", "Mark as completed", "Status = COMPLETED, date set", "src/app", "Medium", "Manual"],
            ["Invalid transition", "PENDING to COMPLETED directly", "Validation error", "src/app", "Medium", "Manual"],
            ["Edit submitted PR", "Try to modify PENDING request", "Error 'Cannot edit submitted request'", "src/app", "Medium", "Manual"],
            ["Delete PR with approvals", "Delete partially approved PR", "Cancels approvals, deletes", "src/app", "Medium", "Manual"],
            ["Recall during approval", "Requester recalls while L1 approving", "Race condition handled", "src/app", "Medium", "Manual"],
            ["Approve recalled PR", "Approver clicks after recall", "Error 'Request recalled'", "src/app", "Medium", "Manual"],
            ["Complete without all approvals", "Mark complete before approved", "Error or not allowed", "src/app", "Medium", "Manual"],
            ["Reopen completed PR", "Try to modify COMPLETED", "Not allowed or creates new", "src/app", "Medium", "Manual"]
        ]
    },
    "13. Approval Workflows": {
        "Approval Policy": [
            ["Name required (1-100 chars)", "Create policy without name", "Validation error", "src/features/approvals/validations/approvals.ts", "High", "Automated"],
            ["Module: LEAVE_REQUEST/PURCHASE_REQUEST/ASSET_REQUEST", "Create with invalid module", "Validation error", "src/features/approvals/validations/approvals.ts", "High", "Automated"],
            ["1-5 approval levels", "Create with 0 levels", "Validation error", "src/features/approvals/validations/approvals.ts", "High", "Automated"],
            ["Approver role per level", "Define levels with roles", "Roles saved for each level", "src/features/approvals/validations/approvals.ts", "High", "Automated"],
            ["Priority for policy matching", "Create overlapping policies", "Higher priority used", "src/features/approvals/lib/policy-matcher.ts", "Medium", "Automated"]
        ],
        "Approval Processing": [
            ["Step initialized as PENDING", "Submit request matching policy", "Approval steps created as PENDING", "src/features/approvals/lib/approval-engine.ts", "High", "Automated"],
            ["ADMIN can approve any step", "Admin approves any level", "Step approved", "src/features/approvals/lib/approval-engine.ts", "High", "Automated"],
            ["User with matching role can approve", "Manager approves manager-level step", "Step approved", "src/features/approvals/lib/approval-engine.ts", "High", "Automated"],
            ["Delegation allows proxy approval", "Delegate approves for absent approver", "viaDelegation: true recorded", "src/features/approvals/lib/approval-engine.ts", "High", "Automated"],
            ["Self-approval prevented", "User tries to approve own request", "Error: cannot approve own request", "src/features/approvals/lib/approval-engine.ts", "Critical", "Automated"],
            ["Already processed step rejected", "Approve already approved step", "Error: step already processed", "src/features/approvals/lib/approval-engine.ts", "High", "Automated"]
        ],
        "Chain Completion": [
            ["All steps approved = entity approved", "Complete all approval levels", "Entity status = APPROVED", "src/features/approvals/lib/approval-engine.ts", "Critical", "Automated"],
            ["Rejection skips remaining steps", "Reject at level 1 of 3", "Levels 2 and 3 marked SKIPPED", "src/features/approvals/lib/approval-engine.ts", "High", "Automated"],
            ["Next approver notified after each step", "Approve step in multi-level", "Next approver gets notification", "src/features/approvals/lib/approval-engine.ts", "High", "Automated"],
            ["Requester notified on completion", "Complete approval chain", "Requester notified of approval", "src/features/approvals/lib/approval-engine.ts", "High", "Automated"]
        ],
        "Admin Bypass": [
            ["Admin can approve all steps at once", "Admin uses bypass", "All PENDING steps become APPROVED", "src/features/approvals/lib/approval-engine.ts", "High", "Automated"],
            ["Bypass notes recorded", "Admin bypasses with notes", "Notes: 'Approved by admin (bypass)'", "src/features/approvals/lib/approval-engine.ts", "Medium", "Automated"]
        ],
        "Delegation": [
            ["Create delegation for date range", "Delegate for vacation dates", "Delegation created", "src/app/api/delegations/route.ts", "High", "E2E"],
            ["Delegate can act during active delegation", "Approve during delegation period", "Approval processed as delegate", "src/features/approvals/lib/approval-engine.ts", "High", "Automated"],
            ["Expired delegation rejected", "Approve after delegation ended", "Error: no active delegation", "src/features/approvals/lib/approval-engine.ts", "High", "Automated"]
        ],
        "Policy Configuration": [
            ["Create policy", "Module + threshold + levels", "Policy created", "src/app", "Medium", "Manual"],
            ["Policy name required", "Leave name empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Policy module required", "Leave module empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Level order", "Levels 1, 2, 3", "Executed in order", "src/app", "Medium", "Manual"],
            ["Missing role", "Level requires MANAGER, no managers", "Level skipped", "src/app", "Medium", "Manual"],
            ["Threshold matching", "Request amount matches policy", "Correct policy applied", "src/app", "Medium", "Manual"],
            ["Multiple policies", "Same module, different thresholds", "Correct one selected", "src/app", "Medium", "Manual"],
            ["Policy priority", "Overlapping policies", "Highest priority used", "src/app", "Medium", "Manual"],
            ["Edit policy", "Modify existing", "Changes saved", "src/app", "Medium", "Manual"],
            ["Delete policy", "Remove policy", "Policy deleted", "src/app", "Medium", "Manual"],
            ["Delete policy with pending", "Delete policy with pending requests", "Handled gracefully", "src/app", "Medium", "Manual"]
        ],
        "Approval Levels": [
            ["Add level 1", "Add first level", "Level created", "src/app", "Medium", "Manual"],
            ["Add level 2", "Add second level", "Executes after L1", "src/app", "Medium", "Manual"],
            ["Add level 3", "Add third level", "Executes after L2", "src/app", "Medium", "Manual"],
            ["Level role selection", "Set approver role", "Only that role can approve", "src/app", "Medium", "Manual"],
            ["Level specific user", "Set specific approver", "Only that user can approve", "src/app", "Medium", "Manual"],
            ["Level department", "Set department", "Only dept manager can approve", "src/app", "Medium", "Manual"],
            ["Reorder levels", "Change level order", "Order updated", "src/app", "Medium", "Manual"],
            ["Delete level", "Remove middle level", "Remaining levels reorder", "src/app", "Medium", "Manual"]
        ],
        "Multi-Level Approvals": [
            ["Sequential approval", "L1 approves, L2 notified", "Works correctly", "src/app", "Medium", "Manual"],
            ["L1 pending", "Submit request", "L1 approvers notified", "src/app", "Medium", "Manual"],
            ["L1 approved", "L1 approves", "Status pending, L2 notified", "src/app", "Medium", "Manual"],
            ["L2 approved", "L2 approves", "Status pending or approved", "src/app", "Medium", "Manual"],
            ["L3 approved", "L3 approves", "Final approval", "src/app", "Medium", "Manual"],
            ["Skip to higher level", "Director approves L1 step", "L1 skipped, notes required", "src/app", "Medium", "Manual"],
            ["Rejection at L1", "L1 rejects", "Request rejected, no L2", "src/app", "Medium", "Manual"],
            ["Rejection at L2", "L2 rejects", "Request rejected", "src/app", "Medium", "Manual"],
            ["Rejection cascades", "L1 rejects", "All remaining skipped", "src/app", "Medium", "Manual"],
            ["Race condition", "Two L1 approvers click simultaneously", "Only one succeeds", "src/app", "Medium", "Manual"],
            ["Self-approval block", "Requester is also approver", "Cannot approve own", "src/app", "Medium", "Manual"],
            ["Parallel approvers", "L1 has 2 approvers", "Either can approve", "src/app", "Medium", "Manual"],
            ["All must approve", "L1 requires all", "Both must approve", "src/app", "Medium", "Manual"]
        ],
        "Approval Delegation": [
            ["Delegate approvals", "Set delegate user", "Delegate can approve", "src/app", "Medium", "Manual"],
            ["Delegation period", "Set start/end dates", "Only active in period", "src/app", "Medium", "Manual"],
            ["Delegation notification", "Set delegation", "Both users notified", "src/app", "Medium", "Manual"],
            ["Delegation expired", "Past end date", "Delegate cannot approve", "src/app", "Medium", "Manual"],
            ["Remove delegation", "Cancel delegation", "Delegate loses access", "src/app", "Medium", "Manual"],
            ["Delegate chain", "Delegate delegates", "Should be prevented", "src/app", "Medium", "Manual"],
            ["Delegate to self", "Set self as delegate", "Error 'Cannot delegate to self'", "src/app", "Medium", "Manual"],
            ["Delegator approves while delegated", "Original approver returns early", "Both can approve or priority rules", "src/app", "Medium", "Manual"],
            ["Delegate deletes account", "Delegate user is deleted", "Delegation invalidated", "src/app", "Medium", "Manual"]
        ],
        "Policy Edge Cases": [
            ["Overlapping policy thresholds", "Policy 1: 0-1000, Policy 2: 500-2000", "Correct policy selected", "src/app", "Medium", "Manual"],
            ["Policy with no levels", "Create policy with 0 approval levels", "Error or single-level default", "src/app", "Medium", "Manual"],
            ["Delete policy with active requests", "Delete policy, requests pending", "Requests continue with snapshot", "src/app", "Medium", "Manual"],
            ["Policy effective date future", "Policy starts next month", "Not applied until effective", "src/app", "Medium", "Manual"],
            ["Multiple policies same module", "3 leave policies, different thresholds", "Threshold matching works", "src/app", "Medium", "Manual"]
        ],
        "Notification Edge Cases": [
            ["Email to invalid address", "Approver has invalid email", "Admin notified of failure", "src/app", "Medium", "Manual"],
            ["WhatsApp to user without phone", "Approver has no phone number", "Falls back to email/in-app only", "src/app", "Medium", "Manual"],
            ["Notification to deleted user", "User deleted after request created", "Skipped gracefully", "src/app", "Medium", "Manual"],
            ["Bulk approval notifications", "Approve 20 requests at once", "Rate limited, all sent", "src/app", "Medium", "Manual"],
            ["Notification preference disabled", "User disabled email notifications", "Respects preference, uses other channels", "src/app", "Medium", "Manual"]
        ],
        "Approval Escalation": [
            ["Escalation timeout", "Set 48hr timeout", "Escalates after 48hr", "src/app", "Medium", "Manual"],
            ["Auto-escalate", "Timeout reached", "Next level notified", "src/app", "Medium", "Manual"],
            ["Escalation notification", "Escalation triggers", "All parties notified", "src/app", "Medium", "Manual"],
            ["No escalation level", "Last level timeout", "Admin notified", "src/app", "Medium", "Manual"],
            ["Manual escalation", "Approver escalates", "Next level takes over", "src/app", "Medium", "Manual"]
        ],
        "Approval Actions": [
            ["Approve with comment", "Add approval comment", "Comment saved", "src/app", "Medium", "Manual"],
            ["Reject with reason", "Reject with reason", "Reason required", "src/app", "Medium", "Manual"],
            ["Request more info", "Request clarification", "Requester notified", "src/app", "Medium", "Manual"],
            ["Requester responds", "Add requested info", "Approver notified", "src/app", "Medium", "Manual"],
            ["Recall request", "Requester recalls", "Request cancelled", "src/app", "Medium", "Manual"],
            ["Recall after approval", "Recall approved request", "Not allowed", "src/app", "Medium", "Manual"]
        ],
        "Approval History": [
            ["View approval history", "Check request history", "Shows all actions", "src/app", "Medium", "Manual"],
            ["History timestamps", "Check times", "Accurate timestamps", "src/app", "Medium", "Manual"],
            ["History users", "Check who approved", "Shows approver names", "src/app", "Medium", "Manual"],
            ["History comments", "Check comments", "Shows all comments", "src/app", "Medium", "Manual"],
            ["Audit trail", "Check audit log", "All actions logged", "src/app", "Medium", "Manual"]
        ]
    },
    "14. Notifications": {
        "In-App Notifications": [
            ["Leave submitted notification", "Submit leave request", "Approvers get notification", "src/lib/domains/system/notifications/notification-service.ts", "High", "Automated"],
            ["Leave approved notification", "Approve leave request", "Requester gets notification", "src/lib/domains/system/notifications/notification-service.ts", "High", "Automated"],
            ["Asset assigned notification", "Assign asset to employee", "Employee gets notification", "src/lib/domains/system/notifications/notification-service.ts", "High", "Automated"],
            ["Unread count accurate", "Check notification bell", "Shows correct unread count", "src/app/api/notifications/unread-count/route.ts", "Medium", "E2E"],
            ["Mark as read on click", "Click notification", "isRead = true", "src/app/api/notifications/[id]/read/route.ts", "Medium", "E2E"],
            ["Mark all as read", "Click 'mark all read'", "All notifications marked read", "src/app/api/notifications/route.ts", "Medium", "E2E"],
            ["Notification links to related item", "Click notification", "Navigates to correct page", "src/components/notifications/notification-item.tsx", "Medium", "E2E"]
        ],
        "WhatsApp Notifications": [
            ["Approval action link in WhatsApp", "Receive WhatsApp for approval", "Link works to approve", "src/lib/whatsapp/templates.ts", "High", "Manual"],
            ["Token invalidated after in-app action", "Approve in app, use WhatsApp link", "WhatsApp link disabled", "src/lib/whatsapp/tokens.ts", "Critical", "Automated"],
            ["Expired token rejected", "Use old WhatsApp link", "Error: token expired", "src/lib/whatsapp/tokens.ts", "High", "Automated"],
            ["One-time use token", "Use same token twice", "Second use fails", "src/lib/whatsapp/tokens.ts", "Critical", "Automated"]
        ]
    },
    "15. Company Documents": {
        "Document Management": [
            ["Document type name required", "Create without type name", "Validation error", "src/app/api/company-documents/route.ts", "Critical", "Automated"],
            ["Expiry date required", "Create without expiry", "Validation error", "src/app/api/company-documents/route.ts", "Critical", "Automated"],
            ["Upload document file", "Upload PDF/image", "File attached to document", "src/app/api/upload/route.ts", "High", "E2E"],
            ["View document details", "Click document row", "Details page shown", "src/app/admin/(operations)/documents/[id]/page.tsx", "Medium", "E2E"],
            ["Delete document", "Click delete, confirm", "Document removed", "src/app/api/company-documents/[id]/route.ts", "High", "E2E"],
            ["Create document", "Fill name, type, expiry", "Document created", "src/app", "Medium", "Manual"],
            ["Document name required", "Leave name empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Document type required", "Leave type empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Edit document", "Update fields, save", "Changes saved", "src/app", "Medium", "Manual"],
            ["Document categories", "Filter by type", "Shows filtered list", "src/app", "Medium", "Manual"]
        ],
        "Expiry Tracking": [
            ["Expiry alert 30 days", "Document expiring in 30 days", "Warning badge shown", "src/app/api/company-documents/expiry-alerts/route.ts", "High", "E2E"],
            ["Expiry alert 7 days", "Document expiring in 7 days", "Critical badge shown", "src/app/api/company-documents/expiry-alerts/route.ts", "High", "E2E"],
            ["Expired document status", "Document past expiry", "Expired status shown", "src/app/api/company-documents/expiry-alerts/route.ts", "High", "E2E"],
            ["Admin notified of expiring docs", "Document nearing expiry", "Admin receives alert", "src/app/api/cron/company-doc-expiry/route.ts", "High", "Manual"]
        ],
        "Document Expiry Tracking": [
            ["Expiry alert - 30 days", "Document expiring in 30 days", "Shows warning badge", "src/app", "Medium", "Manual"],
            ["Expiry alert - 7 days", "Document expiring in 7 days", "Shows critical badge", "src/app", "Medium", "Manual"],
            ["Expired document", "Document past expiry", "Shows expired status", "src/app", "Medium", "Manual"],
            ["Expiry notification", "Document nearing expiry", "Admin notified", "src/app", "Medium", "Manual"],
            ["Bulk expiry view", "View all expiring docs", "Shows sorted by expiry", "src/app", "Medium", "Manual"]
        ]
    },
    "16. Settings & Configuration": {
        "Organization Settings": [
            ["Update org name", "Change org name", "Name updated", "src/app/api/admin/organization/route.ts", "High", "E2E"],
            ["Update timezone", "Change timezone", "Timezone updated", "src/app/api/admin/organization/route.ts", "Medium", "E2E"],
            ["Update primary currency", "Change currency", "Currency updated", "src/app/api/admin/organization/route.ts", "Medium", "E2E"],
            ["Upload logo", "Upload new logo", "Logo updated", "src/app/api/organizations/logo/route.ts", "Medium", "E2E"],
            ["Code prefix: 2-3 chars uppercase", "Enter lowercase prefix", "Validation error or auto-uppercase", "src/app/api/admin/organization/route.ts", "Medium", "Automated"],
            ["Weekend days configuration", "Set weekend to Fri-Sat", "Weekends updated", "src/app/api/admin/organization/route.ts", "Medium", "E2E"]
        ],
        "Locations": [
            ["Create location", "Add new location", "Location created", "src/app/api/locations/route.ts", "Medium", "E2E"],
            ["Duplicate name rejected", "Create location with existing name", "Error: name exists", "src/app/api/locations/route.ts", "Medium", "Automated"],
            ["Delete location with assets", "Delete used location", "Error or reassign prompt", "src/app/api/locations/[id]/route.ts", "Medium", "Automated"],
            ["Asset count shown per location", "View locations list", "Shows asset count", "src/app/api/locations/route.ts", "Low", "E2E"]
        ],
        "Depreciation Categories": [
            ["Create depreciation category", "Add with useful life years", "Category created", "src/app/api/depreciation/categories/route.ts", "Medium", "E2E"],
            ["Set depreciation method", "Select straight-line", "Method saved", "src/app/api/depreciation/categories/route.ts", "Medium", "E2E"],
            ["Link to asset category", "Associate categories", "Link created", "src/app/api/depreciation/categories/route.ts", "Medium", "E2E"]
        ],
        "Exchange Rates": [
            ["View current rates", "Access exchange rate settings", "Current rates shown", "src/app/api/settings/exchange-rate/route.ts", "Medium", "E2E"],
            ["Update exchange rate", "Update USD to QAR rate", "Rate updated", "src/app/api/settings/exchange-rate/route.ts", "Medium", "E2E"]
        ]
    },
    "17. Super Admin": {
        "Super Admin Authentication": [
            ["Super admin login", "Enter super admin credentials", "Access granted to /super-admin", "src/app/super-admin/layout.tsx", "Critical", "Manual"],
            ["Invalid credentials rejected", "Enter wrong credentials", "Access denied", "src/app/super-admin/layout.tsx", "Critical", "Manual"],
            ["2FA verification required", "Enter 2FA code", "Verified, access granted", "src/app/super-admin/layout.tsx", "Critical", "Manual"],
            ["Invalid 2FA rejected", "Enter wrong 2FA", "Access denied", "src/app/super-admin/layout.tsx", "Critical", "Manual"],
            ["Session timeout", "Leave idle", "Logged out", "src/app/super-admin/layout.tsx", "High", "Manual"],
            ["2FA verification", "Enter 2FA code", "Verified successfully", "src/app", "Medium", "Manual"],
            ["Invalid 2FA", "Enter wrong 2FA code", "Access denied", "src/app", "Medium", "Manual"]
        ],
        "Organization Management": [
            ["View all organizations", "Navigate to orgs list", "All tenants shown", "src/app/api/super-admin/organizations/route.ts", "High", "E2E"],
            ["Search organizations", "Search by name/slug", "Matching orgs shown", "src/app/api/super-admin/organizations/route.ts", "Medium", "E2E"],
            ["Impersonate organization", "Click impersonate", "Enters org context as super admin", "src/app/api/super-admin/impersonate/route.ts", "Critical", "E2E"],
            ["Exit impersonation", "Click exit", "Returns to super admin", "src/middleware.ts", "High", "E2E"],
            ["Disable organization", "Disable org", "Org users cannot login", "src/app/api/super-admin/organizations/[id]/route.ts", "High", "Manual"],
            ["Enable organization", "Enable org", "Org users can login", "src/app/api/super-admin/organizations/[id]/route.ts", "High", "Manual"],
            ["View org details", "Click organization", "Shows org details", "src/app", "Medium", "Manual"],
            ["Impersonate org", "Click impersonate", "Enters org context", "src/app", "Medium", "Manual"]
        ],
        "Backup Management": [
            ["Create manual backup", "Trigger backup", "Backup created", "src/app/api/super-admin/backups/route.ts", "High", "E2E"],
            ["Download backup", "Download backup file", "File downloaded", "src/app/api/super-admin/backups/[id]/download/route.ts", "High", "E2E"],
            ["Restore from backup", "Restore backup", "Data restored", "src/app/api/super-admin/backups/[id]/restore/route.ts", "Critical", "Manual"],
            ["Scheduled backups run", "Check cron status", "Shows last run time", "src/app/api/super-admin/backups/cron/route.ts", "High", "Manual"],
            ["View backups", "Navigate to backups", "Shows backup list", "src/app", "Medium", "Manual"],
            ["Create backup", "Trigger manual backup", "Backup created", "src/app", "Medium", "Manual"],
            ["Restore backup", "Restore from backup", "Data restored", "src/app", "Medium", "Manual"],
            ["Scheduled backups", "Check cron status", "Shows last run time", "src/app", "Medium", "Manual"]
        ],
        "Impersonation Security": [
            ["Impersonation token signed", "Impersonate org", "JWT token with signature", "src/lib/security/impersonation.ts", "Critical", "Automated"],
            ["Token expires after limit", "Use old impersonation token", "Access denied", "src/lib/security/impersonation.ts", "Critical", "Automated"],
            ["Actions logged during impersonation", "Perform action while impersonating", "Logged with impersonator ID", "src/lib/security/impersonation.ts", "High", "Automated"]
        ],
        "User Management (Super Admin)": [
            ["View all users", "Navigate to users", "Shows all platform users", "src/app", "Medium", "Manual"],
            ["Search users", "Search by email/name", "Finds matching users", "src/app", "Medium", "Manual"],
            ["View user details", "Click user", "Shows user details", "src/app", "Medium", "Manual"],
            ["Reset user password", "Reset password", "Password reset", "src/app", "Medium", "Manual"],
            ["Disable user", "Disable user account", "User can't login", "src/app", "Medium", "Manual"],
            ["Enable user", "Enable user account", "User can login", "src/app", "Medium", "Manual"]
        ],
        "Platform Analytics": [
            ["View analytics", "Navigate to analytics", "Shows platform stats", "src/app", "Medium", "Manual"],
            ["User growth chart", "Check user chart", "Shows growth over time", "src/app", "Medium", "Manual"],
            ["Org growth chart", "Check org chart", "Shows org growth", "src/app", "Medium", "Manual"],
            ["Module usage", "Check module stats", "Shows module adoption", "src/app", "Medium", "Manual"],
            ["Onboarding funnel", "Check funnel", "Shows conversion rates", "src/app", "Medium", "Manual"]
        ]
    },
    "18. UI/UX Testing": {
        "Form Behavior": [
            ["Double submit prevention", "Click submit twice quickly", "Only one request sent", "src/components/ui/button.tsx", "High", "E2E"],
            ["Loading state on submit", "Submit form", "Button shows loading spinner", "src/components/ui/button.tsx", "Medium", "E2E"],
            ["Validation errors shown inline", "Submit invalid form", "Errors shown next to fields", "src/components/ui/form.tsx", "High", "E2E"],
            ["Form retains data on error", "Submit with error, fix", "Other field data retained", "src/components/ui/form.tsx", "Medium", "E2E"]
        ],
        "Navigation": [
            ["Sidebar navigation works", "Click sidebar items", "Navigate to correct pages", "src/components/layout/sidebar.tsx", "High", "E2E"],
            ["Breadcrumbs accurate", "Navigate deep", "Breadcrumbs show correct path", "src/components/ui/breadcrumb.tsx", "Medium", "E2E"],
            ["Back button works", "Click browser back", "Returns to previous page", "src/app/layout.tsx", "Medium", "E2E"]
        ],
        "Responsive Design": [
            ["Mobile sidebar collapse", "View on mobile", "Sidebar collapses to hamburger", "src/components/layout/sidebar.tsx", "High", "E2E"],
            ["Tables scroll horizontally", "View table on mobile", "Horizontal scroll enabled", "src/components/ui/table.tsx", "Medium", "E2E"],
            ["Forms stack on mobile", "View form on mobile", "Fields stack vertically", "src/components/ui/form.tsx", "Medium", "E2E"]
        ],
        "Error States": [
            ["404 page displayed", "Navigate to non-existent page", "Custom 404 shown", "src/app/not-found.tsx", "High", "E2E"],
            ["API error toast", "Trigger API error", "Error toast displayed", "src/components/ui/toast.tsx", "High", "E2E"],
            ["Empty states shown", "View empty list", "Empty state with CTA", "src/components/ui/empty-state.tsx", "Medium", "E2E"]
        ],
        "Loading States": [
            ["Page skeleton on load", "Navigate to data page", "Skeleton shown during load", "src/components/ui/skeleton.tsx", "Medium", "E2E"],
            ["Table skeleton", "Load data table", "Table skeleton shown", "src/components/ui/table-skeleton.tsx", "Medium", "E2E"],
            ["Infinite scroll indicator", "Scroll to load more", "Loading indicator shown", "src/components/ui/data-table.tsx", "Low", "E2E"]
        ]
    },
    "19. Edge Cases & Error Handling": {
        "Input Validation Boundaries": [
            ["Empty string on required field", "Submit empty required field", "Validation error with field name", "src/lib/http/responses.ts", "Critical", "Automated"],
            ["Max length boundary exact", "Enter exactly max chars", "Accepted", "src/features/assets/validations/assets.ts", "High", "Automated"],
            ["Max length boundary +1", "Enter max+1 characters", "Validation error: exceeds limit", "src/features/assets/validations/assets.ts", "High", "Automated"],
            ["Min value boundary exact", "Enter exact min value", "Accepted", "src/features/payroll/validations/payroll.ts", "High", "Automated"],
            ["Min value boundary -1", "Enter min-1 value", "Validation error: below minimum", "src/features/payroll/validations/payroll.ts", "High", "Automated"],
            ["Negative number where positive required", "Enter -100 for salary", "Validation error", "src/features/payroll/validations/payroll.ts", "Critical", "Automated"],
            ["Zero where positive required", "Enter 0 for quantity", "Validation error: min 1", "src/features/purchase-requests/validations/purchase-request.ts", "High", "Automated"],
            ["Decimal where integer required", "Enter 5.5 for installments", "Validation error or rounded", "src/features/payroll/validations/payroll.ts", "Medium", "Automated"],
            ["Very large number", "Enter 999999999999", "Handled gracefully", "src/lib/http/handler.ts", "High", "Automated"],
            ["Scientific notation", "Enter 1e10", "Parsed or rejected cleanly", "src/lib/http/handler.ts", "Low", "Automated"],
            ["Unicode characters in names", "Enter Arabic/Chinese chars", "Accepted and displayed correctly", "src/features/employees/validations/hr-profile.ts", "Medium", "Manual"],
            ["Emoji in text fields", "Enter emoji in notes field", "Accepted or cleanly rejected", "src/app/api/feedback/route.ts", "Low", "Manual"],
            ["SQL injection attempt in text", "Enter SELECT * FROM users", "Safely escaped, no execution", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"],
            ["XSS attempt in input", "Enter script tag with alert(1)", "Safely escaped in output", "src/components/ui/form.tsx", "Critical", "Automated"],
            ["HTML tags in text fields", "Enter HTML bold tags in notes", "Rendered as text not HTML", "src/components/ui/form.tsx", "High", "Automated"]
        ],
        "Date & Time Edge Cases": [
            ["Date in far future (Year 3000)", "Enter date 3000-01-01", "Should work or show limit error", "src/features/leave/validations/leave.ts", "Low", "Automated"],
            ["Date in far past (Year 1800)", "Enter date 1800-01-01", "Validation error for DOB/establishment", "src/features/employees/validations/hr-profile.ts", "Low", "Automated"],
            ["Leap year Feb 29", "Enter 2024-02-29", "Should work (valid leap year)", "src/features/leave/lib/leave-utils.ts", "Medium", "Automated"],
            ["Invalid Feb 29 in non-leap year", "Enter 2023-02-29", "Validation error: invalid date", "src/features/leave/lib/leave-utils.ts", "Medium", "Automated"],
            ["Timezone: Qatar (UTC+3) handling", "Create asset at 11pm Qatar", "Stored with correct timezone", "src/lib/qatar-timezone.ts", "High", "Automated"],
            ["DST handling (Qatar has no DST)", "Dates during DST periods", "No DST adjustment applied", "src/lib/qatar-timezone.ts", "Medium", "Automated"],
            ["Start date equals end date", "Leave request same start/end", "Allowed (single day leave)", "src/features/leave/lib/leave-request-validation.ts", "High", "Automated"],
            ["End date before start date", "Set end before start", "Validation error on end date", "src/features/leave/validations/leave.ts", "Critical", "Automated"]
        ],
        "API Error Responses": [
            ["Missing required body field", "POST without required field", "400 with field name in error", "src/lib/http/responses.ts", "Critical", "Automated"],
            ["Invalid JSON body", "Send malformed JSON", "400 Bad Request", "src/lib/http/handler.ts", "High", "Automated"],
            ["Wrong data type in field", "Send string for number field", "400 with type error", "src/lib/http/responses.ts", "High", "Automated"],
            ["Extra unknown fields in body", "Send body with extra fields", "Ignored (stripped) or 400", "src/lib/http/handler.ts", "Medium", "Automated"],
            ["Array where object expected", "Send [] instead of {}", "400 validation error", "src/lib/http/handler.ts", "Medium", "Automated"],
            ["Empty array where items required", "Send items: []", "400: at least 1 item required", "src/features/purchase-requests/validations/purchase-request.ts", "High", "Automated"],
            ["Null for required field", "Send null for required", "400 validation error", "src/lib/http/responses.ts", "High", "Automated"],
            ["Resource not found", "GET /api/assets/nonexistent", "404 Not Found", "src/lib/http/responses.ts", "Critical", "Automated"],
            ["Unauthorized request", "Request without auth header", "401 Unauthorized", "src/lib/http/handler.ts", "Critical", "Automated"],
            ["Forbidden resource", "Access other tenant's resource", "403 or 404", "src/lib/core/prisma-tenant.ts", "Critical", "Automated"],
            ["Method not allowed", "PUT on POST-only endpoint", "405 Method Not Allowed", "src/lib/http/handler.ts", "Medium", "Automated"],
            ["Rate limit exceeded", "Exceed request limit", "429 Too Many Requests with Retry-After", "src/lib/security/rateLimit.ts", "High", "Automated"],
            ["Server error graceful handling", "Trigger unhandled exception", "500 with generic message (no stack)", "src/lib/http/handler.ts", "Critical", "Automated"]
        ],
        "Concurrent Operations": [
            ["Double approval race condition", "Two users approve same step simultaneously", "Only one succeeds, other gets 409", "src/features/approvals/lib/approval-engine.ts", "Critical", "Automated"],
            ["Simultaneous leave for same dates", "Two requests for overlapping dates", "Second gets overlap error", "src/features/leave/lib/leave-request-validation.ts", "High", "Automated"],
            ["Asset tag generation race", "Create many assets rapidly", "All get unique tags (retry logic)", "src/features/assets/lib/asset-tag.ts", "High", "Automated"],
            ["Balance update race condition", "Two requests draining leave balance", "Second shows insufficient balance", "src/app/api/leave/requests/route.ts", "Critical", "Automated"],
            ["Subscription tag collision", "Create multiple subscriptions simultaneously", "All get unique tags", "src/features/subscriptions/lib/tag.ts", "High", "Automated"],
            ["Double payroll run creation", "Create same month/year twice", "Second returns error with existing ID", "src/app/api/payroll/runs/route.ts", "High", "Automated"],
            ["Concurrent profile updates", "Two updates to same employee", "Last write wins or conflict detection", "src/app/api/users/[id]/hr-profile/route.ts", "Medium", "Manual"]
        ]
    },
    "20. File Upload & Storage": {
        "File Upload Validation": [
            ["Upload valid PDF", "Upload .pdf file", "File uploaded, URL returned", "src/app/api/upload/route.ts", "High", "E2E"],
            ["Upload valid PNG image", "Upload .png file", "File uploaded successfully", "src/app/api/upload/route.ts", "High", "E2E"],
            ["Upload valid JPG image", "Upload .jpg file", "File uploaded successfully", "src/app/api/upload/route.ts", "High", "E2E"],
            ["Upload valid DOCX", "Upload .docx file", "File uploaded successfully", "src/app/api/upload/route.ts", "Medium", "E2E"],
            ["Upload valid XLSX", "Upload .xlsx file", "File uploaded successfully", "src/app/api/upload/route.ts", "Medium", "E2E"],
            ["Reject executable file", "Upload .exe file", "400 Error: invalid file type", "src/app/api/upload/route.ts", "Critical", "Automated"],
            ["Reject file exceeding size limit", "Upload >10MB file", "400 Error: file too large", "src/app/api/upload/route.ts", "High", "Automated"],
            ["Reject empty/zero-byte file", "Upload 0-byte file", "400 Error: empty file", "src/app/api/upload/route.ts", "High", "Automated"],
            ["MIME type validation", "Rename .exe to .pdf and upload", "Blocked by content type check", "src/app/api/upload/route.ts", "Critical", "Automated"],
            ["File exactly at size limit", "Upload exactly 10MB file", "Succeeds (boundary test)", "src/app/api/upload/route.ts", "Medium", "Manual"],
            ["File with special chars in name", "Upload file_with_special_chars.pdf", "Filename sanitized, uploaded", "src/app/api/upload/route.ts", "Medium", "Manual"],
            ["File with spaces in name", "Upload 'my document.pdf'", "Spaces handled correctly", "src/app/api/upload/route.ts", "Medium", "Manual"]
        ],
        "Storage Security": [
            ["Tenant isolation in storage path", "Upload file, check path", "Path includes tenant ID", "src/app/api/upload/route.ts", "Critical", "Automated"],
            ["Signed URL generation", "Get file URL", "URL is signed with expiry", "src/lib/storage/supabase.ts", "High", "Automated"],
            ["Expired URL rejected", "Use URL after expiry", "Access denied", "src/lib/storage/supabase.ts", "High", "Automated"],
            ["Path traversal attack blocked", "Filename with ../../../etc/passwd", "Path sanitized, attack blocked", "src/app/api/upload/route.ts", "Critical", "Automated"],
            ["Null byte injection blocked", "Filename with file%00.exe.pdf", "Blocked or sanitized", "src/app/api/upload/route.ts", "Critical", "Automated"],
            ["Direct bucket access blocked", "Try direct Supabase bucket access", "Requires signed URL or RLS blocks", "src/lib/storage/supabase.ts", "High", "Manual"]
        ],
        "Image Handling": [
            ["Profile photo upload", "Upload profile picture", "Image saved, URL returned", "src/app/api/users/me/photo/route.ts", "Medium", "E2E"],
            ["Organization logo upload", "Upload org logo", "Logo saved and displayed", "src/app/api/organizations/logo/route.ts", "Medium", "E2E"],
            ["Asset photo upload", "Upload asset image", "Image attached to asset", "src/app/api/assets/[id]/photo/route.ts", "Medium", "E2E"],
            ["Image preview after upload", "View uploaded image", "Preview displayed correctly", "src/components/ui/file-upload.tsx", "Medium", "E2E"],
            ["Delete uploaded image", "Delete image from asset", "Image removed from storage", "src/app/api/upload/route.ts", "Medium", "E2E"]
        ]
    },
    "21. Scheduled Tasks (Cron)": {
        "Cleanup Jobs": [
            ["Deleted assets cleanup after 30 days", "Wait for retention period", "Soft-deleted assets purged", "src/app/api/cron/cleanup-deleted-assets/route.ts", "High", "Manual"],
            ["Deleted users cleanup after retention", "Wait for retention period", "Soft-deleted users purged", "src/app/api/cron/cleanup-deleted-users/route.ts", "High", "Manual"],
            ["Chat/AI session cleanup", "Run chat cleanup cron", "Old chat sessions removed", "src/app/api/cron/chat-cleanup/route.ts", "Medium", "Manual"],
            ["Orphaned files cleanup", "Run storage cleanup", "Orphaned uploads removed", "src/app/api/cron/cleanup-storage/route.ts", "Low", "Manual"]
        ],
        "Alert Jobs": [
            ["Subscription renewal 30-day alert", "Subscription expiring in 30 days", "Alert notification sent", "src/app/api/cron/subscription-renewal/route.ts", "High", "Manual"],
            ["Warranty expiry 30-day alert", "Warranty expiring in 30 days", "Alert notification sent", "src/app/api/cron/warranty-expiry/route.ts", "High", "Manual"],
            ["Company document expiry alert", "Document expiring in 30 days", "Admin notified", "src/app/api/cron/company-doc-expiry/route.ts", "High", "Manual"],
            ["Employee document expiry alert", "Employee doc expiring in 30 days", "HR and employee notified", "src/app/api/cron/employee-doc-expiry/route.ts", "High", "Manual"],
            ["Alert not duplicated on re-run", "Run expiry alert twice same day", "No duplicate notifications", "src/app/api/cron/company-doc-expiry/route.ts", "Medium", "Manual"]
        ],
        "Calculation Jobs": [
            ["Depreciation cron runs monthly", "Wait for cron schedule", "Depreciation records created", "src/app/api/cron/depreciation/route.ts", "High", "Manual"],
            ["Depreciation calculation accuracy", "Verify calculated values", "Matches formula: (cost-salvage)/years", "src/features/assets/lib/depreciation/calculator.ts", "Critical", "Automated"],
            ["Leave accrual cron", "Run leave accrual", "Balances updated for new year", "src/app/api/cron/leave-accrual/route.ts", "High", "Manual"]
        ],
        "Cron Security": [
            ["Cron auth with valid CRON_SECRET", "Request with correct bearer token", "Job executes successfully", "src/lib/security/cron-auth.ts", "Critical", "Automated"],
            ["Cron auth with invalid secret", "Request with wrong token", "401 Unauthorized", "src/lib/security/cron-auth.ts", "Critical", "Automated"],
            ["Cron auth without bearer token", "Request without auth header", "401 Unauthorized", "src/lib/security/cron-auth.ts", "Critical", "Automated"],
            ["Cron idempotency on duplicate trigger", "Trigger same job twice", "Second run is no-op", "src/app/api/cron/depreciation/route.ts", "High", "Manual"]
        ]
    },
    "22. Data Integrity": {
        "Referential Integrity": [
            ["Delete employee unassigns assets first", "Delete employee with assigned assets", "Assets unassigned, then employee deleted", "src/app/api/users/[id]/route.ts", "Critical", "Automated"],
            ["Delete supplier cascades engagements", "Delete supplier with engagements", "Engagements deleted or blocked", "src/app/api/suppliers/[id]/route.ts", "High", "Automated"],
            ["Delete leave type blocks if requests exist", "Delete leave type with pending requests", "Error: type in use", "src/app/api/leave/types/[id]/route.ts", "High", "Automated"],
            ["Delete category warns about assets", "Delete category with assets", "Warning shown or blocked", "src/app/api/asset-categories/[id]/route.ts", "High", "Automated"],
            ["Delete user reassigns approval steps", "Delete user with pending approvals", "Steps reassigned or blocked", "src/app/api/users/[id]/route.ts", "High", "Manual"]
        ],
        "Balance & State Consistency": [
            ["Leave balance sync on approval", "Approve leave request", "Balance decremented atomically", "src/app/api/leave/requests/[id]/approve/route.ts", "Critical", "Automated"],
            ["Leave balance sync on cancellation", "Cancel approved leave", "Balance restored atomically", "src/app/api/leave/requests/[id]/route.ts", "Critical", "Automated"],
            ["Asset status sync on assignment", "Assign asset to employee", "Status = IN_USE, assignedMemberId set", "src/app/api/assets/[id]/assign/route.ts", "Critical", "Automated"],
            ["Approval chain state consistency", "Approve step in chain", "Next step activated atomically", "src/features/approvals/lib/approval-engine.ts", "Critical", "Automated"],
            ["Payroll calculation consistency", "Generate payslip", "Amounts match salary structure exactly", "src/features/payroll/lib/calculations.ts", "Critical", "Automated"],
            ["Depreciation book value consistency", "Run depreciation", "Book values updated consistently", "src/features/assets/lib/depreciation/calculator.ts", "High", "Automated"],
            ["Loan balance consistency", "Process loan repayment", "Remaining balance decremented correctly", "src/features/payroll/lib/calculations.ts", "High", "Automated"]
        ],
        "Transaction Atomicity": [
            ["Leave approval is atomic", "Approve leave, simulate failure mid-transaction", "Either all committed or all rolled back", "src/app/api/leave/requests/[id]/approve/route.ts", "Critical", "Automated"],
            ["Payroll processing is atomic", "Process payroll, simulate failure", "No partial payslips created", "src/app/api/payroll/runs/[id]/process/route.ts", "Critical", "Automated"],
            ["Asset assignment is atomic", "Assign asset, simulate failure", "No partial assignment state", "src/app/api/assets/[id]/assign/route.ts", "Critical", "Automated"]
        ]
    },
    "23. Performance & Browser Tests": {
        "Performance Benchmarks": [
            ["Page load time <3 seconds", "Navigate to dashboard", "Page interactive in <3s", "src/app/admin/dashboard/page.tsx", "High", "Manual"],
            ["List 100 assets <1 second", "Load assets page with 100 items", "Response in <1s", "src/app/api/assets/route.ts", "High", "Manual"],
            ["List 1000 assets with pagination", "Load large asset list", "Paginated, each page <1s", "src/app/api/assets/route.ts", "Medium", "Manual"],
            ["Search autocomplete <500ms", "Type search query", "Results appear in <500ms", "src/components/ui/search.tsx", "Medium", "Manual"],
            ["Large payroll run (100 employees)", "Process payroll for 100 employees", "Completes in reasonable time", "src/app/api/payroll/runs/[id]/process/route.ts", "Medium", "Manual"],
            ["Bulk import 500 assets", "Import large CSV file", "Completes without timeout", "src/app/api/assets/import/route.ts", "Medium", "Manual"],
            ["Export large dataset", "Export 1000+ records to CSV", "File generated without timeout", "src/app/api/assets/export/route.ts", "Medium", "Manual"]
        ],
        "Browser Compatibility": [
            ["Chrome latest version", "Full test suite in Chrome", "All features work correctly", "src/app/layout.tsx", "High", "Manual"],
            ["Firefox latest version", "Full test suite in Firefox", "All features work correctly", "src/app/layout.tsx", "High", "Manual"],
            ["Safari latest version", "Full test suite in Safari", "All features work correctly", "src/app/layout.tsx", "High", "Manual"],
            ["Edge latest version", "Full test suite in Edge", "All features work correctly", "src/app/layout.tsx", "Medium", "Manual"],
            ["Mobile Safari iOS 15+", "Test on iPhone", "Mobile layout works correctly", "src/app/layout.tsx", "High", "Manual"],
            ["Mobile Chrome Android", "Test on Android device", "Mobile layout works correctly", "src/app/layout.tsx", "High", "Manual"]
        ],
        "Memory & Network": [
            ["No memory leaks on navigation", "Navigate pages repeatedly", "Memory stable (no continuous growth)", "src/app/layout.tsx", "Medium", "Manual"],
            ["Offline graceful degradation", "Disconnect network mid-use", "Graceful error messages", "src/lib/http/handler.ts", "Low", "Manual"],
            ["Slow network handling", "Throttle to 3G speed", "Loading states shown, no timeout errors", "src/components/ui/skeleton.tsx", "Low", "Manual"]
        ]
    },
    "24. Security Specific Tests": {
        "CSRF Protection": [
            ["CSRF token required for mutations", "POST without CSRF token", "403 Forbidden", "src/lib/security/csrf.ts", "Critical", "Automated"],
            ["CSRF token validated per request", "POST with old/invalid token", "403 Forbidden", "src/lib/security/csrf.ts", "Critical", "Automated"],
            ["CSRF token refreshed on session", "Login, check token", "New token generated", "src/lib/security/csrf.ts", "High", "Automated"],
            ["GET requests bypass CSRF", "GET request without token", "Request succeeds", "src/lib/security/csrf.ts", "Medium", "Automated"]
        ],
        "Security Headers": [
            ["X-Content-Type-Options: nosniff", "Check response headers", "Header present", "src/middleware.ts", "High", "Automated"],
            ["X-Frame-Options: DENY", "Check response headers", "Header present", "src/middleware.ts", "High", "Automated"],
            ["X-XSS-Protection: 1; mode=block", "Check response headers", "Header present", "src/middleware.ts", "High", "Automated"],
            ["Strict-Transport-Security", "Check response headers", "HSTS header present in production", "src/middleware.ts", "High", "Automated"],
            ["Content-Security-Policy", "Check response headers", "CSP header configured", "src/middleware.ts", "Medium", "Automated"]
        ],
        "Impersonation Security": [
            ["Impersonation JWT properly signed", "Impersonate organization", "JWT uses secret, has expiry", "src/lib/security/impersonation.ts", "Critical", "Automated"],
            ["Impersonation token expires", "Use old impersonation token", "Access denied after expiry", "src/lib/security/impersonation.ts", "Critical", "Automated"],
            ["Impersonation actions logged", "Perform action while impersonating", "Logged with impersonator ID", "src/lib/security/impersonation.ts", "High", "Automated"],
            ["Cannot impersonate without super admin", "Regular admin tries impersonation", "Access denied", "src/app/api/super-admin/impersonate/route.ts", "Critical", "Automated"]
        ],
        "Data Exposure Prevention": [
            ["Passwords never returned in API", "Get user details", "Password hash not in response", "src/app/api/users/route.ts", "Critical", "Automated"],
            ["Sensitive fields masked in responses", "Get employee with QID", "QID partially masked", "src/features/employees/lib/hr-utils.ts", "High", "Automated"],
            ["Error messages don't expose stack", "Trigger server error", "Generic error, no stack trace", "src/lib/http/handler.ts", "Critical", "Automated"],
            ["Database errors don't expose schema", "Trigger DB constraint error", "Generic error message", "src/lib/http/handler.ts", "Critical", "Automated"]
        ]
    },
    "25. Team Management": {
        "Team Invitations": [
            ["Create invitation with valid email", "Enter email, send invite", "Invitation created, email sent", "src/app/api/admin/team/invitations/route.ts", "High", "E2E"],
            ["Duplicate email rejected", "Invite already-invited email", "Error: already invited", "src/app/api/admin/team/invitations/route.ts", "High", "Automated"],
            ["Existing member email rejected", "Invite existing member", "Error: already a member", "src/app/api/admin/team/invitations/route.ts", "High", "Automated"],
            ["Invalid email format rejected", "Invite with invalid email", "Validation error", "src/app/api/admin/team/invitations/route.ts", "High", "Automated"],
            ["User limit enforced", "Invite when at tier limit", "Error: user limit reached", "src/lib/multi-tenant/limits.ts", "High", "Automated"],
            ["Resend invitation", "Click resend button", "New token generated, email sent", "src/app/api/admin/team/[memberId]/resend/route.ts", "Medium", "E2E"],
            ["Revoke invitation", "Cancel pending invitation", "Invitation deleted", "src/app/api/admin/team/invitations/[id]/route.ts", "Medium", "E2E"],
            ["Invitation expiry", "Use expired invite link", "Error: invitation expired", "src/app/api/invite/[token]/route.ts", "High", "Automated"]
        ],
        "Accepting Invitations": [
            ["Accept as new user", "Create account via invite link", "Account created with correct role", "src/app/api/invite/[token]/route.ts", "Critical", "E2E"],
            ["Accept as existing user", "Login and accept invite", "Added to organization", "src/app/api/invite/[token]/route.ts", "High", "E2E"],
            ["Expired invite rejected", "Use old invite link", "Error: expired or invalid", "src/app/api/invite/[token]/route.ts", "High", "Automated"],
            ["Revoked invite rejected", "Use revoked invite link", "Error: invitation not found", "src/app/api/invite/[token]/route.ts", "High", "Automated"],
            ["Role assigned correctly", "Accept invite with ADMIN role", "User has admin privileges", "src/app/api/invite/[token]/route.ts", "High", "E2E"]
        ],
        "Member Management": [
            ["Update member role", "Change user to ADMIN", "Role updated", "src/app/api/admin/team/[memberId]/route.ts", "High", "E2E"],
            ["Update member permissions", "Grant HR access", "Permission updated", "src/app/api/admin/team/[memberId]/route.ts", "High", "E2E"],
            ["Remove member (soft delete)", "Remove team member", "User soft deleted", "src/app/api/admin/team/[memberId]/route.ts", "High", "E2E"],
            ["Cannot remove self", "Try to delete own account", "Error: cannot delete yourself", "src/app/api/admin/team/[memberId]/route.ts", "High", "Automated"],
            ["Cannot remove owner", "Try to delete org owner", "Error: cannot delete owner", "src/app/api/admin/team/[memberId]/route.ts", "Critical", "Automated"],
            ["Restore deleted member", "Restore soft-deleted user", "User restored, can login again", "src/app/api/users/[id]/restore/route.ts", "High", "E2E"]
        ]
    },
    "26. Reports & Analytics": {
        "Report Generation": [
            ["Asset summary report", "Generate asset report", "Shows asset statistics", "src/app/admin/(reports)/reports/page.tsx", "Medium", "E2E"],
            ["Leave summary report", "Generate leave report", "Shows leave statistics by type", "src/app/admin/(reports)/reports/page.tsx", "Medium", "E2E"],
            ["Employee headcount report", "Generate employee report", "Shows employee data", "src/app/admin/(reports)/reports/page.tsx", "Medium", "E2E"],
            ["Date range filter works", "Select custom date range", "Report filtered by dates", "src/app/admin/(reports)/reports/page.tsx", "Medium", "E2E"],
            ["Export report to CSV", "Click export CSV", "CSV file downloaded", "src/app/admin/(reports)/reports/page.tsx", "Medium", "E2E"],
            ["Export report to PDF", "Click export PDF", "PDF file downloaded", "src/app/admin/(reports)/reports/page.tsx", "Medium", "E2E"]
        ],
        "Dashboard Analytics": [
            ["Asset count card accurate", "Check dashboard stat", "Matches actual asset count", "src/app/admin/dashboard/page.tsx", "High", "E2E"],
            ["Employee count card accurate", "Check dashboard stat", "Matches actual employee count", "src/app/admin/dashboard/page.tsx", "High", "E2E"],
            ["Pending approvals count", "Check pending approvals stat", "Matches pending items", "src/app/admin/dashboard/page.tsx", "High", "E2E"],
            ["Expiring documents widget", "View expiring docs widget", "Shows documents expiring soon", "src/components/dashboard/expiring-documents.tsx", "Medium", "E2E"],
            ["Subscription renewal widget", "View renewal widget", "Shows upcoming renewals", "src/components/dashboard/subscription-renewals.tsx", "Medium", "E2E"]
        ],
        "Report Permissions": [
            ["Admin can access all reports", "Admin views reports page", "Full access", "src/middleware.ts", "High", "E2E"],
            ["Employee cannot access reports", "Employee tries /admin/reports", "Access denied", "src/middleware.ts", "High", "E2E"],
            ["HR reports need HR access", "Non-HR tries HR report", "Access denied or limited", "src/middleware.ts", "High", "E2E"]
        ]
    },
    "27. Activity & Audit Logs": {
        "Activity Logging": [
            ["Login activity logged", "User logs in", "Login action recorded with IP", "src/app/api/activity/route.ts", "High", "Automated"],
            ["Create actions logged", "Create any entity", "CREATE action recorded", "src/lib/core/activity.ts", "High", "Automated"],
            ["Update actions logged", "Update any entity", "UPDATE action recorded with changes", "src/lib/core/activity.ts", "High", "Automated"],
            ["Delete actions logged", "Delete any entity", "DELETE action recorded", "src/lib/core/activity.ts", "High", "Automated"],
            ["Approval actions logged", "Approve request", "APPROVE action recorded", "src/lib/core/activity.ts", "High", "Automated"],
            ["Settings changes logged", "Change org settings", "Settings change recorded", "src/lib/core/activity.ts", "High", "Automated"],
            ["IP address captured", "Perform any action", "IP address recorded with action", "src/lib/core/activity.ts", "Medium", "Automated"]
        ],
        "Activity Log Viewing": [
            ["View activity log page", "Navigate to /admin/activity", "Shows activity list", "src/app/admin/(system)/activity/page.tsx", "Medium", "E2E"],
            ["Filter by user", "Select user filter", "Shows only that users actions", "src/app/api/activity/route.ts", "Medium", "E2E"],
            ["Filter by action type", "Select action type filter", "Shows only that action type", "src/app/api/activity/route.ts", "Medium", "E2E"],
            ["Filter by date range", "Select date range", "Shows actions in range", "src/app/api/activity/route.ts", "Medium", "E2E"],
            ["Pagination works", "Navigate to page 2", "Next page of results shown", "src/app/api/activity/route.ts", "Medium", "E2E"],
            ["Search activity logs", "Search by keyword", "Matching entries found", "src/app/api/activity/route.ts", "Low", "E2E"]
        ]
    },
    "29. Data Import/Export": {
        "Asset Import": [
            ["Download import template", "Click download template", "CSV template downloaded", "src/app/admin/(operations)/assets/import/page.tsx", "High", "E2E"],
            ["Import valid CSV file", "Upload properly formatted CSV", "Assets created from data", "src/app/api/assets/import/route.ts", "High", "E2E"],
            ["Import shows preview", "Upload CSV", "Preview shows before final import", "src/features/assets/components/import-preview.tsx", "Medium", "E2E"],
            ["Missing required column error", "Upload CSV missing type column", "Error listing missing columns", "src/features/assets/lib/import.ts", "High", "Automated"],
            ["Invalid data in row error", "Upload CSV with invalid data", "Errors shown with row numbers", "src/features/assets/lib/import.ts", "High", "Automated"],
            ["Duplicate asset tag handling", "Upload CSV with duplicate tags", "Duplicates flagged or rejected", "src/features/assets/lib/import.ts", "High", "Automated"],
            ["Partial import option", "Upload with some invalid rows", "Valid rows imported, errors listed", "src/features/assets/lib/import.ts", "Medium", "E2E"],
            ["Large file import (1000+ rows)", "Upload large CSV file", "Imports successfully (may take time)", "src/app/api/assets/import/route.ts", "Medium", "Manual"]
        ],
        "Export Functionality": [
            ["Export all assets to CSV", "Click export with no filters", "All assets exported", "src/app/api/assets/export/route.ts", "High", "E2E"],
            ["Export filtered results", "Apply filter, then export", "Only filtered data exported", "src/app/api/assets/export/route.ts", "High", "E2E"],
            ["Export includes all columns", "Check exported CSV", "All relevant fields included", "src/app/api/assets/export/route.ts", "Medium", "E2E"],
            ["Export subscriptions to CSV", "Export subscriptions", "CSV file downloaded", "src/app/api/subscriptions/export/route.ts", "High", "E2E"],
            ["Export employees to CSV", "Export employees (HR access)", "CSV file downloaded", "src/app/api/employees/export/route.ts", "High", "E2E"]
        ],
        "Backup & Restore": [
            ["Create organization backup", "Click create backup", "Backup file generated", "src/app/api/admin/full-backup/route.ts", "High", "E2E"],
            ["Download backup file", "Download created backup", "JSON/ZIP file downloaded", "src/app/api/admin/full-backup/route.ts", "High", "E2E"],
            ["Restore from backup", "Upload backup file, restore", "Data restored correctly", "src/app/api/admin/full-restore/route.ts", "Critical", "Manual"],
            ["Restore preserves relationships", "Restore backup, verify data", "Foreign keys intact", "src/app/api/admin/full-restore/route.ts", "Critical", "Manual"]
        ]
    },
    "30. Public Holidays": {
        "Holiday Management": [
            ["Create public holiday", "Add new holiday with date", "Holiday created", "src/app/api/admin/public-holidays/route.ts", "Medium", "E2E"],
            ["Holiday name required", "Create without name", "Validation error", "src/app/api/admin/public-holidays/route.ts", "Medium", "Automated"],
            ["Holiday date required", "Create without date", "Validation error", "src/app/api/admin/public-holidays/route.ts", "Medium", "Automated"],
            ["Edit public holiday", "Update holiday name or date", "Holiday updated", "src/app/api/admin/public-holidays/[id]/route.ts", "Medium", "E2E"],
            ["Delete public holiday", "Remove holiday", "Holiday deleted", "src/app/api/admin/public-holidays/[id]/route.ts", "Medium", "E2E"],
            ["List holidays by year", "View holidays for 2025", "2025 holidays shown", "src/app/api/admin/public-holidays/route.ts", "Medium", "E2E"]
        ],
        "Holiday Effect on Leave": [
            ["Leave excludes public holidays", "Request leave spanning holiday", "Holiday days not counted", "src/features/leave/lib/leave-utils.ts", "High", "Automated"],
            ["Holiday shown in calendar", "View leave calendar", "Holidays displayed", "src/app/admin/(hr)/leave/calendar/page.tsx", "Medium", "E2E"]
        ]
    },
    "31. Feedback System": {
        "Feedback Submission": [
            ["Submit feedback with category", "Enter feedback, select category", "Feedback saved", "src/app/api/feedback/route.ts", "Medium", "E2E"],
            ["Feedback message required", "Submit empty feedback", "Validation error", "src/app/api/feedback/route.ts", "Medium", "Automated"],
            ["Feedback category required", "Submit without category", "Validation error", "src/app/api/feedback/route.ts", "Medium", "Automated"],
            ["Include screenshot with feedback", "Upload screenshot", "Image attached", "src/app/api/feedback/route.ts", "Low", "E2E"],
            ["View own feedback history", "Check feedback list", "Own submissions shown", "src/app/api/feedback/route.ts", "Low", "E2E"]
        ],
        "Feedback Admin": [
            ["Admin can view all feedback", "Admin views feedback page", "All org feedback shown", "src/app/api/feedback/route.ts", "Medium", "E2E"],
            ["Mark feedback as reviewed", "Update feedback status", "Status updated", "src/app/api/feedback/[id]/route.ts", "Low", "E2E"],
            ["Add notes to feedback", "Admin adds notes", "Notes saved", "src/app/api/feedback/[id]/route.ts", "Low", "E2E"]
        ]
    },
    "32. AI Chat Integration": {
        "Chat Functionality": [
            ["Send message to AI assistant", "Type message, send", "Response received", "src/app/api/chat/route.ts", "Medium", "E2E"],
            ["Stream response for long answers", "Ask complex question", "Response streams in", "src/app/api/chat/stream/route.ts", "Medium", "E2E"],
            ["Chat context maintained", "Ask follow-up question", "AI remembers context", "src/app/api/chat/route.ts", "Medium", "E2E"],
            ["Clear chat history", "Click clear button", "History cleared", "src/components/chat/chat-container.tsx", "Low", "E2E"],
            ["Rate limit on chat requests", "Send many messages quickly", "Rate limited", "src/app/api/chat/route.ts", "Medium", "Automated"]
        ],
        "AI Features": [
            ["AI usage tracked", "Use AI assistant", "Token usage recorded", "src/app/api/admin/(system)/settings/ai-usage/page.tsx", "Low", "E2E"],
            ["AI tier limits enforced", "Exceed tier chat limit", "Upgrade prompt shown", "src/lib/multi-tenant/limits.ts", "Medium", "Automated"]
        ]
    },
    "33. Exchange Rates": {
        "Rate Management": [
            ["View current exchange rates", "Open exchange rate settings", "Current rates displayed", "src/app/api/exchange-rates/route.ts", "Medium", "E2E"],
            ["Update exchange rate", "Change USD to QAR rate", "Rate updated", "src/app/api/settings/exchange-rate/route.ts", "Medium", "E2E"],
            ["Rate positive number required", "Enter 0 or negative rate", "Validation error", "src/app/api/settings/exchange-rate/route.ts", "High", "Automated"],
            ["Fetch latest rates from API", "Click refresh rates", "Rates updated from provider", "src/app/api/exchange-rates/route.ts", "Low", "Manual"]
        ],
        "Currency Conversion": [
            ["Asset price converts to QAR", "Create asset in USD", "priceQAR calculated", "src/features/assets/lib/currency.ts", "High", "Automated"],
            ["Subscription cost converts to QAR", "Create subscription in EUR", "costQAR calculated", "src/features/subscriptions/lib/currency.ts", "High", "Automated"],
            ["Conversion uses org rate", "Check converted value", "Uses org-specific rate", "src/features/assets/lib/currency.ts", "High", "Automated"],
            ["Zero rate handled gracefully", "Rate not configured", "Uses 1:1 or shows error", "src/features/assets/lib/currency.ts", "Medium", "Automated"]
        ]
    },
    "34. View Mode Toggle": {
        "Employee/Admin View": [
            ["Admin can switch to employee view", "Toggle to employee view", "UI shows employee perspective", "src/app/api/view-mode/route.ts", "Medium", "E2E"],
            ["Switch back to admin view", "Toggle to admin view", "Full admin UI restored", "src/app/api/view-mode/route.ts", "Medium", "E2E"],
            ["Employee cannot access admin view", "Employee toggle view", "Only employee view available", "src/middleware.ts", "High", "E2E"],
            ["View mode persists across pages", "Navigate while in employee view", "Stays in employee view", "src/app/api/view-mode/route.ts", "Medium", "E2E"]
        ]
    },
    "35. Gratuity Calculations": {
        "Eligibility": [
            ["Less than 1 year = ineligible", "Check gratuity for 6 month employee", "eligible: false", "src/features/payroll/lib/gratuity.ts", "Critical", "Automated"],
            ["Exactly 1 year = eligible", "Check gratuity for 12 month employee", "eligible: true", "src/features/payroll/lib/gratuity.ts", "Critical", "Automated"],
            ["More than 1 year = eligible", "Check gratuity for 2 year employee", "eligible: true", "src/features/payroll/lib/gratuity.ts", "Critical", "Automated"]
        ],
        "Calculation Formula": [
            ["Basic calculation: 3 weeks per year", "Calculate 1 year gratuity", "= (Basic/30) * 21", "src/features/payroll/lib/gratuity.ts", "Critical", "Automated"],
            ["Pro-rata partial years", "Calculate 1.5 year gratuity", "= 1.5 * annual amount", "src/features/payroll/lib/gratuity.ts", "High", "Automated"],
            ["Uses current basic salary", "Calculate with salary history", "Uses latest basic", "src/features/payroll/lib/gratuity.ts", "High", "Automated"],
            ["Projections for future years", "View gratuity projections", "Shows 1, 3, 5, 10 year amounts", "src/features/payroll/lib/gratuity.ts", "Medium", "E2E"]
        ],
        "Display & Export": [
            ["View gratuity report", "Access gratuity page", "All employees shown with amounts", "src/app/admin/(hr)/payroll/gratuity/page.tsx", "Medium", "E2E"],
            ["Export gratuity report", "Export to CSV", "CSV with gratuity data", "src/app/admin/(hr)/payroll/gratuity/page.tsx", "Low", "E2E"]
        ]
    },
    "36. Module Dependencies": {
        "Dependency Enforcement": [
            ["Leave requires employees module", "Disable employees, check leave", "Leave also disabled", "src/lib/modules/registry.ts", "High", "Automated"],
            ["Payroll requires employees module", "Disable employees, check payroll", "Payroll also disabled", "src/lib/modules/registry.ts", "High", "Automated"],
            ["Enabling module enables dependencies", "Enable leave module", "Employees also enabled", "src/lib/modules/registry.ts", "High", "Automated"],
            ["Warning when disabling with dependents", "Disable employees with leave enabled", "Warning shown about dependents", "src/app/api/modules/route.ts", "Medium", "Manual"]
        ],
        "Module Data Count": [
            ["Check data count before disable", "View module data count", "Shows records that will be affected", "src/app/api/modules/[moduleId]/data-count/route.ts", "Medium", "E2E"],
            ["Empty module can be disabled", "Disable module with no data", "Disabled without warning", "src/app/api/modules/route.ts", "Medium", "E2E"]
        ]
    },
    "37. Subscription Tier Limits": {
        "User Limits": [
            ["FREE tier: 5 users max", "Add 6th user on FREE", "Error: user limit reached", "src/lib/multi-tenant/limits.ts", "Critical", "Automated"],
            ["STARTER tier: 15 users max", "Add 16th user on STARTER", "Error: user limit reached", "src/lib/multi-tenant/limits.ts", "High", "Automated"],
            ["PROFESSIONAL tier: 50 users max", "Add 51st user on PROFESSIONAL", "Error: user limit reached", "src/lib/multi-tenant/limits.ts", "High", "Automated"],
            ["ENTERPRISE tier: unlimited users", "Add many users on ENTERPRISE", "All accepted", "src/lib/multi-tenant/limits.ts", "High", "Automated"]
        ],
        "Asset Limits": [
            ["FREE tier: 50 assets max", "Add 51st asset on FREE", "Error: asset limit reached", "src/lib/multi-tenant/limits.ts", "Critical", "Automated"],
            ["STARTER tier: 200 assets max", "Add 201st asset on STARTER", "Error: asset limit reached", "src/lib/multi-tenant/limits.ts", "High", "Automated"],
            ["PROFESSIONAL tier: 1000 assets max", "Add 1001st asset on PROFESSIONAL", "Error: asset limit reached", "src/lib/multi-tenant/limits.ts", "High", "Automated"],
            ["ENTERPRISE tier: unlimited assets", "Add many assets on ENTERPRISE", "All accepted", "src/lib/multi-tenant/limits.ts", "High", "Automated"]
        ],
        "Module Access by Tier": [
            ["FREE tier has basic modules", "Check available modules", "assets, subscriptions, suppliers", "src/lib/multi-tenant/feature-flags.ts", "High", "Automated"],
            ["STARTER adds HR modules", "Check STARTER modules", "adds employees, leave", "src/lib/multi-tenant/feature-flags.ts", "High", "Automated"],
            ["PROFESSIONAL has all modules", "Check PROFESSIONAL modules", "All modules available", "src/lib/multi-tenant/feature-flags.ts", "High", "Automated"],
            ["Upgrade prompt for locked modules", "Access locked module", "Upgrade CTA shown", "src/components/upgrade-prompt.tsx", "Medium", "E2E"]
        ]
    },
    "38. Password Reset Flow": {
        "Request Reset": [
            ["Valid email sends reset link", "Request reset for existing email", "Email sent with link", "src/app/api/auth/reset-password/route.ts", "Critical", "Automated"],
            ["Invalid email shows same message", "Request reset for non-existent email", "Same success message (no enumeration)", "src/app/api/auth/reset-password/route.ts", "Critical", "Automated"],
            ["Rate limited after multiple requests", "Request reset 5 times rapidly", "Rate limited", "src/lib/security/rateLimit.ts", "High", "Automated"]
        ],
        "Reset Token": [
            ["Token valid for limited time", "Use token within time limit", "Password reset succeeds", "src/app/api/auth/set-password/route.ts", "Critical", "Automated"],
            ["Expired token rejected", "Use old token", "Error: token expired", "src/app/api/auth/set-password/route.ts", "Critical", "Automated"],
            ["Token invalidated after use", "Use token twice", "Second use fails", "src/app/api/auth/set-password/route.ts", "Critical", "Automated"],
            ["Invalid token rejected", "Use fake token", "Error: invalid token", "src/app/api/auth/set-password/route.ts", "Critical", "Automated"]
        ],
        "New Password": [
            ["Password meets requirements", "Set strong password", "Password updated", "src/app/api/auth/set-password/route.ts", "Critical", "Automated"],
            ["Weak password rejected", "Set weak password", "Validation error", "src/lib/security/password-validation.ts", "Critical", "Automated"],
            ["Login works with new password", "Login after reset", "Successfully authenticated", "src/lib/core/auth.ts", "Critical", "E2E"],
            ["Old password no longer works", "Try old password after reset", "Authentication failed", "src/lib/core/auth.ts", "Critical", "Automated"]
        ]
    },
    "39. Offboarding Flow": {
        "Initiate Offboarding": [
            ["Admin can offboard employee", "Click offboard button", "Offboarding initiated", "src/app/api/users/[id]/offboard/route.ts", "High", "E2E"],
            ["Set last working day", "Enter last working day", "Date saved", "src/app/api/users/[id]/offboard/route.ts", "High", "E2E"],
            ["Offboarding reason required", "Offboard without reason", "Validation error", "src/app/api/users/[id]/offboard/route.ts", "High", "Automated"],
            ["Select offboarding type", "Choose resignation/termination", "Type saved", "src/app/api/users/[id]/offboard/route.ts", "Medium", "E2E"]
        ],
        "Offboarding Effects": [
            ["Assets marked for return", "Complete offboarding", "Assigned assets flagged", "src/features/employees/lib/offboarding.ts", "High", "Automated"],
            ["Leave balance frozen", "Complete offboarding", "No new leave requests allowed", "src/features/employees/lib/offboarding.ts", "High", "Automated"],
            ["Gratuity calculated", "View offboarding summary", "Final gratuity shown", "src/features/payroll/lib/gratuity.ts", "High", "Automated"],
            ["Login disabled after last day", "Try login after last day", "Account disabled", "src/lib/core/auth.ts", "High", "Manual"],
            ["Status banner shown", "View offboarding employee", "Offboarding status banner visible", "src/features/employees/components/offboarding-status-banner.tsx", "Medium", "E2E"]
        ]
    },
    "40. Change Request System": {
        "Request Profile Change": [
            ["Employee can request change", "Submit change request", "Request created as pending", "src/app/api/users/me/change-requests/route.ts", "High", "E2E"],
            ["Specify fields to change", "Request bank details change", "Field changes recorded", "src/app/api/users/me/change-requests/route.ts", "High", "E2E"],
            ["Attach supporting document", "Upload document with request", "Document attached", "src/app/api/users/me/change-requests/route.ts", "Medium", "E2E"],
            ["View own pending requests", "Check my change requests", "Own requests shown", "src/app/api/users/me/change-requests/route.ts", "Medium", "E2E"]
        ],
        "Admin Review": [
            ["Admin sees pending requests", "View change requests list", "All pending shown", "src/app/api/admin/change-requests/route.ts", "High", "E2E"],
            ["Approve change request", "Approve with notes", "Changes applied to profile", "src/app/api/admin/change-requests/[id]/route.ts", "High", "E2E"],
            ["Reject change request", "Reject with reason", "Request marked rejected", "src/app/api/admin/change-requests/[id]/route.ts", "High", "E2E"],
            ["Requester notified of decision", "Approve or reject", "Employee gets notification", "src/app/api/admin/change-requests/[id]/route.ts", "Medium", "Automated"]
        ]
    },
    "41. WhatsApp Verification": {
        "Number Verification": [
            ["Send verification code", "Enter WhatsApp number", "Code sent via WhatsApp", "src/app/api/users/me/whatsapp-verification/route.ts", "High", "Manual"],
            ["Verify with correct code", "Enter received code", "Number verified", "src/app/api/users/me/whatsapp-verification/route.ts", "High", "Manual"],
            ["Wrong code rejected", "Enter incorrect code", "Verification failed", "src/app/api/users/me/whatsapp-verification/route.ts", "High", "Automated"],
            ["Code expires after time limit", "Use old code", "Code expired error", "src/app/api/users/me/whatsapp-verification/route.ts", "High", "Automated"],
            ["Resend code cooldown", "Request new code immediately", "Must wait before resend", "src/app/api/users/me/whatsapp-verification/route.ts", "Medium", "Automated"]
        ],
        "Verified Number Usage": [
            ["Approval notifications sent", "Receive approval to verify", "WhatsApp message received", "src/lib/whatsapp/notifications.ts", "High", "Manual"],
            ["Only verified numbers receive messages", "Unverified number in system", "No message sent", "src/lib/whatsapp/notifications.ts", "High", "Automated"]
        ]
    },
    "42. Session & Cookie Management": {
        "Session Lifecycle": [
            ["Session created on login", "Login successfully", "Session cookie set", "src/lib/core/auth.ts", "Critical", "Automated"],
            ["Session includes tenant context", "Check session data", "tenantId, role present", "src/lib/core/auth.ts", "Critical", "Automated"],
            ["Session expires after timeout", "Leave idle beyond timeout", "Session invalidated", "src/lib/core/auth.ts", "High", "Manual"],
            ["Session extended on activity", "Continue using app", "Session timeout reset", "src/lib/core/auth.ts", "High", "Manual"],
            ["Session cleared on logout", "Click logout", "Cookie cleared, session removed", "src/lib/core/auth.ts", "Critical", "Automated"]
        ],
        "Cookie Security": [
            ["Session cookie is HttpOnly", "Inspect cookie", "HttpOnly flag set", "src/lib/core/auth.ts", "Critical", "Automated"],
            ["Session cookie is Secure (prod)", "Check cookie in production", "Secure flag set", "src/lib/core/auth.ts", "Critical", "Automated"],
            ["Cookie has SameSite attribute", "Inspect cookie", "SameSite=Strict or Lax", "src/lib/core/auth.ts", "High", "Automated"],
            ["Cookie scoped to domain", "Check cookie domain", "Matches app domain", "src/lib/core/auth.ts", "High", "Automated"]
        ]
    },
    "43. Leave Calendar": {
        "Calendar View": [
            ["View calendar", "Navigate to /admin/leave/calendar", "Shows calendar", "src/app", "Medium", "Manual"],
            ["Monthly view", "Select month view", "Shows month", "src/app", "Medium", "Manual"],
            ["Weekly view", "Select week view", "Shows week", "src/app", "Medium", "Manual"],
            ["Today highlight", "Check current date", "Today highlighted", "src/app", "Medium", "Manual"],
            ["Leave entries", "View with leave requests", "Shows leave on calendar", "src/app", "Medium", "Manual"],
            ["Click leave entry", "Click on leave", "Shows details", "src/app", "Medium", "Manual"],
            ["Holiday display", "View with holidays", "Holidays shown", "src/app", "Medium", "Manual"]
        ],
        "Calendar Filtering": [
            ["Filter by employee", "Select employee", "Shows employee leave", "src/app", "Medium", "Manual"]
        ],
        "Calendar Navigation": [
            ["Next month", "Click next", "Shows next month", "src/app", "Medium", "Manual"],
            ["Previous month", "Click prev", "Shows previous month", "src/app", "Medium", "Manual"],
            ["Jump to date", "Select specific date", "Navigates to date", "src/app", "Medium", "Manual"],
            ["Today button", "Click today", "Returns to today", "src/app", "Medium", "Manual"]
        ]
    },
    "44. Roles & Permissions": {
        "Organization Roles": [
            ["OWNER permissions", "Login as owner", "Full access to all features", "src/app", "Medium", "Manual"],
            ["OWNER transfer", "Transfer ownership", "New owner gets full access", "src/app", "Medium", "Manual"],
            ["OWNER cannot be deleted", "Try delete owner", "Error 'cannot delete owner'", "src/app", "Medium", "Manual"],
            ["ADMIN permissions", "Login as admin", "Access all except billing/ownership", "src/app", "Medium", "Manual"],
            ["ADMIN create users", "Admin creates user", "User created successfully", "src/app", "Medium", "Manual"],
            ["ADMIN cannot transfer ownership", "Try transfer as admin", "Permission denied", "src/app", "Medium", "Manual"],
            ["MANAGER permissions", "Login as manager", "Limited admin access", "src/app", "Medium", "Manual"],
            ["MANAGER view team", "Manager views reports", "Only sees team data", "src/app", "Medium", "Manual"],
            ["MANAGER approve team", "Manager approves team request", "Approval works", "src/app", "Medium", "Manual"],
            ["MANAGER cannot approve other team", "Approve non-team request", "Permission denied", "src/app", "Medium", "Manual"],
            ["MEMBER permissions", "Login as member", "Employee-level access only", "src/app", "Medium", "Manual"],
            ["MEMBER self-service", "Member submits request", "Can submit own requests", "src/app", "Medium", "Manual"],
            ["MEMBER cannot approve", "Member tries to approve", "Permission denied", "src/app", "Medium", "Manual"]
        ],
        "Functional Access": [
            ["HR access granted", "Enable HR access", "Can view HR module", "src/app", "Medium", "Manual"],
            ["HR access revoked", "Disable HR access", "HR module hidden", "src/app", "Medium", "Manual"],
            ["HR view employees", "HR user views employees", "Full employee list", "src/app", "Medium", "Manual"],
            ["Non-HR view employees", "Non-HR tries employees", "Access denied", "src/app", "Medium", "Manual"],
            ["Finance access granted", "Enable Finance access", "Can view payroll", "src/app", "Medium", "Manual"],
            ["Finance access revoked", "Disable Finance access", "Payroll hidden", "src/app", "Medium", "Manual"],
            ["Finance run payroll", "Finance user runs payroll", "Payroll processed", "src/app", "Medium", "Manual"],
            ["Non-Finance payroll", "Non-Finance tries payroll", "Access denied", "src/app", "Medium", "Manual"],
            ["Combined access", "HR + Finance enabled", "Both modules accessible", "src/app", "Medium", "Manual"]
        ],
        "Role Changes": [
            ["Upgrade MEMBER to ADMIN", "Change role", "Immediate access update", "src/app", "Medium", "Manual"],
            ["Downgrade ADMIN to MEMBER", "Change role", "Immediate access restriction", "src/app", "Medium", "Manual"],
            ["Role change notification", "Change someone's role", "User notified", "src/app", "Medium", "Manual"],
            ["Role change audit", "Change role", "Change logged in audit", "src/app", "Medium", "Manual"],
            ["Self role change", "User changes own role", "Prevented (except owner)", "src/app", "Medium", "Manual"]
        ],
        "Permission Inheritance": [
            ["OWNER inherits all", "Check owner permissions", "Has all permissions", "src/app", "Medium", "Manual"],
            ["ADMIN inherits MANAGER", "Check admin permissions", "Has manager permissions", "src/app", "Medium", "Manual"],
            ["MANAGER inherits MEMBER", "Check manager permissions", "Has member permissions", "src/app", "Medium", "Manual"],
            ["Custom permissions", "Set specific permissions", "Override inheritance", "src/app", "Medium", "Manual"]
        ]
    },
    "45. Multi-Tenancy Security": {
        "Tenant Isolation": [
            ["IDOR - Asset", "Access asset ID from other tenant", "404 Not Found", "src/app", "Medium", "Manual"],
            ["IDOR - Leave request", "Access request from other tenant", "404 Not Found", "src/app", "Medium", "Manual"],
            ["IDOR - Employee", "Access employee from other tenant", "404 Not Found", "src/app", "Medium", "Manual"],
            ["IDOR - Approval step", "Access step from other tenant", "404 Not Found", "src/app", "Medium", "Manual"],
            ["Cross-tenant list", "List assets (no filter bypass)", "Only own tenant data", "src/app", "Medium", "Manual"],
            ["Subdomain mismatch", "Access org-a with org-b account", "Redirected or blocked", "src/app", "Medium", "Manual"],
            ["API parameter tampering", "Change tenantId in API body", "Ignored, uses session tenant", "src/app", "Medium", "Manual"],
            ["Cross-tenant notification", "Trigger notif, check other tenant", "Not visible in other tenant", "src/app", "Medium", "Manual"],
            ["Subdomain access wrong org", "Authenticated to org-a, access org-b.domain", "Redirect or re-auth required", "src/app", "Medium", "Manual"],
            ["Direct API with wrong tenant header", "Forge x-tenant-id header", "Ignored, uses session", "src/app", "Medium", "Manual"]
        ],
        "Data Leakage": [
            ["Error messages", "Trigger errors", "No sensitive data exposed", "src/app", "Medium", "Manual"],
            ["API responses", "Check all responses", "No other tenant data", "src/app", "Medium", "Manual"],
            ["Notifications", "Check notification content", "No cross-tenant info", "src/app", "Medium", "Manual"]
        ],
        "Organization Lifecycle": [
            ["Org disabled by super admin", "Super admin disables org", "All users see 'Organization suspended'", "src/app", "Medium", "Manual"],
            ["Org deleted with active users", "Delete org with 50 users", "All users logged out, data archived", "src/app", "Medium", "Manual"],
            ["Org slug change", "Change org slug", "Old subdomain redirects or 404", "src/app", "Medium", "Manual"],
            ["Org trial expiry", "Free trial ends", "Downgrade or block based on policy", "src/app", "Medium", "Manual"],
            ["Org plan downgrade", "Pro to Free, exceeds limits", "Warning about data loss or blocks", "src/app", "Medium", "Manual"]
        ],
        "Impersonation": [
            ["Impersonation token expired", "Use old impersonation token", "Error 'Token expired'", "src/app", "Medium", "Manual"],
            ["Impersonation of disabled org", "Impersonate disabled organization", "Error or shows disabled state", "src/app", "Medium", "Manual"],
            ["Impersonation with org-specific perms", "Super admin impersonates", "Has admin rights in that org", "src/app", "Medium", "Manual"],
            ["Exit impersonation clears context", "Exit impersonation", "Returns to super admin context clean", "src/app", "Medium", "Manual"]
        ]
    },
    "46. Validation Edge Cases": {
        "String Fields": [
            ["Max length", "Asset model 256 chars", "Error (max 255)", "src/app", "Medium", "Manual"],
            ["Unicode", "Employee name in Japanese", "Should work", "src/app", "Medium", "Manual"],
            ["Emojis", "Notes field with emojis", "Should work", "src/app", "Medium", "Manual"],
            ["HTML tags", "Description with script tag", "Escaped/stripped", "src/app", "Medium", "Manual"],
            ["SQL injection", "Any text field", "Sanitized", "src/app", "Medium", "Manual"],
            ["Null bytes", "Any field with null byte", "Handled safely", "src/app", "Medium", "Manual"]
        ],
        "Numeric Fields": [
            ["Max int", "Price 999999999999", "Validation error", "src/app", "Medium", "Manual"],
            ["Negative", "Leave days -5", "Validation error", "src/app", "Medium", "Manual"],
            ["Decimal", "QID 12345.5", "Error (integer only)", "src/app", "Medium", "Manual"],
            ["Scientific", "Amount 1e10", "Handled correctly", "src/app", "Medium", "Manual"],
            ["NaN", "Any number field", "Validation error", "src/app", "Medium", "Manual"],
            ["Infinity", "Any number field", "Validation error", "src/app", "Medium", "Manual"]
        ],
        "Date Fields": [
            ["Invalid format", "Start date 'not-a-date'", "Validation error", "src/app", "Medium", "Manual"],
            ["Far future", "End date Year 3000", "Should work (or limit)", "src/app", "Medium", "Manual"],
            ["Far past", "DOB Year 1800", "Validation error", "src/app", "Medium", "Manual"],
            ["Timezone", "All dates in different TZ", "Qatar TZ applied", "src/app", "Medium", "Manual"],
            ["Leap year", "Feb 29, 2024", "Should work", "src/app", "Medium", "Manual"],
            ["Invalid Feb 29", "Feb 29, 2023", "Validation error", "src/app", "Medium", "Manual"]
        ],
        "Email Fields": [
            ["Standard", "user@domain.com", "Valid", "src/app", "Medium", "Manual"],
            ["Subdomain", "user@sub.domain.com", "Valid", "src/app", "Medium", "Manual"],
            ["Plus addressing", "user+tag@domain.com", "Valid", "src/app", "Medium", "Manual"],
            ["No TLD", "user@domain", "Invalid", "src/app", "Medium", "Manual"],
            ["Double @", "user@@domain.com", "Invalid", "src/app", "Medium", "Manual"],
            ["Leading dot", ".user@domain.com", "Invalid", "src/app", "Medium", "Manual"]
        ],
        "API Request Validation": [
            ["Extra fields in request", "Send unknown fields in body", "Ignored (stripped)", "src/app", "Medium", "Manual"],
            ["Missing optional fields", "Omit all optional fields", "Defaults applied", "src/app", "Medium", "Manual"],
            ["Wrong data types", "Send string for number field", "Validation error with clear message", "src/app", "Medium", "Manual"],
            ["Array instead of object", "Send [] where {} expected", "Validation error", "src/app", "Medium", "Manual"],
            ["Deeply nested invalid data", "Invalid field 5 levels deep", "Validation catches and reports", "src/app", "Medium", "Manual"]
        ],
        "API Response Edge Cases": [
            ["Large response payload", "List 10,000 items", "Paginated or limited", "src/app", "Medium", "Manual"],
            ["Empty list response", "Query with no results", "Returns [], not error", "src/app", "Medium", "Manual"],
            ["Null vs undefined", "Check null handling in responses", "Consistent null representation", "src/app", "Medium", "Manual"],
            ["Decimal precision", "Price 123.456789", "Appropriate precision maintained", "src/app", "Medium", "Manual"],
            ["Date timezone handling", "Create in UTC, view in local", "Correct timezone conversion", "src/app", "Medium", "Manual"]
        ]
    },
    "47. Race Condition Tests": {
        "Concurrent Operations": [
            ["Double approval", "Two users approve same step", "Only one succeeds", "src/app", "Medium", "Manual"],
            ["Simultaneous leave", "Two requests for same dates", "One gets overlap error", "src/app", "Medium", "Manual"],
            ["Asset tag collision", "Create many assets rapidly", "All get unique tags", "src/app", "Medium", "Manual"],
            ["Balance update race", "Two requests draining balance", "Second shows insufficient", "src/app", "Medium", "Manual"],
            ["Subscription cancellation", "Cancel while processing", "Transaction integrity", "src/app", "Medium", "Manual"]
        ]
    },
    "48. Notification System": {
        "In-App Notifications": [
            ["Leave submitted", "Submit request", "Approvers get notification", "src/app", "Medium", "Manual"],
            ["Leave approved", "Approve request", "Requester gets notification", "src/app", "Medium", "Manual"],
            ["Asset assigned", "Assign asset", "Employee gets notification", "src/app", "Medium", "Manual"],
            ["Unread count", "Multiple notifications", "Count shows correctly", "src/app", "Medium", "Manual"],
            ["Mark as read", "Click notification", "isRead = true", "src/app", "Medium", "Manual"],
            ["Notification bell", "Check bell icon", "Shows unread count badge", "src/app", "Medium", "Manual"],
            ["Notification dropdown", "Click bell", "Shows notification list", "src/app", "Medium", "Manual"],
            ["Empty notifications", "No notifications", "Shows empty state", "src/app", "Medium", "Manual"],
            ["Notification link", "Click notification", "Navigates to related item", "src/app", "Medium", "Manual"],
            ["Delete notification", "Delete single", "Notification removed", "src/app", "Medium", "Manual"],
            ["Notification timestamp", "Check time", "Shows relative time", "src/app", "Medium", "Manual"]
        ],
        "Email Notifications": [
            ["Leave request email", "Submit leave", "Email sent to approvers", "src/app", "Medium", "Manual"],
            ["Approval email", "Approve leave", "Email sent to requester", "src/app", "Medium", "Manual"],
            ["Email failure", "Invalid email", "Logged, admin notified", "src/app", "Medium", "Manual"],
            ["Email formatting", "View email", "HTML renders correctly", "src/app", "Medium", "Manual"]
        ],
        "WhatsApp Notifications": [
            ["Approval action link", "Receive WhatsApp", "Can approve via link", "src/app", "Medium", "Manual"],
            ["Token invalidation", "Approve in app", "WhatsApp link disabled", "src/app", "Medium", "Manual"],
            ["Expired token", "Click old link", "Error 'token expired'", "src/app", "Medium", "Manual"]
        ]
    },
    "49. Reports": {
        "Report Dashboard": [
            ["View reports page", "Navigate to /admin/reports", "Shows report dashboard", "src/app", "Medium", "Manual"],
            ["Employee report", "Select employee report", "Shows employee data", "src/app", "Medium", "Manual"],
            ["Date range filter", "Select custom date range", "Report filters by dates", "src/app", "Medium", "Manual"],
            ["Export to CSV", "Click export CSV", "Downloads CSV file", "src/app", "Medium", "Manual"],
            ["Export to PDF", "Click export PDF", "Downloads PDF file", "src/app", "Medium", "Manual"]
        ],
        "Report Permissions": [
            ["Admin access", "Admin views reports", "Full access", "src/app", "Medium", "Manual"],
            ["Employee access", "Employee tries /admin/reports", "Access denied", "src/app", "Medium", "Manual"],
            ["HR reports", "Non-HR views HR reports", "Limited or denied", "src/app", "Medium", "Manual"],
            ["Finance reports", "Non-Finance views payroll reports", "Limited or denied", "src/app", "Medium", "Manual"]
        ]
    },
    "50. Activity & Audit Logs": {
        "Activity Log Viewing": [
            ["View activity page", "Navigate to /admin/activity", "Shows activity log", "src/app", "Medium", "Manual"],
            ["Log entries display", "Check log list", "Shows user, action, timestamp", "src/app", "Medium", "Manual"],
            ["Filter by entity", "Select entity type", "Shows related actions", "src/app", "Medium", "Manual"],
            ["Pagination", "Navigate pages", "Pages load correctly", "src/app", "Medium", "Manual"],
            ["Search logs", "Search by keyword", "Finds matching entries", "src/app", "Medium", "Manual"]
        ],
        "Audit Trail Completeness": [
            ["Login logged", "User logs in", "Login action recorded", "src/app", "Medium", "Manual"],
            ["Create logged", "Create any entity", "Create action recorded", "src/app", "Medium", "Manual"],
            ["Update logged", "Update any entity", "Update action recorded", "src/app", "Medium", "Manual"],
            ["Delete logged", "Delete any entity", "Delete action recorded", "src/app", "Medium", "Manual"],
            ["Approval logged", "Approve request", "Approval action recorded", "src/app", "Medium", "Manual"],
            ["Rejection logged", "Reject request", "Rejection action recorded", "src/app", "Medium", "Manual"],
            ["Settings change logged", "Change org settings", "Settings change recorded", "src/app", "Medium", "Manual"]
        ]
    },
    "51. Organization Settings": {
        "General Settings": [
            ["View settings", "Navigate to /admin/settings", "Shows settings page", "src/app", "Medium", "Manual"],
            ["Update currency", "Change currency", "Currency updated", "src/app", "Medium", "Manual"],
            ["Update logo", "Upload new logo", "Logo updated", "src/app", "Medium", "Manual"],
            ["Remove logo", "Delete logo", "Logo removed", "src/app", "Medium", "Manual"],
            ["Invalid logo format", "Upload non-image", "Error shown", "src/app", "Medium", "Manual"]
        ],
        "Approval Policy Settings": [
            ["View approval policies", "Navigate to approvals settings", "Shows policies list", "src/app", "Medium", "Manual"],
            ["Policy threshold", "Set amount threshold", "Applied to requests", "src/app", "Medium", "Manual"],
            ["Multi-level policy", "Create 3-level approval", "Chain works correctly", "src/app", "Medium", "Manual"]
        ],
        "Access Control Settings": [
            ["View access control", "Navigate to access settings", "Shows access page", "src/app", "Medium", "Manual"],
            ["Grant HR access", "Enable HR for user", "User can access HR", "src/app", "Medium", "Manual"],
            ["Revoke HR access", "Disable HR for user", "User loses HR access", "src/app", "Medium", "Manual"],
            ["Grant Finance access", "Enable Finance for user", "User can access Finance", "src/app", "Medium", "Manual"],
            ["Admin role assignment", "Make user admin", "User has admin rights", "src/app", "Medium", "Manual"]
        ],
        "WhatsApp Settings": [
            ["View WhatsApp settings", "Navigate to WhatsApp settings", "Shows config page", "src/app", "Medium", "Manual"],
            ["Enable WhatsApp", "Toggle WhatsApp on", "WhatsApp enabled", "src/app", "Medium", "Manual"],
            ["Disable WhatsApp", "Toggle WhatsApp off", "WhatsApp disabled", "src/app", "Medium", "Manual"],
            ["Configure API key", "Enter API credentials", "Credentials saved", "src/app", "Medium", "Manual"],
            ["Test connection", "Click test button", "Connection verified", "src/app", "Medium", "Manual"],
            ["Invalid credentials", "Enter wrong credentials", "Error shown", "src/app", "Medium", "Manual"]
        ],
        "AI Usage Settings": [
            ["View AI usage", "Navigate to AI settings", "Shows usage stats", "src/app", "Medium", "Manual"],
            ["Enable AI features", "Toggle AI on", "AI features available", "src/app", "Medium", "Manual"],
            ["Disable AI features", "Toggle AI off", "AI features hidden", "src/app", "Medium", "Manual"],
            ["Usage limits display", "Check usage stats", "Shows current usage", "src/app", "Medium", "Manual"]
        ]
    },
    "52. My Approvals Dashboard": {
        "Pending Approvals": [
            ["View my approvals", "Navigate to /admin/my-approvals", "Shows pending items", "src/app", "Medium", "Manual"],
            ["Leave requests shown", "Have pending leave", "Leave requests listed", "src/app", "Medium", "Manual"],
            ["Asset requests shown", "Have pending asset req", "Asset requests listed", "src/app", "Medium", "Manual"],
            ["Purchase requests shown", "Have pending PR", "Purchase requests listed", "src/app", "Medium", "Manual"],
            ["Filter by type", "Filter by request type", "Shows filtered list", "src/app", "Medium", "Manual"],
            ["Sort by date", "Sort by submission date", "Sorted correctly", "src/app", "Medium", "Manual"],
            ["Empty state", "No pending approvals", "Shows empty message", "src/app", "Medium", "Manual"]
        ],
        "Quick Actions": [
            ["Approve from list", "Click approve button", "Request approved", "src/app", "Medium", "Manual"],
            ["Reject from list", "Click reject, enter reason", "Request rejected", "src/app", "Medium", "Manual"],
            ["View details", "Click request", "Opens detail page", "src/app", "Medium", "Manual"],
            ["Bulk approve", "Select multiple, approve", "All approved", "src/app", "Medium", "Manual"],
            ["Notification badge", "Have pending items", "Badge shows count", "src/app", "Medium", "Manual"]
        ]
    },
    "53. Employee Portal": {
        "Employee Dashboard": [
            ["View dashboard", "Login as employee", "Shows employee dashboard", "src/app", "Medium", "Manual"],
            ["Quick stats", "Check dashboard cards", "Shows leave balance, assets", "src/app", "Medium", "Manual"],
            ["Recent activity", "Check recent section", "Shows recent requests", "src/app", "Medium", "Manual"],
            ["Pending requests", "Check pending section", "Shows pending items", "src/app", "Medium", "Manual"]
        ],
        "My Leave": [
            ["View my leave", "Navigate to /employee/leave", "Shows leave page", "src/app", "Medium", "Manual"],
            ["Leave balances", "Check balances", "Shows all leave types", "src/app", "Medium", "Manual"],
            ["Submit leave request", "Fill form, submit", "Request created", "src/app", "Medium", "Manual"],
            ["View my requests", "Check requests list", "Shows own requests only", "src/app", "Medium", "Manual"],
            ["Cancel pending request", "Cancel own request", "Request cancelled", "src/app", "Medium", "Manual"],
            ["Cannot cancel approved", "Try cancel approved", "Error shown", "src/app", "Medium", "Manual"]
        ],
        "My Assets": [
            ["View my assets", "Navigate to /employee/my-assets", "Shows assigned assets", "src/app", "Medium", "Manual"],
            ["Asset details", "Click asset", "Shows asset details", "src/app", "Medium", "Manual"],
            ["Request new asset", "Submit asset request", "Request created", "src/app", "Medium", "Manual"],
            ["Request return", "Submit return request", "Return request created", "src/app", "Medium", "Manual"],
            ["Accept assignment", "Accept offered asset", "Asset assigned", "src/app", "Medium", "Manual"],
            ["Decline assignment", "Decline offered asset", "Assignment declined", "src/app", "Medium", "Manual"]
        ],
        "My Payslips": [
            ["View payslips", "Navigate to /employee/payroll/payslips", "Shows payslips list", "src/app", "Medium", "Manual"],
            ["View payslip detail", "Click payslip", "Shows payslip details", "src/app", "Medium", "Manual"],
            ["Download payslip", "Click download", "PDF downloaded", "src/app", "Medium", "Manual"],
            ["Filter by year", "Select year", "Shows filtered payslips", "src/app", "Medium", "Manual"],
            ["Only own payslips", "Check list", "Only sees own payslips", "src/app", "Medium", "Manual"]
        ],
        "My Gratuity": [
            ["View gratuity", "Navigate to /employee/payroll/gratuity", "Shows gratuity calculator", "src/app", "Medium", "Manual"],
            ["Gratuity calculation", "Check calculation", "Shows estimated gratuity", "src/app", "Medium", "Manual"],
            ["Service years shown", "Check service period", "Shows correct years", "src/app", "Medium", "Manual"],
            ["Salary basis shown", "Check salary", "Shows correct salary", "src/app", "Medium", "Manual"]
        ],
        "Employee Spend Requests": [
            ["View my PRs", "Navigate to /employee/purchase-requests", "Shows own requests", "src/app", "Medium", "Manual"],
            ["Create PR", "Fill form, submit", "PR created", "src/app", "Medium", "Manual"],
            ["View PR detail", "Click PR", "Shows PR details", "src/app", "Medium", "Manual"],
            ["Track PR status", "Check status", "Shows current status", "src/app", "Medium", "Manual"]
        ]
    },
    "54. File Upload & Storage": {
        "Upload Tests": [
            ["Upload exactly at size limit", "Upload 10MB file (if limit is 10MB)", "Succeeds", "src/app", "Medium", "Manual"],
            ["Upload 1 byte over limit", "Upload 10MB + 1 byte", "Error 'File too large'", "src/app", "Medium", "Manual"],
            ["Upload zero-byte file", "Upload empty file", "Error 'Empty file'", "src/app", "Medium", "Manual"],
            ["Upload file with no extension", "Upload file without extension", "Validated by content type", "src/app", "Medium", "Manual"],
            ["Upload disguised executable", "Rename .exe to .pdf", "Blocked by content validation", "src/app", "Medium", "Manual"],
            ["Upload with special chars in name", "File name: test(1)[2]{3}.pdf", "Sanitized or allowed", "src/app", "Medium", "Manual"],
            ["Concurrent upload same file", "Upload same file twice simultaneously", "Both succeed with unique names", "src/app", "Medium", "Manual"],
            ["Upload during network interruption", "Connection drops mid-upload", "Graceful error, cleanup partial", "src/app", "Medium", "Manual"]
        ],
        "Storage Security": [
            ["Path traversal attempt", "Filename: ../../../etc/passwd", "Blocked, sanitized", "src/app", "Medium", "Manual"],
            ["Null byte injection", "Filename: file%00.exe.pdf", "Blocked", "src/app", "Medium", "Manual"],
            ["Signed URL expiry", "Use URL after expiry", "Access denied", "src/app", "Medium", "Manual"],
            ["Direct bucket access", "Try to access storage directly", "Blocked, requires signed URL", "src/app", "Medium", "Manual"],
            ["File deleted, URL cached", "Delete file, use cached URL", "404 or access denied", "src/app", "Medium", "Manual"]
        ]
    },
    "55. WhatsApp Integration": {
        "WhatsApp Notifications": [
            ["Leave approval notification", "Leave submitted", "Approver gets WhatsApp", "src/app", "Medium", "Manual"],
            ["Asset request notification", "Asset requested", "Admin gets WhatsApp", "src/app", "Medium", "Manual"],
            ["PR notification", "PR submitted", "Approver gets WhatsApp", "src/app", "Medium", "Manual"],
            ["Notification disabled", "WhatsApp off", "No WhatsApp sent", "src/app", "Medium", "Manual"],
            ["No phone number", "Approver has no phone", "Falls back to email/in-app", "src/app", "Medium", "Manual"]
        ],
        "WhatsApp Action Tokens": [
            ["Approve via WhatsApp", "Click approve link", "Request approved", "src/app", "Medium", "Manual"],
            ["Reject via WhatsApp", "Click reject link", "Request rejected", "src/app", "Medium", "Manual"],
            ["Token expiry", "Use expired token", "Error shown", "src/app", "Medium", "Manual"],
            ["One-time use", "Use token twice", "Second use fails", "src/app", "Medium", "Manual"],
            ["Invalid token", "Use fake token", "Access denied", "src/app", "Medium", "Manual"]
        ]
    },
    "56. Public Holidays": {
        "Holiday Management": [
            ["View holidays", "Navigate to holidays", "Shows holiday list", "src/app", "Medium", "Manual"],
            ["Create holiday", "Add new holiday", "Holiday created", "src/app", "Medium", "Manual"],
            ["Multi-day holiday", "Set start and end date", "Holiday spans days", "src/app", "Medium", "Manual"],
            ["Edit holiday", "Modify holiday", "Changes saved", "src/app", "Medium", "Manual"],
            ["Delete holiday", "Remove holiday", "Holiday deleted", "src/app", "Medium", "Manual"],
            ["Recurring holiday", "Mark as recurring", "Shows yearly", "src/app", "Medium", "Manual"]
        ],
        "Holiday Impact on Leave": [
            ["Leave excludes holiday", "Request over holiday", "Holiday not counted", "src/app", "Medium", "Manual"],
            ["Holiday in date range", "Select range with holiday", "Shows adjusted days", "src/app", "Medium", "Manual"],
            ["Multiple holidays", "Range with 2 holidays", "Both excluded", "src/app", "Medium", "Manual"],
            ["Holiday calendar view", "View calendar", "Holidays highlighted", "src/app", "Medium", "Manual"]
        ]
    },
    "57. Gratuity Calculator": {
        "Gratuity Calculation": [
            ["View gratuity page", "Navigate to gratuity", "Shows calculator", "src/app", "Medium", "Manual"],
            ["Calculate gratuity", "Enter service details", "Shows calculation", "src/app", "Medium", "Manual"],
            ["Under 1 year", "Less than 1 year service", "No gratuity due", "src/app", "Medium", "Manual"],
            ["1-5 years", "1-5 years service", "21 days per year", "src/app", "Medium", "Manual"],
            ["Over 5 years", "More than 5 years", "30 days per year (after 5)", "src/app", "Medium", "Manual"],
            ["Pro-rata calculation", "Partial year", "Pro-rated correctly", "src/app", "Medium", "Manual"],
            ["Salary basis", "Check calculation basis", "Uses basic salary", "src/app", "Medium", "Manual"]
        ],
        "Gratuity Reports": [
            ["Employee gratuity list", "View all employees", "Shows gratuity for each", "src/app", "Medium", "Manual"],
            ["Total liability", "Check total", "Shows org total liability", "src/app", "Medium", "Manual"]
        ]
    },
    "58. Loans (Extended)": {
        "Loan Management": [
            ["View loans", "Navigate to loans", "Shows loan list", "src/app", "Medium", "Manual"],
            ["Loan amount required", "Leave amount empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Loan term required", "Leave term empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Negative amount", "Enter negative amount", "Validation error", "src/app", "Medium", "Manual"],
            ["View loan details", "Click loan", "Shows loan details", "src/app", "Medium", "Manual"],
            ["Edit loan", "Modify loan", "Changes saved", "src/app", "Medium", "Manual"]
        ],
        "Loan Repayment": [
            ["Monthly deduction", "Process payroll", "Loan deducted", "src/app", "Medium", "Manual"],
            ["Deduction amount", "Check deduction", "Matches monthly amount", "src/app", "Medium", "Manual"],
            ["Balance update", "After deduction", "Balance decreases", "src/app", "Medium", "Manual"],
            ["Loan completion", "Final payment", "Loan marked complete", "src/app", "Medium", "Manual"]
        ],
        "Loan in Payslip": [
            ["Loan shown in payslip", "View payslip", "Shows loan deduction", "src/app", "Medium", "Manual"],
            ["Multiple loans", "Employee has 2 loans", "Both shown", "src/app", "Medium", "Manual"],
            ["No active loan", "No loan", "No deduction shown", "src/app", "Medium", "Manual"]
        ]
    },
    "59. Document Expiry Alerts": {
        "Employee Document Expiry": [
            ["QID expiry alert", "QID expiring soon", "Alert shown", "src/app", "Medium", "Manual"],
            ["Passport expiry alert", "Passport expiring", "Alert shown", "src/app", "Medium", "Manual"],
            ["Health card expiry", "Health card expiring", "Alert shown", "src/app", "Medium", "Manual"],
            ["License expiry", "Driving license expiring", "Alert shown", "src/app", "Medium", "Manual"],
            ["Multiple expiring", "Several docs expiring", "All shown", "src/app", "Medium", "Manual"]
        ],
        "Expiry Dashboard": [
            ["View expiry dashboard", "Navigate to document expiry", "Shows expiring docs", "src/app", "Medium", "Manual"],
            ["Filter by days", "Filter by 30/60/90 days", "Shows filtered list", "src/app", "Medium", "Manual"],
            ["Sort by expiry", "Sort by date", "Sorted correctly", "src/app", "Medium", "Manual"],
            ["Export expiry list", "Export to CSV", "List downloaded", "src/app", "Medium", "Manual"]
        ],
        "Expiry Notifications": [
            ["30-day notification", "Doc expires in 30 days", "Notification sent", "src/app", "Medium", "Manual"],
            ["7-day notification", "Doc expires in 7 days", "Urgent notification", "src/app", "Medium", "Manual"],
            ["Admin notified", "Employee doc expiring", "Admin gets alert", "src/app", "Medium", "Manual"],
            ["Employee notified", "Own doc expiring", "Employee gets alert", "src/app", "Medium", "Manual"],
            ["Cron job runs", "Scheduled check", "Expiry check runs", "src/app", "Medium", "Manual"]
        ]
    },
    "60. User Profile": {
        "Profile Page": [
            ["View profile", "Navigate to /profile", "Shows profile page", "src/app", "Medium", "Manual"],
            ["View account info", "Check account tab", "Shows email, role, dates", "src/app", "Medium", "Manual"],
            ["View HR profile", "Check HR tab", "Shows HR details", "src/app", "Medium", "Manual"],
            ["Edit name", "Change display name", "Name updated", "src/app", "Medium", "Manual"],
            ["Name validation", "Enter empty name", "Validation error", "src/app", "Medium", "Manual"],
            ["View assigned assets", "Check assets section", "Shows assigned assets", "src/app", "Medium", "Manual"],
            ["View subscriptions", "Check subscriptions", "Shows managed subscriptions", "src/app", "Medium", "Manual"]
        ],
        "Password Change": [
            ["Change password", "Enter old + new password", "Password changed", "src/app", "Medium", "Manual"],
            ["Wrong old password", "Enter incorrect old password", "Error shown", "src/app", "Medium", "Manual"],
            ["Password too short", "Enter <8 char password", "Validation error", "src/app", "Medium", "Manual"],
            ["Password mismatch", "Confirm doesn't match", "Validation error", "src/app", "Medium", "Manual"],
            ["Password complexity", "Enter weak password", "Validation error", "src/app", "Medium", "Manual"]
        ],
        "HR Profile Management": [
            ["Edit HR profile", "Update HR fields", "Changes saved", "src/app", "Medium", "Manual"],
            ["Missing fields", "View incomplete profile", "Highlights missing", "src/app", "Medium", "Manual"],
            ["Document expiry alerts", "View expiry widget", "Shows expiring docs", "src/app", "Medium", "Manual"]
        ]
    },
    "61. Password Reset Flow": {
        "Forgot Password": [
            ["Request reset", "Enter email, submit", "Email sent message", "src/app", "Medium", "Manual"],
            ["Non-existent email", "Enter unknown email", "Same success message (security)", "src/app", "Medium", "Manual"],
            ["Rate limiting", "Request 5+ times quickly", "Rate limited", "src/app", "Medium", "Manual"],
            ["Email received", "Check inbox", "Reset email received", "src/app", "Medium", "Manual"],
            ["Reset link valid", "Click link", "Opens reset page", "src/app", "Medium", "Manual"]
        ],
        "Reset Password": [
            ["Valid token", "Access with valid token", "Shows reset form", "src/app", "Medium", "Manual"],
            ["Set new password", "Enter valid password", "Password reset", "src/app", "Medium", "Manual"],
            ["Password validation", "Enter weak password", "Validation error", "src/app", "Medium", "Manual"],
            ["Confirm mismatch", "Passwords don't match", "Validation error", "src/app", "Medium", "Manual"],
            ["Token single use", "Use token twice", "Second use fails", "src/app", "Medium", "Manual"],
            ["Login after reset", "Login with new password", "Login successful", "src/app", "Medium", "Manual"],
            ["Sessions invalidated after reset", "Reset password, check other logged-in sessions", "All sessions logged out", "src/app", "Medium", "Manual"]
        ]
    },
    "62. Team Invitations": {
        // "Creating Invitations": [
        //     ["Invite team member", "Enter email, send", "Invitation created", "src/app", "Medium", "Manual"],
        //     ["Duplicate invite", "Invite same email twice", "Error 'already invited'", "src/app", "Medium", "Manual"],
        //     ["Existing member", "Invite existing member", "Error 'already member'", "src/app", "Medium", "Manual"],
        //     ["Set role", "Select role for invitee", "Role saved", "src/app", "Medium", "Manual"],
        //     ["Bulk invite", "Invite multiple emails", "All invitations sent", "src/app", "Medium", "Manual"],
        //     ["View pending", "Check invitations list", "Shows pending invites", "src/app", "Medium", "Manual"]
        // ],
        "Managing Invitations": [
            ["Copy invite link", "Click copy", "Link copied to clipboard", "src/app", "Medium", "Manual"]
        ],
        "Accepting Invitations": [
            ["Valid invite link", "Click invite link", "Opens accept page", "src/app", "Medium", "Manual"],
            ["Expired invite", "Use expired link", "Error shown", "src/app", "Medium", "Manual"],
            ["Revoked invite", "Use revoked link", "Error shown", "src/app", "Medium", "Manual"],
            ["Accept - new user", "Accept, create account", "Account + membership created", "src/app", "Medium", "Manual"],
            ["Accept - existing user", "Accept while logged in", "Added to organization", "src/app", "Medium", "Manual"],
            ["Wrong user", "Different user clicks link", "Error or prompt", "src/app", "Medium", "Manual"],
            ["Role assigned", "Accept invitation", "Has invited role", "src/app", "Medium", "Manual"]
        ]
    },
    "64. Data Import & Export": {
        "Spend Request Export": [
            ["Export PRs", "Click export", "CSV/PDF downloaded", "src/app/api/purchase-requests/export/route.ts", "Medium", "Manual"],
            ["Export with filters", "Filter then export", "Filtered data exported", "src/app/api/purchase-requests/export/route.ts", "Medium", "Manual"]
        ],
        "Supplier Import/Export": [
            ["Import suppliers", "Upload CSV", "Suppliers imported", "src/app/api/suppliers/import/route.ts", "Medium", "Manual"],
            ["Export suppliers", "Click export", "CSV downloaded", "src/app/api/suppliers/export/route.ts", "Medium", "Manual"],
            ["Import invalid supplier data", "Upload bad CSV", "Errors shown", "src/app/api/suppliers/import/route.ts", "Medium", "Manual"]
        ]
    },
    "65. Employee Change Requests": {
        "Submitting Change Requests": [
            ["Request profile change", "Submit change request", "Request created", "src/app", "Medium", "Manual"],
            ["Request field change", "Request specific field", "Field noted in request", "src/app", "Medium", "Manual"],
            ["Attach document", "Upload supporting doc", "Document attached", "src/app", "Medium", "Manual"],
            ["Cancel request", "Cancel pending request", "Request cancelled", "src/app", "Medium", "Manual"]
        ],
        "Processing Change Requests": [
            ["View pending requests", "Navigate to change requests", "Shows all pending", "src/app", "Medium", "Manual"],
            ["Approve request", "Click approve", "Changes applied", "src/app", "Medium", "Manual"],
            ["Partial approval", "Approve some fields", "Only approved fields changed", "src/app", "Medium", "Manual"],
            ["Notification on decision", "Approve/reject", "Employee notified", "src/app", "Medium", "Manual"]
        ]
    },
    "66. Employee Celebrations": {
        "Celebrations Widget": [
            ["View celebrations", "Check dashboard widget", "Shows celebrations", "src/app", "Medium", "Manual"],
            ["Today's birthdays", "Employee birthday today", "Shown in widget", "src/app", "Medium", "Manual"],
            ["Upcoming birthdays", "Birthdays this week", "Listed in widget", "src/app", "Medium", "Manual"],
            ["Work anniversaries", "Anniversary today", "Shown in widget", "src/app", "Medium", "Manual"],
            ["Upcoming anniversaries", "Anniversaries this week", "Listed in widget", "src/app", "Medium", "Manual"],
            ["No celebrations", "No events this week", "Shows empty state", "src/app", "Medium", "Manual"],
            ["Click celebration", "Click on person", "Goes to profile", "src/app", "Medium", "Manual"]
        ]
    },
    "67. Feedback System": {
        "Submitting Feedback": [
            ["Submit feedback", "Fill form, submit", "Feedback sent", "src/app", "Medium", "Manual"],
            ["Feedback type", "Select feedback type", "Type recorded", "src/app", "Medium", "Manual"],
            ["Feedback message", "Enter message", "Message saved", "src/app", "Medium", "Manual"],
            ["Empty message", "Submit empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Screenshot attach", "Attach screenshot", "Image uploaded", "src/app", "Medium", "Manual"],
            ["Success message", "Submit valid feedback", "Thank you shown", "src/app", "Medium", "Manual"]
        ],
        "Managing Feedback": [
            ["View all feedback", "Navigate to feedback", "Shows all feedback", "src/app", "Medium", "Manual"],
            ["Mark as reviewed", "Mark feedback reviewed", "Status updated", "src/app", "Medium", "Manual"],
            ["Delete feedback", "Delete entry", "Feedback removed", "src/app", "Medium", "Manual"]
        ]
    },
    "68. Modules Management": {
        "Viewing Modules": [
            ["View modules page", "Navigate to /admin/modules", "Shows module list", "src/app", "Medium", "Manual"],
            ["Module categories", "Check categories", "Shows Operations, HR, System", "src/app", "Medium", "Manual"],
            ["Enabled modules", "Check status", "Shows enabled state", "src/app", "Medium", "Manual"],
            ["Module descriptions", "View descriptions", "Helpful descriptions shown", "src/app", "Medium", "Manual"]
        ],
        "Enabling/Disabling Modules": [
            ["Enable module", "Toggle module on", "Module enabled", "src/app", "Medium", "Manual"],
            ["Disable module", "Toggle module off", "Module disabled", "src/app", "Medium", "Manual"],
            ["Module with dependency", "Disable required module", "Error or warning", "src/app", "Medium", "Manual"],
            ["Module with data", "Disable module with data", "Warning shown", "src/app", "Medium", "Manual"],
            ["Routes blocked", "Disable then access route", "Access denied", "src/app", "Medium", "Manual"],
            ["Sidebar updated", "Enable/disable", "Menu updates", "src/app", "Medium", "Manual"],
            ["API blocked", "Disable then call API", "403 error", "src/app", "Medium", "Manual"]
        ]
    },
    "69. Soft Delete & Trash": {
        "Deleted Employees": [
            ["View deleted employees", "Navigate to deleted", "Shows deleted employees", "src/app", "Medium", "Manual"],
            ["Restore employee", "Click restore", "Employee restored", "src/app", "Medium", "Manual"],
            ["Restore with assets", "Restore employee", "Assets still assigned", "src/app", "Medium", "Manual"]
        ],
        "Deleted Users": [
            ["Soft delete user", "Delete user", "User soft deleted", "src/app", "Medium", "Manual"],
            ["User can't login", "Deleted user tries login", "Access denied", "src/app", "Medium", "Manual"],
            ["Restore user", "Restore deleted user", "User can login again", "src/app", "Medium", "Manual"],
            ["Cleanup cron", "After retention period", "Users purged", "src/app", "Medium", "Manual"]
        ]
    },
    "70. Locations Management": {
        "Location CRUD": [
            ["View locations", "Navigate to locations", "Shows location list", "src/app", "Medium", "Manual"],
            ["Location name required", "Leave name empty", "Validation error", "src/app", "Medium", "Manual"],
            ["Location address", "Enter address", "Address saved", "src/app", "Medium", "Manual"],
            ["Edit location", "Modify location", "Changes saved", "src/app", "Medium", "Manual"],
            ["Delete location", "Remove location", "Location deleted", "src/app", "Medium", "Manual"]
        ],
        "Location Assignment": [
            ["Assign asset to location", "Select location", "Location assigned", "src/app", "Medium", "Manual"],
            ["Filter by location", "Filter assets by location", "Shows filtered", "src/app", "Medium", "Manual"],
            ["Location in reports", "Generate report", "Location included", "src/app", "Medium", "Manual"]
        ]
    },
    "71. Marketing & Public Pages": {
        "Landing Page": [
            ["View landing page", "Navigate to /", "Shows landing page", "src/app", "Medium", "Manual"],
            ["Hero section", "Check hero", "Shows value proposition", "src/app", "Medium", "Manual"],
            ["Features section", "Scroll to features", "Shows feature list", "src/app", "Medium", "Manual"],
            ["CTA buttons", "Click 'Get Started'", "Goes to /get-started", "src/app", "Medium", "Manual"],
            ["Navigation links", "Click nav items", "Navigate correctly", "src/app", "Medium", "Manual"],
            ["Mobile responsive", "View on mobile", "Layout adapts", "src/app", "Medium", "Manual"],
            ["Logo click", "Click logo", "Returns to landing", "src/app", "Medium", "Manual"]
        ],
        "Pricing Page": [
            ["View pricing", "Navigate to /pricing", "Shows pricing tiers", "src/app", "Medium", "Manual"],
            ["Free tier details", "Check free tier", "Shows limits/features", "src/app", "Medium", "Manual"],
            ["Starter tier details", "Check starter", "Shows price/features", "src/app", "Medium", "Manual"],
            ["Professional tier", "Check pro tier", "Shows price/features", "src/app", "Medium", "Manual"],
            ["Enterprise tier", "Check enterprise", "Shows 'Contact us'", "src/app", "Medium", "Manual"],
            ["Feature comparison", "View comparison table", "Clear feature matrix", "src/app", "Medium", "Manual"],
            ["CTA per tier", "Click tier CTA", "Goes to /get-started", "src/app", "Medium", "Manual"]
        ],
        "Legal Pages": [
            ["Terms of Service", "Navigate to /terms", "Shows terms", "src/app", "Medium", "Manual"],
            ["Privacy Policy", "Navigate to /privacy", "Shows privacy policy", "src/app", "Medium", "Manual"],
            ["Cookie Policy", "Navigate to /cookies", "Shows cookie policy", "src/app", "Medium", "Manual"],
            ["Footer links", "Click footer legal links", "Navigate correctly", "src/app", "Medium", "Manual"],
            ["Last updated date", "Check date", "Shows recent date", "src/app", "Medium", "Manual"]
        ]
    },
    "72. Admin Dashboard": {
        "Dashboard Overview": [
            ["Quick stats cards", "Check stat cards", "Shows key metrics", "src/app", "Medium", "Manual"],
            ["Asset count", "Check asset count", "Accurate count", "src/app", "Medium", "Manual"],
            ["Employee count", "Check employee count", "Accurate count", "src/app", "Medium", "Manual"],
            ["Pending approvals", "Check pending count", "Shows pending items", "src/app", "Medium", "Manual"]
        ],
        "Dashboard Widgets": [
            ["Expiring documents", "View widget", "Shows expiring docs", "src/app", "Medium", "Manual"],
            ["Upcoming renewals", "View subscriptions", "Shows renewals", "src/app", "Medium", "Manual"],
            ["Leave calendar", "View leave widget", "Shows team leave", "src/app", "Medium", "Manual"],
            ["Celebrations", "View celebrations", "Shows birthdays/anniversaries", "src/app", "Medium", "Manual"],
            ["Quick actions", "Click quick action", "Navigates correctly", "src/app", "Medium", "Manual"],
            ["Widget loading", "Slow connection", "Shows loading state", "src/app", "Medium", "Manual"],
            ["Widget error", "API fails", "Shows error gracefully", "src/app", "Medium", "Manual"]
        ]
    },
    "75. Error Handling & Edge Cases": {
        "Error Pages": [
            ["404 page", "Navigate to /nonexistent", "Shows 404 page", "src/app", "Medium", "Manual"],
            ["404 has navigation", "Check 404 page", "Can navigate home", "src/app", "Medium", "Manual"],
            ["500 error", "Trigger server error", "Shows error page", "src/app", "Medium", "Manual"],
            ["Error page branding", "Check error pages", "Has app branding", "src/app", "Medium", "Manual"],
            ["Back button on error", "Click back", "Returns to previous", "src/app", "Medium", "Manual"]
        ],
        "API Error Handling": [
            ["Invalid JSON", "Send malformed JSON", "400 error", "src/app", "Medium", "Manual"],
            ["Missing required field", "Omit required field", "400 with details", "src/app", "Medium", "Manual"],
            ["Invalid ID format", "Use invalid ID", "400 error", "src/app", "Medium", "Manual"],
            ["Not found", "Request missing resource", "404 error", "src/app", "Medium", "Manual"],
            ["Unauthorized", "Request without auth", "401 error", "src/app", "Medium", "Manual"],
            ["Forbidden", "Request without permission", "403 error", "src/app", "Medium", "Manual"],
            ["Rate limited", "Exceed rate limit", "429 error", "src/app", "Medium", "Manual"],
            ["Server error", "Trigger 500", "Graceful error response", "src/app", "Medium", "Manual"]
        ],
        "Loading States": [
            ["Page loading", "Navigate to page", "Shows loading skeleton", "src/app", "Medium", "Manual"],
            ["Table loading", "Load data table", "Shows table skeleton", "src/app", "Medium", "Manual"],
            ["Button loading", "Submit form", "Button shows spinner", "src/app", "Medium", "Manual"],
            ["Infinite scroll", "Scroll to load more", "Loading indicator", "src/app", "Medium", "Manual"],
            ["Slow connection", "Throttle network", "Loading persists", "src/app", "Medium", "Manual"]
        ]
    },
    "76. Scheduled Tasks (Cron)": {
        "Cron Jobs": [
            ["Cron runs during maintenance", "Deploy during cron execution", "Job completes or retries", "src/app", "Medium", "Manual"],
            ["Duplicate cron trigger", "Job triggered twice simultaneously", "Idempotent, no duplicate processing", "src/app", "Medium", "Manual"],
            ["Cron with no data to process", "Expiry check with no expiring docs", "Completes successfully, logs empty run", "src/app", "Medium", "Manual"],
            ["Cron timeout", "Job takes longer than timeout", "Handled gracefully, alerts admin", "src/app", "Medium", "Manual"],
            ["Cron auth failure", "Invalid CRON_SECRET", "401 error, logged", "src/app", "Medium", "Manual"]
        ],
        "Alert Jobs": [
            ["Alert already sent", "Run expiry alert twice same day", "Doesn't duplicate notifications", "src/app", "Medium", "Manual"],
            ["Alert for deleted entity", "Document deleted before alert runs", "Skips gracefully", "src/app", "Medium", "Manual"],
            ["Alert with notification failure", "Email service down during alerts", "Retries or logs for manual review", "src/app", "Medium", "Manual"],
            ["Alert threshold edge", "Document expires in exactly 30 days", "Included in 30-day alert", "src/app", "Medium", "Manual"]
        ]
    },
    "77. Tenant Branding": {
        "Organization Branding": [
            ["View org with logo", "Access org subdomain", "Logo displayed", "src/app", "Medium", "Manual"],
            ["No logo fallback", "Org without logo", "Shows initials/default", "src/app", "Medium", "Manual"],
            ["Login page branding", "View login", "Shows org branding", "src/app", "Medium", "Manual"],
            ["Email branding", "Receive email", "Has org branding", "src/app", "Medium", "Manual"],
            ["PDF branding", "Generate PDF", "Has org logo", "src/app", "Medium", "Manual"]
        ],
        "Public Branding API": [
            ["Get branding by slug", "Call branding API", "Returns branding info", "src/app", "Medium", "Manual"],
            ["Invalid slug", "Unknown slug", "404 error", "src/app", "Medium", "Manual"],
            ["Branding caching", "Multiple requests", "Cached response", "src/app", "Medium", "Manual"]
        ]
    },
    "78. Health & Monitoring": {
        // "Health Check": [
        //     ["Health endpoint", "GET /api/health", "Returns 200 OK", "src/app", "Medium", "Manual"],
        //     ["Database check", "Check DB connection", "Shows DB status", "src/app", "Medium", "Manual"],
        //     ["Response time", "Check response", "Fast response", "src/app", "Medium", "Manual"]
        // ],
        "System Alerts": [
            ["View alerts", "Navigate to alerts", "Shows system alerts", "src/app", "Medium", "Manual"],
            ["Unread alerts", "Check unread count", "Count accurate", "src/app", "Medium", "Manual"],
            ["Dismiss alert", "Dismiss alert", "Alert removed", "src/app", "Medium", "Manual"],
            ["Alert severity", "Check alert levels", "Shows severity", "src/app", "Medium", "Manual"]
        ]
    },
    "79. User Preferences": {
        "Display Preferences": [
            ["Date format", "Change date format", "Dates update throughout", "src/app", "Medium", "Manual"],
            ["Time format", "Switch 12h/24h", "Times update", "src/app", "Medium", "Manual"],
            ["Number format", "Change decimal separator", "Numbers update", "src/app", "Medium", "Manual"],
            ["Compact view", "Toggle compact", "Tables become compact", "src/app", "Medium", "Manual"],
            ["Items per page", "Change default", "Pagination updates", "src/app", "Medium", "Manual"]
        ],
        "Notification Preferences": [
            ["Email notifications on", "Enable email", "Receives emails", "src/app", "Medium", "Manual"],
            ["Email notifications off", "Disable email", "No emails received", "src/app", "Medium", "Manual"],
            ["In-app notifications", "Toggle in-app", "In-app on/off", "src/app", "Medium", "Manual"],
            ["WhatsApp notifications", "Toggle WhatsApp", "WhatsApp on/off", "src/app", "Medium", "Manual"],
            ["Notification types", "Select specific types", "Only those types sent", "src/app", "Medium", "Manual"],
            ["Quiet hours", "Set quiet hours", "No notifications during", "src/app", "Medium", "Manual"]
        ]
    },
    "80. Data Integrity": {
        "Referential Integrity": [
            ["Delete employee with assets", "Delete assigned employee", "Assets unassigned first", "src/app", "Medium", "Manual"],
            ["Delete supplier with engagements", "Delete supplier", "Engagements cascade deleted", "src/app", "Medium", "Manual"],
            ["Delete leave type with requests", "Delete type", "Prevented or handled", "src/app", "Medium", "Manual"],
            ["Delete category with assets", "Delete category", "Error or reassign", "src/app", "Medium", "Manual"],
            ["Delete user with approvals", "Delete approving user", "Approvals reassigned", "src/app", "Medium", "Manual"]
        ],
        "Data Consistency": [
            ["Leave balance sync", "Approve leave", "Balance decremented", "src/app", "Medium", "Manual"],
            ["Asset status sync", "Assign asset", "Status = ASSIGNED", "src/app", "Medium", "Manual"],
            ["Approval chain sync", "Approve step", "Next step activated", "src/app", "Medium", "Manual"],
            ["Payroll calculations", "Generate payslip", "Amounts match structure", "src/app", "Medium", "Manual"],
            ["Depreciation sync", "Monthly run", "Book values updated", "src/app", "Medium", "Manual"]
        ]
    },
    // "81. Performance Tests": {
    //     "Load Testing": [
    //         ["100 concurrent users", "Simulate load", "Response < 500ms", "src/app", "Medium", "Manual"],
    //         ["1000 assets list", "Load large list", "Response < 1s", "src/app", "Medium", "Manual"],
    //         ["Large payroll run", "100 employees", "Completes successfully", "src/app", "Medium", "Manual"]
    //     ]
    // },
    // "82. Browser Compatibility": {
    //     "Browser Tests": [
    //         ["Chrome Latest", "Test in Chrome", "Works correctly", "src/app", "Medium", "Manual"],
    //         ["Firefox Latest", "Test in Firefox", "Works correctly", "src/app", "Medium", "Manual"],
    //         ["Safari Latest", "Test in Safari", "Works correctly", "src/app", "Medium", "Manual"],
    //         ["Edge Latest", "Test in Edge", "Works correctly", "src/app", "Medium", "Manual"]
    //     ]
    // },
    "84. UI & Form Edge Cases": {
        "Form Behavior": [
            ["Submit with pending validation", "Click submit while validating", "Waits for validation complete", "src/app", "Medium", "Manual"],
            ["Form with stale data", "Edit form, data changes server-side", "Conflict detection or overwrites", "src/app", "Medium", "Manual"],
            ["Browser back after submit", "Submit, browser back, submit again", "Prevented or handled", "src/app", "Medium", "Manual"],
            ["Form timeout", "Fill form, wait 30 min, submit", "Session refresh or re-auth", "src/app", "Medium", "Manual"],
            ["Paste special characters", "Paste content with hidden chars", "Sanitized appropriately", "src/app", "Medium", "Manual"]
        ],
        "Navigation": [
            ["Deep link to protected page", "Direct URL to /admin/assets/123", "Auth check, then show or redirect", "src/app", "Medium", "Manual"],
            ["Breadcrumb accuracy", "Navigate deep, check breadcrumbs", "Accurate path shown", "src/app", "Medium", "Manual"],
            ["Back button after delete", "Delete item, press back", "Shows deleted state or redirects", "src/app", "Medium", "Manual"],
            ["Refresh during edit", "Refresh unsaved form", "Browser warning, data preserved or lost clearly", "src/app", "Medium", "Manual"]
        ]
    }
};

// State
let completed = JSON.parse(localStorage.getItem('durj-comprehensive-tests') || '{}');
let searchTerm = '';
let statusFilter = 'all';
let coverageFilter = 'all';
let expandedSections = new Set();
let searchTimeout = null;

// Helpers
const escapeHtml = (str) => String(str).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
const generateTestId = (section, subsection, name) => (section + '::' + subsection + '::' + name).replace(/[^a-zA-Z0-9:]/g, '_');
const isCompleted = (id) => !!completed[id];

function toggleTest(testId) {
    completed[testId] = !completed[testId];
    localStorage.setItem('durj-comprehensive-tests', JSON.stringify(completed));
    updateStats();
    updateNavItem(testId);
}

function getSectionStats(section) {
    let total = 0, done = 0;
    for (const subsection in T[section]) {
        for (const test of T[section][subsection]) {
            total++;
            if (isCompleted(generateTestId(section, subsection, test[0]))) done++;
        }
    }
    return { total, done, percentage: total ? Math.round(done / total * 100) : 0 };
}

function getTotalStats() {
    let total = 0, done = 0;
    for (const section in T) {
        const stats = getSectionStats(section);
        total += stats.total;
        done += stats.done;
    }
    return { total, done, percentage: total ? Math.round(done / total * 100) : 0 };
}

function updateStats() {
    const stats = getTotalStats();
    document.getElementById('total-tests').textContent = stats.total;
    document.getElementById('completed-tests').textContent = stats.done;
    document.getElementById('remaining-tests').textContent = stats.total - stats.done;
    document.getElementById('progress-pct').textContent = stats.percentage + '%';
    document.getElementById('main-progress-fill').style.width = stats.percentage + '%';
}

function updateNavItem(testId) {
    for (const s in T) {
        if (s.replace(/[^a-zA-Z0-9]/g, '_') === testId.split('::')[0]) {
            const stats = getSectionStats(s);
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                if (item.dataset.section === s) {
                    item.className = 'nav-item' + (stats.percentage === 100 ? ' complete' : '');
                    item.querySelector('.progress-mini').textContent = stats.done + '/' + stats.total;
                }
            });
            const sectionEl = document.getElementById('sec-' + s.replace(/[^a-zA-Z0-9]/g, '_'));
            if (sectionEl) {
                const fill = sectionEl.querySelector('.section-progress-fill');
                const text = sectionEl.querySelector('.section-progress-text');
                if (fill) fill.style.width = stats.percentage + '%';
                if (text) text.textContent = stats.done + '/' + stats.total;
            }
            break;
        }
    }
}

function renderNav() {
    const nav = document.getElementById('sidebar-nav');
    nav.innerHTML = '';
    for (const section in T) {
        const stats = getSectionStats(section);
        const item = document.createElement('div');
        item.className = 'nav-item' + (stats.percentage === 100 ? ' complete' : '');
        item.dataset.section = section;
        item.innerHTML = '<span>' + escapeHtml(section) + '</span><span class="progress-mini">' + stats.done + '/' + stats.total + '</span>';
        item.onclick = () => {
            const sectionEl = document.getElementById('sec-' + section.replace(/[^a-zA-Z0-9]/g, '_'));
            if (sectionEl) {
                if (!expandedSections.has(section)) toggleSection(section);
                sectionEl.scrollIntoView({ behavior: 'smooth' });
            }
        };
        nav.appendChild(item);
    }
}

function matchesFilters(test, testId) {
    const isDone = isCompleted(testId);
    if (statusFilter === 'completed' && !isDone) return false;
    if (statusFilter === 'pending' && isDone) return false;
    const coverage = (test[5] || 'manual').toLowerCase();
    if (coverageFilter !== 'all' && coverage !== coverageFilter) return false;
    if (searchTerm) {
        const s = searchTerm.toLowerCase();
        if (!test[0].toLowerCase().includes(s) && !test[1].toLowerCase().includes(s) && !test[2].toLowerCase().includes(s) && !(test[3] || '').toLowerCase().includes(s)) return false;
    }
    return true;
}

function toggleSection(section) {
    const sectionId = 'sec-' + section.replace(/[^a-zA-Z0-9]/g, '_');
    const sectionEl = document.getElementById(sectionId);
    if (!sectionEl) return;

    const content = sectionEl.querySelector('.section-content');
    const isExpanding = sectionEl.classList.contains('collapsed');

    if (isExpanding) {
        expandedSections.add(section);
        sectionEl.classList.remove('collapsed');
        if (content.children.length === 0) renderSectionContent(section, content);
    } else {
        expandedSections.delete(section);
        sectionEl.classList.add('collapsed');
    }
}

function renderSectionContent(section, container) {
    let html = '';
    for (const subsection in T[section]) {
        let testsHtml = '';
        let count = 0;
        for (const test of T[section][subsection]) {
            const testId = generateTestId(section, subsection, test[0]);
            if (!matchesFilters(test, testId)) continue;
            count++;
            const isDone = isCompleted(testId);
            const cov = (test[5] || 'Manual');
            const covClass = cov === 'Automated' ? 'badge-automated' : cov === 'E2E' ? 'badge-e2e' : 'badge-manual';
            const priClass = 'priority-' + (test[4] || 'medium').toLowerCase();
            testsHtml += '<div class="test-item ' + (isDone ? 'completed' : '') + '" data-id="' + testId + '"><input type="checkbox" ' + (isDone ? 'checked' : '') + ' onchange="toggleTest(\'' + testId + '\'); this.parentElement.classList.toggle(\'completed\')"><div class="test-info"><div class="test-name">' + escapeHtml(test[0]) + '</div><div class="test-details"><span>Steps: ' + escapeHtml(test[1]) + '</span><span>Expected: ' + escapeHtml(test[2]) + '</span><span class="code-ref">' + escapeHtml(test[3] || '') + '</span><span class="test-badge ' + covClass + '">' + cov + '</span><span class="' + priClass + '">' + (test[4] || 'Medium') + '</span></div></div></div>';
        }
        if (count > 0) html += '<div class="subsection"><div class="subsection-header">' + escapeHtml(subsection) + ' (' + count + ')</div><div class="test-list">' + testsHtml + '</div></div>';
    }
    container.innerHTML = html;
}

function renderSectionHeaders() {
    const container = document.getElementById('sections-container');
    container.innerHTML = '';

    for (const section in T) {
        const stats = getSectionStats(section);
        const sectionId = 'sec-' + section.replace(/[^a-zA-Z0-9]/g, '_');
        const isExpanded = expandedSections.has(section);

        let hasVisible = true;
        if (searchTerm || statusFilter !== 'all' || coverageFilter !== 'all') {
            hasVisible = false;
            outer: for (const sub in T[section]) {
                for (const test of T[section][sub]) {
                    if (matchesFilters(test, generateTestId(section, sub, test[0]))) { hasVisible = true; break outer; }
                }
            }
            if (!hasVisible) continue;
        }

        const div = document.createElement('section');
        div.className = 'section' + (isExpanded ? '' : ' collapsed');
        div.id = sectionId;
        const escapedSection = section.replace(/'/g, "\'");
        div.innerHTML = '<div class="section-header" onclick="toggleSection(\'' + escapedSection + '\')"><div class="section-title"><h2>' + escapeHtml(section) + '</h2></div><div class="section-progress"><div class="section-progress-bar"><div class="section-progress-fill" style="width:' + stats.percentage + '%"></div></div><span class="section-progress-text">' + stats.done + '/' + stats.total + '</span><svg class="collapse-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg></div></div><div class="section-content"></div>';
        container.appendChild(div);

        if (isExpanded || searchTerm) {
            renderSectionContent(section, div.querySelector('.section-content'));
            if (searchTerm) div.classList.remove('collapsed');
        }
    }
}

document.getElementById('search-input').addEventListener('input', (e) => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => { searchTerm = e.target.value; renderSectionHeaders(); }, 300);
});

document.querySelectorAll('.filter-btn[data-filter]').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn[data-filter]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        statusFilter = btn.dataset.filter;
        renderSectionHeaders();
    });
});

document.querySelectorAll('.filter-btn[data-coverage]').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn[data-coverage]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        coverageFilter = btn.dataset.coverage;
        renderSectionHeaders();
    });
});

function exportProgress() {
    const data = { completed, exportedAt: new Date().toISOString(), stats: getTotalStats() };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'durj-test-progress-' + new Date().toISOString().split('T')[0] + '.json';
    a.click();
    showToast('Progress exported!');
}

function importProgress(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (event) => {
        try {
            const data = JSON.parse(event.target.result);
            completed = data.completed || data;
            localStorage.setItem('durj-comprehensive-tests', JSON.stringify(completed));
            updateStats();
            renderNav();
            renderSectionHeaders();
            showToast('Progress imported!');
        } catch (err) { showToast('Error: Invalid file'); }
    };
    reader.readAsText(file);
    e.target.value = '';
}

function resetProgress() {
    if (confirm('Reset ALL test progress?')) {
        completed = {};
        localStorage.removeItem('durj-comprehensive-tests');
        updateStats();
        renderNav();
        renderSectionHeaders();
        showToast('Progress reset!');
    }
}

function showToast(msg) {
    const existing = document.querySelector('.toast');
    if (existing) existing.remove();
    const t = document.createElement('div');
    t.className = 'toast';
    t.textContent = msg;
    document.body.appendChild(t);
    setTimeout(() => t.remove(), 3000);
}

// Initialize - fast because sections are collapsed
updateStats();
renderNav();
renderSectionHeaders();

    </script>
</body>
</html>
